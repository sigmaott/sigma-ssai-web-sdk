import{k as se,l as X,r as I,m as ne,n as oe}from"./zoid-GiZW97aZ.js";const ie=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,ae=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,ce=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function ue(e,r){if(e==="__proto__"||e==="constructor"&&r&&typeof r=="object"&&"prototype"in r){le(e);return}return r}function le(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function D(e,r={}){if(typeof e!="string")return e;const s=e.trim();if(e[0]==='"'&&e.endsWith('"')&&!e.includes("\\"))return s.slice(1,-1);if(s.length<=9){const n=s.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!ce.test(e)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(ie.test(e)||ae.test(e)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,ue)}return JSON.parse(e)}catch(n){if(r.strict)throw n;return e}}class de extends Error{constructor(r,s){super(r,s),this.name="FetchError",s!=null&&s.cause&&!this.cause&&(this.cause=s.cause)}}function fe(e){var w,d,t,h,l;const r=((w=e.error)==null?void 0:w.message)||((d=e.error)==null?void 0:d.toString())||"",s=((t=e.request)==null?void 0:t.method)||((h=e.options)==null?void 0:h.method)||"GET",n=((l=e.request)==null?void 0:l.url)||String(e.request)||"/",i=`[${s}] ${JSON.stringify(n)}`,y=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",p=`${i}: ${y}${r?` ${r}`:""}`,f=new de(p,e.error?{cause:e.error}:void 0);for(const m of["request","options","response"])Object.defineProperty(f,m,{get(){return e[m]}});for(const[m,k]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(f,m,{get(){return e.response&&e.response[k]}});return f}const pe=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function W(e="GET"){return pe.has(e.toUpperCase())}function he(e){if(e===void 0)return!1;const r=typeof e;return r==="string"||r==="number"||r==="boolean"||r===null?!0:r!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const me=new Set(["image/svg","application/xml","application/xhtml","application/html"]),ge=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function ye(e=""){if(!e)return"json";const r=e.split(";").shift()||"";return ge.test(r)?"json":me.has(r)||r.startsWith("text/")?"text":"blob"}function we(e,r,s=globalThis.Headers){const n={...r,...e};if(r!=null&&r.params&&(e!=null&&e.params)&&(n.params={...r==null?void 0:r.params,...e==null?void 0:e.params}),r!=null&&r.query&&(e!=null&&e.query)&&(n.query={...r==null?void 0:r.query,...e==null?void 0:e.query}),r!=null&&r.headers&&(e!=null&&e.headers)){n.headers=new s((r==null?void 0:r.headers)||{});for(const[i,y]of new s((e==null?void 0:e.headers)||{}))n.headers.set(i,y)}return n}const Te=new Set([408,409,425,429,500,502,503,504]),Ee=new Set([101,204,205,304]);function K(e={}){const{fetch:r=globalThis.fetch,Headers:s=globalThis.Headers,AbortController:n=globalThis.AbortController}=e;async function i(f){const w=f.error&&f.error.name==="AbortError"&&!f.options.timeout||!1;if(f.options.retry!==!1&&!w){let t;typeof f.options.retry=="number"?t=f.options.retry:t=W(f.options.method)?0:1;const h=f.response&&f.response.status||500;if(t>0&&(Array.isArray(f.options.retryStatusCodes)?f.options.retryStatusCodes.includes(h):Te.has(h))){const l=f.options.retryDelay||0;return l>0&&await new Promise(m=>setTimeout(m,l)),y(f.request,{...f.options,retry:t-1})}}const d=fe(f);throw Error.captureStackTrace&&Error.captureStackTrace(d,y),d}const y=async function(w,d={}){var m;const t={request:w,options:we(d,e.defaults,s),response:void 0,error:void 0};t.options.method=(m=t.options.method)==null?void 0:m.toUpperCase(),t.options.onRequest&&await t.options.onRequest(t),typeof t.request=="string"&&(t.options.baseURL&&(t.request=se(t.request,t.options.baseURL)),(t.options.query||t.options.params)&&(t.request=X(t.request,{...t.options.params,...t.options.query}))),t.options.body&&W(t.options.method)&&(he(t.options.body)?(t.options.body=typeof t.options.body=="string"?t.options.body:JSON.stringify(t.options.body),t.options.headers=new s(t.options.headers||{}),t.options.headers.has("content-type")||t.options.headers.set("content-type","application/json"),t.options.headers.has("accept")||t.options.headers.set("accept","application/json")):("pipeTo"in t.options.body&&typeof t.options.body.pipeTo=="function"||typeof t.options.body.pipe=="function")&&("duplex"in t.options||(t.options.duplex="half")));let h;if(!t.options.signal&&t.options.timeout){const k=new n;h=setTimeout(()=>k.abort(),t.options.timeout),t.options.signal=k.signal}try{t.response=await r(t.request,t.options)}catch(k){return t.error=k,t.options.onRequestError&&await t.options.onRequestError(t),await i(t)}finally{h&&clearTimeout(h)}if(t.response.body&&!Ee.has(t.response.status)&&t.options.method!=="HEAD"){const k=(t.options.parseResponse?"json":t.options.responseType)||ye(t.response.headers.get("content-type")||"");switch(k){case"json":{const A=await t.response.text(),F=t.options.parseResponse||D;t.response._data=F(A);break}case"stream":{t.response._data=t.response.body;break}default:t.response._data=await t.response[k]()}}return t.options.onResponse&&await t.options.onResponse(t),!t.options.ignoreResponseError&&t.response.status>=400&&t.response.status<600?(t.options.onResponseError&&await t.options.onResponseError(t),await i(t)):t.response},p=async function(w,d){return(await y(w,d))._data};return p.raw=y,p.native=(...f)=>r(...f),p.create=(f={})=>K({...e,defaults:{...e.defaults,...f}}),p}const $=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),ve=$.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),be=$.Headers,Re=$.AbortController,ke=K({fetch:ve,Headers:be,AbortController:Re}),_e=ke.create({credentials:"omit",onResponseError({response:e,error:r}){console.log("[LOG] ~ error:",r)},onRequest:({options:e,request:r})=>{const s=e.token;s&&(e.headers=e.headers||{},e.headers.Authorization=`${s}`)},onResponse({response:e,options:r}){}}),Me=e=>(r,s)=>(e.set(r,s),s),V=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,Y=536870912,B=Y*2,Se=(e,r)=>s=>{const n=r.get(s);let i=n===void 0?s.size:n<B?n+1:0;if(!s.has(i))return e(s,i);if(s.size<Y){for(;s.has(i);)i=Math.floor(Math.random()*B);return e(s,i)}if(s.size>V)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;s.has(i);)i=Math.floor(Math.random()*V);return e(s,i)},Q=new WeakMap,Oe=Me(Q),H=Se(Oe,Q),Ae=e=>e.method!==void 0&&e.method==="call",Fe=e=>typeof e.id=="number"&&typeof e.result=="boolean",Le=e=>{const r=new Map([[0,()=>{}]]),s=new Map([[0,()=>{}]]),n=new Map,i=new Worker(e);return i.addEventListener("message",({data:d})=>{if(Ae(d)){const{params:{timerId:t,timerType:h}}=d;if(h==="interval"){const l=r.get(t);if(typeof l===void 0)throw new Error("The timer is in an undefined state.");if(typeof l=="number"){const m=n.get(l);if(m===void 0||m.timerId!==t||m.timerType!==h)throw new Error("The timer is in an undefined state.")}else typeof l=="function"&&l()}else if(h==="timeout"){const l=s.get(t);if(typeof l===void 0)throw new Error("The timer is in an undefined state.");if(typeof l=="number"){const m=n.get(l);if(m===void 0||m.timerId!==t||m.timerType!==h)throw new Error("The timer is in an undefined state.")}else typeof l=="function"&&(l(),s.delete(t))}}else if(Fe(d)){const{id:t}=d,h=n.get(t);if(h===void 0)throw new Error("The timer is in an undefined state.");const{timerId:l,timerType:m}=h;n.delete(t),m==="interval"?r.delete(l):s.delete(l)}else{const{error:{message:t}}=d;throw new Error(t)}}),{clearInterval:d=>{if(typeof r.get(d)=="function"){const t=H(n);n.set(t,{timerId:d,timerType:"interval"}),r.set(d,t),i.postMessage({id:t,method:"clear",params:{timerId:d,timerType:"interval"}})}},clearTimeout:d=>{if(typeof s.get(d)=="function"){const t=H(n);n.set(t,{timerId:d,timerType:"timeout"}),s.set(d,t),i.postMessage({id:t,method:"clear",params:{timerId:d,timerType:"timeout"}})}},setInterval:(d,t=0,...h)=>{const l=H(r);return r.set(l,()=>{d(...h),typeof r.get(l)=="function"&&i.postMessage({id:null,method:"set",params:{delay:t,now:performance.timeOrigin+performance.now(),timerId:l,timerType:"interval"}})}),i.postMessage({id:null,method:"set",params:{delay:t,now:performance.timeOrigin+performance.now(),timerId:l,timerType:"interval"}}),l},setTimeout:(d,t=0,...h)=>{const l=H(s);return s.set(l,()=>d(...h)),i.postMessage({id:null,method:"set",params:{delay:t,now:performance.timeOrigin+performance.now(),timerId:l,timerType:"timeout"}}),l}}},Ie=(e,r)=>{let s=null;return()=>{if(s!==null)return s;const n=new Blob([r],{type:"application/javascript; charset=utf-8"}),i=URL.createObjectURL(n);return s=e(i),setTimeout(()=>URL.revokeObjectURL(i)),s}},Ne=`(()=>{"use strict";const e=new Map,t=new Map,r=t=>{const r=e.get(t);return void 0!==r&&(clearTimeout(r),e.delete(t),!0)},s=e=>{const r=t.get(e);return void 0!==r&&(clearTimeout(r),t.delete(e),!0)},o=(e,t)=>{const r=performance.now(),s=e+t-r-performance.timeOrigin;return{expected:r+s,remainingDelay:s}},i=(e,t,r,s)=>{const o=r-performance.now();o>0?e.set(t,setTimeout(i,o,e,t,r,s)):(e.delete(t),postMessage({id:null,method:"call",params:{timerId:t,timerType:s}}))};addEventListener("message",(n=>{let{data:a}=n;try{if("clear"===a.method){const{id:e,params:{timerId:t,timerType:o}}=a;if("interval"===o)postMessage({id:e,result:r(t)});else{if("timeout"!==o)throw new Error('The given type "'.concat(o,'" is not supported'));postMessage({id:e,result:s(t)})}}else{if("set"!==a.method)throw new Error('The given method "'.concat(a.method,'" is not supported'));{const{params:{delay:r,now:s,timerId:n,timerType:m}}=a;if("interval"===m)((t,r,s)=>{const{expected:n,remainingDelay:a}=o(t,s);e.set(r,setTimeout(i,a,e,r,n,"interval"))})(r,n,s);else{if("timeout"!==m)throw new Error('The given type "'.concat(m,'" is not supported'));((e,r,s)=>{const{expected:n,remainingDelay:a}=o(e,s);t.set(r,setTimeout(i,a,t,r,n,"timeout"))})(r,n,s)}}}}catch(e){postMessage({error:{message:e.message},id:a.id,result:null})}}))})();`,Z=Ie(Le,Ne),Pe=e=>Z().clearTimeout(e),J=(...e)=>Z().setTimeout(...e);function qe(){const e=new Set,r=i=>{e.delete(i)};return{on:i=>(e.add(i),{off:()=>r(i)}),off:r,trigger:(...i)=>Promise.all(Array.from(e).map(y=>y(...i)))}}async function Ce(e){try{return{data:await e,error:null}}catch(r){return{data:null,error:r||{message:"Unknown error"}}}}function He(e){return new Promise((r,s)=>{const n=document.createElement("script");n.async=!0,n.src=e,n.onload=r,n.onerror=s,document.body.appendChild(n)})}const je="https://cdn.jsdelivr.net/gh/sigmaott/sigma-ssai-web-sdk/v6/build/dist/wasm_exec.js";let P=null;function z(){P=null}function De(){const e=window;return e.Go?Promise.resolve(e.wasm):P||(P=He(je).then(()=>e.Go),P.then(z).catch(z),P)}class q{constructor(){return q.instance?q.instance:(this.session=null,this.go=null,this.buffer=null,this.audioMediaSequence={},q.instance=this,this)}async init(r){if(!this.buffer){const n=await(await fetch(r)).arrayBuffer();this.buffer=n}return q.instance}async loadSource(r){this.session&&(r.session=this.session);const s=JSON.stringify(r),n=new Go,i=await WebAssembly.instantiate(this.buffer,n.importObject);n.run(i.instance);let y;for(let p=1;p<=3;p++)try{y=await window.loadSource(s);break}catch(f){if(console.log(`Attempt ${p} failed:`,f),p===3)throw console.log("session:",this.session),console.log(s),f}if(y.session!=""&&(this.session=y.session),y.error)throw new Error(y.error);return y.manifest}async getEventTracking(){if(this.session){const r=window.getEventTracking(this.session);if(r.error)throw new Error(r.error);return{avails:JSON.parse(r.avails)}}return null}}const $e=I(),Ge=I();function x({adsUrl:e,sdk:r,loader:s}){return class extends s{constructor(i){super(i)}load(i,y,p){const f=p.onSuccess;p.onSuccess=async(w,d,t)=>{(t.type==="manifest"||t.type==="level"||t.type==="audioTrack")&&(w.data=await this.modifyManifest(w.url,w.data,t.type)),f(w,d,t)},super.load(i,y,p)}async modifyManifest(i,y,p){console.log("[LOG] ~ manifest:",y),$e.value=y;const f={proxyAds:{uri:e,timeout:2}};try{const w=await r.loadSource({config:f,manifest:y,masterUri:i});return console.log("[LOG] ~ newManifest:",w),Ge.value=w,w}catch(w){return console.error("[LOG] ~ error:",w),y}}}}function Ue({video:e,adContainer:r,startSession:s,sdk:n}){const i=qe(),y=I(!1),p=I(),f=Math.random().toString(36).slice(6);function w({icons:o}){return{id:f,appConfig:{sdkBaseUrl:X("https://cdn.jsdelivr.net/gh/sigmaott/sigma-ssai-web-sdk/v6/build/dist/wta/index.html",{id:f})},icons:o}}const d=ne(w({icons:[]}));d.render(r),d.hide(),r.style.display="none",oe(()=>{var o;if(p.value){const c=((o=p.value)==null?void 0:o.icons)||[];r.style.display="block",d.updateProps(w({icons:c})),d.show()}else r.style.display="none",d.hide()});const t=I([]),h=I(),l=I([]);async function m(o){var a;console.log("[LOG] ~ currentAd:",p);const c=(a=p.value)==null?void 0:a.trackingEvents.find(g=>g.eventType===o);if(!c){console.debug("[LOG] ~ event:",o);return}i.trigger(c),await Promise.all(c.beaconUrls.map(g=>Ce(_e(g,{retry:3,retryDelay:500}))))}const k=new Map;let A;function F(o,c,a){o.addEventListener(c,a),k.set(c,a)}function C(o){var b,S;const c=((o==null?void 0:o.time)||0)>0?o.time:0,a=(b=o==null?void 0:o.value)==null?void 0:b.event;console.debug("[LOG] ~ eventType:",a);const g=l.value.find(M=>M.eventType===a&&!M.tracked&&!M.skipped);if(console.debug("[LOG] ~ eventAd:",g),!g)return;const v=g==null?void 0:g.ad;if(console.debug("[LOG] ~ ad:",v),!!v){if(a==="start")p.value&&l.value.filter(L=>L.key.startsWith(`${p.value.key}_`)).forEach(L=>L.skipped=!0),p.value=v,s(v.adVerifications,i),A=J(()=>{m("impression"),m("start");const M=l.value.find(L=>L.key===g.key.replace("_start","_impression"));M&&(M.tracked=!0),g.tracked=!0},c*1e3);else{if(!p.value){console.debug("[LOG] ~ eventType:",a);return}if(v.id!==((S=p.value)==null?void 0:S.id)){console.debug("[ERROR] ~ ad:",v),console.debug("[ERROR] ~ currentAd:",p.value),l.value.filter(L=>L.key.startsWith(`${p.value.key}_`)).forEach(L=>L.skipped=!0);return}A=J(()=>{m(a),a==="complete"&&v.id===p.value.id&&(p.value=void 0),g.tracked=!0},c*1e3)}console.debug("========================================")}}function T(){return y.value=!1,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].forEach(o=>{F(e,o,()=>{const c=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;m(c?"fullscreen":"exitFullscreen")})}),F(e,"pause",()=>m("pause")),F(e,"play",()=>m("resume")),F(e,"rewind",()=>m("rewind")),F(e,"mute",()=>m("mute")),F(e,"unmute",()=>m("unmute")),async(o,c)=>{if(h.value=c.frag.sn,o!==window.Hls.Events.FRAG_CHANGED)return;const a=t.value.filter(g=>g.sn===c.frag.sn);if(!a.length){console.debug("[LOG] ~ trackingEvent:",a);return}a.forEach(g=>C(g)),t.value=t.value.filter(g=>g.sn!==c.frag.sn)}}async function O(){return n.getEventTracking().then(o=>{for(const c of(o==null?void 0:o.avails)||[])for(const a of c.ads){const g=`${c.id}_${a.id}_${a.startTimeInSeconds}`;for(const v of a.trackingEvents){const b=`${g}_${v.eventType}`;l.value.find(M=>M.key===b)||l.value.push({...v,key:b,ad:{...a,key:g},tracked:!1})}}})}function N(){return async(o,c)=>{function a(b){for(let S=0;S<b.length;S++)if(b[S]===0)return S;return b.length}const{start:g,sn:v}=c.frag;for(let b=0;b<c.samples.length;b++){const S=c.samples[b],M=S.data,L=S.pts;if(String.fromCharCode.apply(null,M.slice(0,3))!=="ID3"||String.fromCharCode.apply(null,M.slice(10,14))!=="TXXX")continue;const j=M.slice(21,M.length),ee=a(j),G=j.slice(ee+1,j.length),te=a(G),re=new TextDecoder("utf-8").decode(G.slice(0,te)),U={sn:v,time:L-g,value:D(re)};if(h.value&&v<h.value)return;t.value.push(U),U.value.event==="start"&&O()}}}function R(){return o=>{const c=o.track;c.kind==="metadata"&&(c.oncuechange=async()=>{const a=c.activeCues[0];if(a&&a.value.data){console.debug("[LOG] ~ elemTrack:",a),await O();const g=D(a.value.data);console.debug("[LOG] ~ trackingEvent:",g),C({value:g})}})}}function E(o,c){i.on(a=>{(o==="*"||a.eventType===o)&&c(a)})}function _(){p.value=void 0,t.value=[],k.forEach((o,c)=>{e.removeEventListener(c,o)}),k.clear(),Pe(A)}function u(){return{eventTracking:t,trackingDataEvent:l}}return{destroy:_,onEventTracking:E,hlsHelper:{createHlsFragChanged:T,createHlsFragParsingMetadata:N},videojsHelper:{createVideojsAddTrack:R},getLog:u}}async function ze({video:e,adContainer:r,adsUrl:s}){await De();const n=new q;await n.init("https://cdn.jsdelivr.net/gh/sigmaott/sigma-ssai-web-sdk/v6/build/dist/sigma-cspm.wasm");function i(){}const{onEventTracking:y,destroy:p,videojsHelper:f,hlsHelper:w,getLog:d}=Ue({video:e,adContainer:r,trackingUrl:"",startSession:i,sdk:n}),t=I(),h=I();function l(T){T.config.loader=x({adsUrl:s,sdk:n,loader:Hls.DefaultConfig.loader}),t.value=T;const O=w.createHlsFragChanged(),N=w.createHlsFragParsingMetadata();T.on("hlsFragChanged",O),T.on("hlsFragParsingMetadata",N),T.on(Hls.Events.ERROR,(R,E)=>{console.error("HLS Error:",R,E),E.type===window.Hls.ErrorTypes.NETWORK_ERROR?console.error("Network Error:",E.details):E.type===window.Hls.ErrorTypes.MEDIA_ERROR?console.error("Media Error:",E.details):console.error("Other Error:",E.details)}),h.value=()=>{T.off("hlsFragChanged",O),T.off("hlsFragParsingMetadata",N)}}function m(T){T.hls.config.loader=x({adsUrl:s,sdk:n,loader:SigmaManager.DefaultConfig.loader}),t.value=T.hls;const O=w.createHlsFragChanged(),N=w.createHlsFragParsingMetadata();T.hls.on("hlsFragChanged",O),T.hls.on("hlsFragParsingMetadata",N),T.on(SigmaManager.Events.ERROR,(R,E)=>{console.log("[LOG] ~ event:",R),console.error("HLS Error:",R,E),E.type===window.Hls.ErrorTypes.NETWORK_ERROR?console.error("Network Error:",E.details):E.type===window.Hls.ErrorTypes.MEDIA_ERROR?console.error("Media Error:",E.details):console.error("Other Error:",E.details)}),h.value=()=>{T.hls.destroy()}}const k=I(),A=I();function F(T){const O={proxyAds:{uri:s,timeout:2}};(function(R){const E=R.Vhs.PlaylistLoader.prototype.setupInitialPlaylist;R.Vhs.PlaylistLoader.prototype.setupInitialPlaylist=async function(_){if(_.manifestString)try{const u=_.manifestString;await n.loadSource({config:O,manifest:_.manifestString,masterUri:this.src})}catch(u){console.error("Error loading source:",u)}E.apply(this,[_])}})(videojs),function(R){const E=R.Vhs.PlaylistLoader.prototype.haveMetadata;R.Vhs.PlaylistLoader.prototype.haveMetadata=async function({playlistString:_,playlistObject:u,url:o,id:c}){console.log("state",_,u,o,c);try{_&&(_=await n.loadSource({config:O,manifest:_,masterUri:this.main.playlists[c].resolvedUri})),E.apply(this,[{playlistString:_,playlistObject:u,url:o,id:c}])}catch(a){console.error("Error loading source:",a)}}}(videojs),function(R){const E=R.Vhs.PlaylistLoader.prototype.parseManifest_;R.Vhs.PlaylistLoader.prototype.parseManifest_=function({url:_,manifestString:u}){const o=E.apply(this,[{url:_,manifestString:u}]);return o.playlists&&o.playlists.length&&(o.manifestString=u),o}}(videojs),function(R){const E=(u,o)=>{const c=u.segments||[],a=c[c.length-1],g=a&&a.parts&&a.parts[a.parts.length-1],v=g&&g.duration||a&&a.duration;return v?v*1e3:(u.partTargetDuration||u.targetDuration||10)*500},_=(u,o)=>o&&o.responseURL&&u!==o.responseURL?o.responseURL:u;R.Vhs.PlaylistLoader.prototype.media=function(u,o){if(!u)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof u=="string"){if(!this.main.playlists[u])throw new Error("Unknown playlist URI: "+u);u=this.main.playlists[u]}if(window.clearTimeout(this.finalRenditionTimeout),o){const b=(u.partTargetDuration||u.targetDuration)/2*1e3||5e3;console.log("Delay:",b),this.finalRenditionTimeout=window.setTimeout(this.media.bind(this,u,!1),b);return}const c=this.state,a=!this.media_||u.id!==this.media_.id,g=this.main.playlists[u.id];if(g&&g.endList||u.endList&&u.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=u,a&&(this.trigger("mediachanging"),c==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(E(u)),!a)return;if(this.state="SWITCHING_MEDIA",this.request){if(u.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=u;const v={playlistInfo:{type:"media",uri:u.uri}};this.trigger({type:"playlistrequeststart",metadata:v}),this.request=this.vhs_.xhr({uri:u.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(b,S)=>{if(this.request){if(u.lastRequest=Date.now(),u.resolvedUri=_(u.resolvedUri,S),b)return this.playlistRequestError(this.request,u,c);this.haveMetadata({playlistString:S.responseText,url:u.uri,id:u.id}).then(()=>{this.trigger({type:"playlistrequestcomplete",metadata:v}),c==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")})}})}}(videojs),k.value=T;const N=f.createVideojsAddTrack();T.textTracks().on("addtrack",N),A.value=()=>{T.textTracks().off("addtrack",N)}}function C(){var T,O;p(),(T=h.value)==null||T.call(h),(O=A.value)==null||O.call(A),t.value=null,k.value=null,h.value=null,A.value=null}return{onEventTracking:y,destroy:C,sigmaPlayer:{attachVideojs:F,attachHls:l,attachSigmaDrm:m,attachVideojs2:F,getLog:d},sdk:n}}const xe=(e,r)=>{const s=e.__vccOpts||e;for(const[n,i]of r)s[n]=i;return s};export{xe as _,ze as c,He as l};
