import{k as se,l as H,r as O,m as ne,p as oe,g as ie,n as ae}from"./index-iyQ0fk6r.js";import{c as ce}from"./zoid-DaRsBbJ-.js";import{l as ue}from"./loadScript-wOdhQs3s.js";const le=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,de=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,fe=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function pe(e,r){if(e==="__proto__"||e==="constructor"&&r&&typeof r=="object"&&"prototype"in r){he(e);return}return r}function he(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function j(e,r={}){if(typeof e!="string")return e;const n=e.trim();if(e[0]==='"'&&e.endsWith('"')&&!e.includes("\\"))return n.slice(1,-1);if(n.length<=9){const s=n.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!fe.test(e)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(le.test(e)||de.test(e)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,pe)}return JSON.parse(e)}catch(s){if(r.strict)throw s;return e}}class me extends Error{constructor(r,n){super(r,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function ge(e){var d,c,t,m,l;const r=((d=e.error)==null?void 0:d.message)||((c=e.error)==null?void 0:c.toString())||"",n=((t=e.request)==null?void 0:t.method)||((m=e.options)==null?void 0:m.method)||"GET",s=((l=e.request)==null?void 0:l.url)||String(e.request)||"/",o=`[${n}] ${JSON.stringify(s)}`,u=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",a=`${o}: ${u}${r?` ${r}`:""}`,i=new me(a,e.error?{cause:e.error}:void 0);for(const g of["request","options","response"])Object.defineProperty(i,g,{get(){return e[g]}});for(const[g,T]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(i,g,{get(){return e.response&&e.response[T]}});return i}const ye=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function V(e="GET"){return ye.has(e.toUpperCase())}function we(e){if(e===void 0)return!1;const r=typeof e;return r==="string"||r==="number"||r==="boolean"||r===null?!0:r!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const Te=new Set(["image/svg","application/xml","application/xhtml","application/html"]),Ee=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function ve(e=""){if(!e)return"json";const r=e.split(";").shift()||"";return Ee.test(r)?"json":Te.has(r)||r.startsWith("text/")?"text":"blob"}function be(e,r,n=globalThis.Headers){const s={...r,...e};if(r!=null&&r.params&&(e!=null&&e.params)&&(s.params={...r==null?void 0:r.params,...e==null?void 0:e.params}),r!=null&&r.query&&(e!=null&&e.query)&&(s.query={...r==null?void 0:r.query,...e==null?void 0:e.query}),r!=null&&r.headers&&(e!=null&&e.headers)){s.headers=new n((r==null?void 0:r.headers)||{});for(const[o,u]of new n((e==null?void 0:e.headers)||{}))s.headers.set(o,u)}return s}const Re=new Set([408,409,425,429,500,502,503,504]),ke=new Set([101,204,205,304]);function K(e={}){const{fetch:r=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:s=globalThis.AbortController}=e;async function o(i){const d=i.error&&i.error.name==="AbortError"&&!i.options.timeout||!1;if(i.options.retry!==!1&&!d){let t;typeof i.options.retry=="number"?t=i.options.retry:t=V(i.options.method)?0:1;const m=i.response&&i.response.status||500;if(t>0&&(Array.isArray(i.options.retryStatusCodes)?i.options.retryStatusCodes.includes(m):Re.has(m))){const l=i.options.retryDelay||0;return l>0&&await new Promise(g=>setTimeout(g,l)),u(i.request,{...i.options,retry:t-1})}}const c=ge(i);throw Error.captureStackTrace&&Error.captureStackTrace(c,u),c}const u=async function(d,c={}){var g;const t={request:d,options:be(c,e.defaults,n),response:void 0,error:void 0};t.options.method=(g=t.options.method)==null?void 0:g.toUpperCase(),t.options.onRequest&&await t.options.onRequest(t),typeof t.request=="string"&&(t.options.baseURL&&(t.request=se(t.request,t.options.baseURL)),(t.options.query||t.options.params)&&(t.request=H(t.request,{...t.options.params,...t.options.query}))),t.options.body&&V(t.options.method)&&(we(t.options.body)?(t.options.body=typeof t.options.body=="string"?t.options.body:JSON.stringify(t.options.body),t.options.headers=new n(t.options.headers||{}),t.options.headers.has("content-type")||t.options.headers.set("content-type","application/json"),t.options.headers.has("accept")||t.options.headers.set("accept","application/json")):("pipeTo"in t.options.body&&typeof t.options.body.pipeTo=="function"||typeof t.options.body.pipe=="function")&&("duplex"in t.options||(t.options.duplex="half")));let m;if(!t.options.signal&&t.options.timeout){const T=new s;m=setTimeout(()=>T.abort(),t.options.timeout),t.options.signal=T.signal}try{t.response=await r(t.request,t.options)}catch(T){return t.error=T,t.options.onRequestError&&await t.options.onRequestError(t),await o(t)}finally{m&&clearTimeout(m)}if(t.response.body&&!ke.has(t.response.status)&&t.options.method!=="HEAD"){const T=(t.options.parseResponse?"json":t.options.responseType)||ve(t.response.headers.get("content-type")||"");switch(T){case"json":{const _=await t.response.text(),A=t.options.parseResponse||j;t.response._data=A(_);break}case"stream":{t.response._data=t.response.body;break}default:t.response._data=await t.response[T]()}}return t.options.onResponse&&await t.options.onResponse(t),!t.options.ignoreResponseError&&t.response.status>=400&&t.response.status<600?(t.options.onResponseError&&await t.options.onResponseError(t),await o(t)):t.response},a=async function(d,c){return(await u(d,c))._data};return a.raw=u,a.native=(...i)=>r(...i),a.create=(i={})=>K({...e,defaults:{...e.defaults,...i}}),a}const D=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),_e=D.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),Me=D.Headers,Se=D.AbortController,Oe=K({fetch:_e,Headers:Me,AbortController:Se}),Ae=Oe.create({credentials:"omit",onResponseError({response:e,error:r}){console.log("[LOG] ~ error:",r)},onRequest:({options:e,request:r})=>{const n=e.token;n&&(e.headers=e.headers||{},e.headers.Authorization=`${n}`)},onResponse({response:e,options:r}){}}),Le=e=>(r,n)=>(e.set(r,n),n),B=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,Y=536870912,J=Y*2,Fe=(e,r)=>n=>{const s=r.get(n);let o=s===void 0?n.size:s<J?s+1:0;if(!n.has(o))return e(n,o);if(n.size<Y){for(;n.has(o);)o=Math.floor(Math.random()*J);return e(n,o)}if(n.size>B)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;n.has(o);)o=Math.floor(Math.random()*B);return e(n,o)},Q=new WeakMap,Ie=Le(Q),C=Fe(Ie,Q),qe=e=>e.method!==void 0&&e.method==="call",Ne=e=>typeof e.id=="number"&&typeof e.result=="boolean",Pe=e=>{const r=new Map([[0,()=>{}]]),n=new Map([[0,()=>{}]]),s=new Map,o=new Worker(e);return o.addEventListener("message",({data:c})=>{if(qe(c)){const{params:{timerId:t,timerType:m}}=c;if(m==="interval"){const l=r.get(t);if(typeof l===void 0)throw new Error("The timer is in an undefined state.");if(typeof l=="number"){const g=s.get(l);if(g===void 0||g.timerId!==t||g.timerType!==m)throw new Error("The timer is in an undefined state.")}else typeof l=="function"&&l()}else if(m==="timeout"){const l=n.get(t);if(typeof l===void 0)throw new Error("The timer is in an undefined state.");if(typeof l=="number"){const g=s.get(l);if(g===void 0||g.timerId!==t||g.timerType!==m)throw new Error("The timer is in an undefined state.")}else typeof l=="function"&&(l(),n.delete(t))}}else if(Ne(c)){const{id:t}=c,m=s.get(t);if(m===void 0)throw new Error("The timer is in an undefined state.");const{timerId:l,timerType:g}=m;s.delete(t),g==="interval"?r.delete(l):n.delete(l)}else{const{error:{message:t}}=c;throw new Error(t)}}),{clearInterval:c=>{if(typeof r.get(c)=="function"){const t=C(s);s.set(t,{timerId:c,timerType:"interval"}),r.set(c,t),o.postMessage({id:t,method:"clear",params:{timerId:c,timerType:"interval"}})}},clearTimeout:c=>{if(typeof n.get(c)=="function"){const t=C(s);s.set(t,{timerId:c,timerType:"timeout"}),n.set(c,t),o.postMessage({id:t,method:"clear",params:{timerId:c,timerType:"timeout"}})}},setInterval:(c,t=0,...m)=>{const l=C(r);return r.set(l,()=>{c(...m),typeof r.get(l)=="function"&&o.postMessage({id:null,method:"set",params:{delay:t,now:performance.timeOrigin+performance.now(),timerId:l,timerType:"interval"}})}),o.postMessage({id:null,method:"set",params:{delay:t,now:performance.timeOrigin+performance.now(),timerId:l,timerType:"interval"}}),l},setTimeout:(c,t=0,...m)=>{const l=C(n);return n.set(l,()=>c(...m)),o.postMessage({id:null,method:"set",params:{delay:t,now:performance.timeOrigin+performance.now(),timerId:l,timerType:"timeout"}}),l}}},Ue=(e,r)=>{let n=null;return()=>{if(n!==null)return n;const s=new Blob([r],{type:"application/javascript; charset=utf-8"}),o=URL.createObjectURL(s);return n=e(o),setTimeout(()=>URL.revokeObjectURL(o)),n}},Ce=`(()=>{"use strict";const e=new Map,t=new Map,r=t=>{const r=e.get(t);return void 0!==r&&(clearTimeout(r),e.delete(t),!0)},s=e=>{const r=t.get(e);return void 0!==r&&(clearTimeout(r),t.delete(e),!0)},o=(e,t)=>{const r=performance.now(),s=e+t-r-performance.timeOrigin;return{expected:r+s,remainingDelay:s}},i=(e,t,r,s)=>{const o=r-performance.now();o>0?e.set(t,setTimeout(i,o,e,t,r,s)):(e.delete(t),postMessage({id:null,method:"call",params:{timerId:t,timerType:s}}))};addEventListener("message",(n=>{let{data:a}=n;try{if("clear"===a.method){const{id:e,params:{timerId:t,timerType:o}}=a;if("interval"===o)postMessage({id:e,result:r(t)});else{if("timeout"!==o)throw new Error('The given type "'.concat(o,'" is not supported'));postMessage({id:e,result:s(t)})}}else{if("set"!==a.method)throw new Error('The given method "'.concat(a.method,'" is not supported'));{const{params:{delay:r,now:s,timerId:n,timerType:m}}=a;if("interval"===m)((t,r,s)=>{const{expected:n,remainingDelay:a}=o(t,s);e.set(r,setTimeout(i,a,e,r,n,"interval"))})(r,n,s);else{if("timeout"!==m)throw new Error('The given type "'.concat(m,'" is not supported'));((e,r,s)=>{const{expected:n,remainingDelay:a}=o(e,s);t.set(r,setTimeout(i,a,t,r,n,"timeout"))})(r,n,s)}}}}catch(e){postMessage({error:{message:e.message},id:a.id,result:null})}}))})();`,Z=Ue(Pe,Ce),He=e=>Z().clearTimeout(e),z=(...e)=>Z().setTimeout(...e);function $e(){const e=new Set,r=o=>{e.delete(o)};return{on:o=>(e.add(o),{off:()=>r(o)}),off:r,trigger:(...o)=>Promise.all(Array.from(e).map(u=>u(...o)))}}async function je(e){try{return{data:await e,error:null}}catch(r){return{data:null,error:r||{message:"Unknown error"}}}}const De="https://cdn.jsdelivr.net/gh/sigmaott/sigma-ssai-web-sdk/v6/build/dist/wasm_exec.js";let I=null;function x(){I=null}function Ge(){const e=window;return e.Go?Promise.resolve(e.wasm):I||(I=ue(De).then(()=>e.Go),I.then(x).catch(x),I)}class q{constructor(){return q.instance?q.instance:(this.session=null,this.go=null,this.buffer=null,this.audioMediaSequence={},q.instance=this,this)}async init(r){if(!this.buffer){const s=await(await fetch(r)).arrayBuffer();this.buffer=s}return q.instance}async loadSource(r){this.session&&(r.session=this.session);const n=JSON.stringify(r),s=new Go,o=await WebAssembly.instantiate(this.buffer,s.importObject);s.run(o.instance);let u;for(let a=1;a<=3;a++)try{u=await window.loadSource(n);break}catch(i){if(console.log(`Attempt ${a} failed:`,i),a===3)throw console.log("session:",this.session),console.log(n),i}if(u.session!=""&&(this.session=u.session),u.error)throw new Error(u.error);return u.manifest}async getEventTracking(){if(this.session){const r=window.getEventTracking(this.session);if(r.error)throw new Error(r.error);return{avails:JSON.parse(r.avails)}}return null}}const We=O(),Ve=O();function X({adsUrl:e,sdk:r,loader:n}){return class extends n{constructor(o){super(o)}load(o,u,a){const i=a.onSuccess;a.onSuccess=async(d,c,t)=>{(t.type==="manifest"||t.type==="level"||t.type==="audioTrack")&&(d.data=await this.modifyManifest(d.url,d.data,t.type)),i(d,c,t)},super.load(o,u,a)}async modifyManifest(o,u,a){We.value=u;const i={proxyAds:{uri:e,timeout:2}};try{const d=await r.loadSource({config:i,manifest:u,masterUri:o});return console.log("[LOG] ~ newManifest:",d),Ve.value=d,d}catch(d){return console.error("[LOG] ~ error:",d),u}}}}function Be({video:e,adContainer:r,startSession:n,sdk:s}){const o=$e(),u=O(!1),a=O(),i=Math.random().toString(36).slice(6);function d({icons:f}){return{id:i,appConfig:{sdkBaseUrl:H("https://cdn.jsdelivr.net/gh/sigmaott/sigma-ssai-web-sdk/v6/build/dist/wta/index.html",{id:i})},icons:f}}const c=ce(d({icons:[]}));c.render(r),c.hide(),r.style.display="none",ne(()=>{var f;if(a.value){const p=((f=a.value)==null?void 0:f.icons)||[];r.style.display="block",c.updateProps(d({icons:p})),c.show()}else r.style.display="none",c.hide()});const t=O([]),m=O(),l=O([]);async function g(f){var h;console.log("[LOG] ~ currentAd:",a);const p=(h=a.value)==null?void 0:h.trackingEvents.find(y=>y.eventType===f);if(!p){console.debug("[LOG] ~ event:",f);return}o.trigger(p),await Promise.all(p.beaconUrls.map(y=>je(Ae(y,{retry:3,retryDelay:500}))))}const T=new Map;let _;function A(f,p,h){f.addEventListener(p,h),T.set(p,h)}function N(f){var R,M;const p=((f==null?void 0:f.time)||0)>0?f.time:0,h=(R=f==null?void 0:f.value)==null?void 0:R.event;console.debug("[LOG] ~ eventType:",h);const y=l.value.find(E=>E.eventType===h&&!E.tracked&&!E.skipped);if(console.debug("[LOG] ~ eventAd:",y),!y)return;const b=y==null?void 0:y.ad;if(console.debug("[LOG] ~ ad:",b),!!b){if(h==="start")a.value&&l.value.filter(S=>S.key.startsWith(`${a.value.key}_`)).forEach(S=>S.skipped=!0),a.value=b,n(b.adVerifications,o),_=z(()=>{g("impression"),g("start");const E=l.value.find(S=>S.key===y.key.replace("_start","_impression"));E&&(E.tracked=!0),y.tracked=!0},p*1e3);else{if(!a.value){console.debug("[LOG] ~ eventType:",h);return}if(b.id!==((M=a.value)==null?void 0:M.id)){console.debug("[ERROR] ~ ad:",b),console.debug("[ERROR] ~ currentAd:",a.value),l.value.filter(S=>S.key.startsWith(`${a.value.key}_`)).forEach(S=>S.skipped=!0);return}_=z(()=>{g(h),h==="complete"&&b.id===a.value.id&&(a.value=void 0),y.tracked=!0},p*1e3)}console.debug("========================================")}}function P(){return u.value=!1,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].forEach(f=>{A(e,f,()=>{const p=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;g(p?"fullscreen":"exitFullscreen")})}),A(e,"pause",()=>g("pause")),A(e,"play",()=>g("resume")),A(e,"rewind",()=>g("rewind")),A(e,"mute",()=>g("mute")),A(e,"unmute",()=>g("unmute")),async(f,p)=>{if(m.value=p.frag.sn,f!==window.Hls.Events.FRAG_CHANGED)return;const h=t.value.filter(y=>y.sn===p.frag.sn);if(!h.length){console.debug("[LOG] ~ trackingEvent:",h);return}h.forEach(y=>N(y)),t.value=t.value.filter(y=>y.sn!==p.frag.sn)}}async function U(){return s.getEventTracking().then(f=>{for(const p of(f==null?void 0:f.avails)||[])for(const h of p.ads){const y=`${p.id}_${h.id}_${h.startTimeInSeconds}`;for(const b of h.trackingEvents){const R=`${y}_${b.eventType}`;l.value.find(E=>E.key===R)||l.value.push({...b,key:R,ad:{...h,key:y},tracked:!1})}}})}function w(){return async(f,p)=>{function h(R){for(let M=0;M<R.length;M++)if(R[M]===0)return M;return R.length}const{start:y,sn:b}=p.frag;for(let R=0;R<p.samples.length;R++){const M=p.samples[R],E=M.data,S=M.pts;if(String.fromCharCode.apply(null,E.slice(0,3))!=="ID3"||String.fromCharCode.apply(null,E.slice(10,14))!=="TXXX")continue;const $=E.slice(21,E.length),ee=h($),G=$.slice(ee+1,$.length),te=h(G),re=new TextDecoder("utf-8").decode(G.slice(0,te)),W={sn:b,time:S-y,value:j(re)};if(m.value&&b<m.value)return;t.value.push(W),W.value.event==="start"&&U()}}}function k(){return f=>{const p=f.track;p.kind==="metadata"&&(p.oncuechange=async()=>{const h=p.activeCues[0];if(h&&h.value.data){console.debug("[LOG] ~ elemTrack:",h),await U();const y=j(h.value.data);console.debug("[LOG] ~ trackingEvent:",y),N({value:y})}})}}function L(f,p){o.on(h=>{(f==="*"||h.eventType===f)&&p(h)})}function F(){a.value=void 0,t.value=[],T.forEach((f,p)=>{e.removeEventListener(p,f)}),T.clear(),He(_)}function v(){return{eventTracking:t,trackingDataEvent:l}}return{destroy:F,onEventTracking:L,hlsHelper:{createHlsFragChanged:P,createHlsFragParsingMetadata:w},videojsHelper:{createVideojsAddTrack:k},getLog:v}}async function Qe({video:e,adContainer:r,adsUrl:n}){await Ge();const s=new q;await s.init("https://cdn.jsdelivr.net/gh/sigmaott/sigma-ssai-web-sdk/v6/build/dist/sigma-cspm.wasm");function o(){}const{onEventTracking:u,destroy:a,videojsHelper:i,hlsHelper:d,getLog:c}=Be({video:e,adContainer:r,trackingUrl:"",startSession:o,sdk:s}),t=O(),m=O();function l(w){w.config.loader=X({adsUrl:n,sdk:s,loader:Hls.DefaultConfig.loader}),t.value=w;const k=d.createHlsFragChanged(),L=d.createHlsFragParsingMetadata();w.on("hlsFragChanged",k),w.on("hlsFragParsingMetadata",L),w.on(Hls.Events.ERROR,(F,v)=>{console.error("HLS Error:",F,v),v.type===window.Hls.ErrorTypes.NETWORK_ERROR?console.error("Network Error:",v.details):v.type===window.Hls.ErrorTypes.MEDIA_ERROR?console.error("Media Error:",v.details):console.error("Other Error:",v.details)}),m.value=()=>{w.off("hlsFragChanged",k),w.off("hlsFragParsingMetadata",L)}}function g(w){w.hls.config.loader=X({adsUrl:n,sdk:s,loader:SigmaManager.DefaultConfig.loader}),t.value=w.hls;const k=d.createHlsFragChanged(),L=d.createHlsFragParsingMetadata();w.hls.on("hlsFragChanged",k),w.hls.on("hlsFragParsingMetadata",L),w.on(SigmaManager.Events.ERROR,(F,v)=>{console.log("[LOG] ~ event:",F),console.error("HLS Error:",F,v),v.type===window.Hls.ErrorTypes.NETWORK_ERROR?console.error("Network Error:",v.details):v.type===window.Hls.ErrorTypes.MEDIA_ERROR?console.error("Media Error:",v.details):console.error("Other Error:",v.details)}),m.value=()=>{w.hls.destroy()}}const T=O(),_=O(),N={instance:s,config:{proxyAds:{uri:n,timeout:2}}};function P(w){T.value=w;const k=i.createVideojsAddTrack();w.textTracks().on("addtrack",k),_.value=()=>{w.textTracks().off("addtrack",k)}}function U(){var w,k;a(),(w=m.value)==null||w.call(m),(k=_.value)==null||k.call(_),t.value=null,T.value=null,m.value=null,_.value=null}return{onEventTracking:u,destroy:U,sigmaPlayer:{attachVideojs:P,attachHls:l,attachSigmaDrm:g,attachVideojs2:P,getLog:c},sdk:s,cspm:N}}(function(e){const r=e.Vhs.PlaylistLoader.prototype.setupInitialPlaylist;e.Vhs.PlaylistLoader.prototype.setupInitialPlaylist=async function(n){if(n.manifestString)try{const s=n.manifestString;await this.vhs_.options_.cspm.instance.loadSource({config:this.vhs_.options_.cspm.config,manifest:n.manifestString,masterUri:this.src})}catch(s){console.error("Error loading source:",s)}r.apply(this,[n])}})(videojs);(function(e){const r=e.Vhs.PlaylistLoader.prototype.haveMetadata;e.Vhs.PlaylistLoader.prototype.haveMetadata=async function({playlistString:n,playlistObject:s,url:o,id:u}){const a=this.vhs_.options_.cspm.config;console.log("state",n,s,o,u);try{if(n){const i=await this.vhs_.options_.cspm.instance.loadSource({config:a,manifest:n,masterUri:this.main.playlists[u].resolvedUri});console.log("Updated Manifest:",this.main.playlists[u].resolvedUri),n=i}r.apply(this,[{playlistString:n,playlistObject:s,url:o,id:u}])}catch(i){console.error("Error loading source:",i)}}})(videojs);(function(e){const r=e.Vhs.PlaylistLoader.prototype.parseManifest_;e.Vhs.PlaylistLoader.prototype.parseManifest_=function({url:n,manifestString:s}){const o=r.apply(this,[{url:n,manifestString:s}]);return o.playlists&&o.playlists.length&&(o.manifestString=s),o}})(videojs);(function(e){const r=(s,o)=>{const u=s.segments||[],a=u[u.length-1],i=a&&a.parts&&a.parts[a.parts.length-1],d=i&&i.duration||a&&a.duration;return d?d*1e3:(s.partTargetDuration||s.targetDuration||10)*500},n=(s,o)=>o&&o.responseURL&&s!==o.responseURL?o.responseURL:s;e.Vhs.PlaylistLoader.prototype.media=function(s,o){if(!s)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error(`Cannot switch media playlist from ${this.state}`);if(typeof s=="string"){if(!this.main.playlists[s])throw new Error(`Unknown playlist URI: ${s}`);s=this.main.playlists[s]}if(window.clearTimeout(this.finalRenditionTimeout),o){const c=(s.partTargetDuration||s.targetDuration)/2*1e3||5e3;console.log("Delay:",c),this.finalRenditionTimeout=window.setTimeout(this.media.bind(this,s,!1),c);return}const u=this.state,a=!this.media_||s.id!==this.media_.id,i=this.main.playlists[s.id];if(i&&i.endList||s.endList&&s.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=s,a&&(this.trigger("mediachanging"),u==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(r(s)),!a)return;if(this.state="SWITCHING_MEDIA",this.request){if(s.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=s;const d={playlistInfo:{type:"media",uri:s.uri}};this.trigger({type:"playlistrequeststart",metadata:d}),this.request=this.vhs_.xhr({uri:s.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(c,t)=>{if(this.request){if(s.lastRequest=Date.now(),s.resolvedUri=n(s.resolvedUri,t),c)return this.playlistRequestError(this.request,s,u);this.haveMetadata({playlistString:t.responseText,url:s.uri,id:s.id}).then(()=>{this.trigger({type:"playlistrequestcomplete",metadata:d}),u==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")})}})}})(videojs);function Ze(e){console.log("🚀 ~ file: sdk.ts:250 ~ url:",e);const r="https://dai.sigma.video/api/proxy-ads/ads/",n=oe(e),s=`${n.protocol}//${n.host}${n.pathname}`;if(!n.search)return{playerUrl:e,adsUrl:null};const o=ie(e),u=o["sigma.dai.adsEndpoint"];if(!u)return{playerUrl:e,adsUrl:null};const a={},i={};for(const[c,t]of Object.entries(o))c.startsWith("sigma.dai")?c!=="sigma.dai.adsEndpoint"&&(a[c.replace("sigma.dai.","")]=t):i[c]=t;return{playerUrl:H(s,i),adsUrl:H(ae(r,u),a)}}export{Qe as c,Ze as p};
