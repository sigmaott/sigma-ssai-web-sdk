import{j as K,k as L,d as _,r as D,g as F,o as q,c as x,a as E,w as B,v as V,b as k,F as j,e as W,f as M,t as Q,h as z}from"./zoid-bW7f30cY.js";import{c as J,_ as Z}from"./export-helper-BuyjKZW-.js";var $=function(){function f(){this.listeners={}}var a=f.prototype;return a.on=function(t,u){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(u)},a.off=function(t,u){if(!this.listeners[t])return!1;var s=this.listeners[t].indexOf(u);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(s,1),s>-1},a.trigger=function(t){var u=this.listeners[t];if(u)if(arguments.length===2)for(var s=u.length,r=0;r<s;++r)u[r].call(this,arguments[1]);else for(var o=Array.prototype.slice.call(arguments,1),T=u.length,R=0;R<T;++R)u[R].apply(this,o)},a.dispose=function(){this.listeners={}},a.pipe=function(t){this.on("data",function(u){t.push(u)})},f}();function P(){return P=Object.assign?Object.assign.bind():function(f){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var t in e)({}).hasOwnProperty.call(e,t)&&(f[t]=e[t])}return f},P.apply(null,arguments)}var v;typeof window<"u"?v=window:typeof L<"u"?v=L:typeof self<"u"?v=self:v={};var tt=v;const Y=K(tt);var et=function(a){return Y.atob?Y.atob(a):Buffer.from(a,"base64").toString("binary")};function it(f){for(var a=et(f),e=new Uint8Array(a.length),t=0;t<a.length;t++)e[t]=a.charCodeAt(t);return e}/*! @name m3u8-parser @version 7.1.0 @license Apache-2.0 */class at extends ${constructor(){super(),this.buffer=""}push(a){let e;for(this.buffer+=a,e=this.buffer.indexOf(`
`);e>-1;e=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)}}const st="	",U=function(f){const a=/([0-9.]*)?@?([0-9.]*)?/.exec(f||""),e={};return a[1]&&(e.length=parseInt(a[1],10)),a[2]&&(e.offset=parseInt(a[2],10)),e},rt=function(){const e="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+e+")")},b=function(f){const a={};if(!f)return a;const e=f.split(rt());let t=e.length,u;for(;t--;)e[t]!==""&&(u=/([^=]*)=(.*)/.exec(e[t]).slice(1),u[0]=u[0].replace(/^\s+|\s+$/g,""),u[1]=u[1].replace(/^\s+|\s+$/g,""),u[1]=u[1].replace(/^['"](.*)['"]$/g,"$1"),a[u[0]]=u[1]);return a};class nt extends ${constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(a){let e,t;if(a=a.trim(),a.length===0)return;if(a[0]!=="#"){this.trigger("data",{type:"uri",uri:a});return}this.tagMappers.reduce((s,r)=>{const o=r(a);return o===a?s:s.concat([o])},[a]).forEach(s=>{for(let r=0;r<this.customParsers.length;r++)if(this.customParsers[r].call(this,s))return;if(s.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:s.slice(1)});return}if(s=s.replace("\r",""),e=/^#EXTM3U/.exec(s),e){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(e=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(s),e){t={type:"tag",tagType:"inf"},e[1]&&(t.duration=parseFloat(e[1])),e[2]&&(t.title=e[2]),this.trigger("data",t);return}if(e=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(s),e){t={type:"tag",tagType:"targetduration"},e[1]&&(t.duration=parseInt(e[1],10)),this.trigger("data",t);return}if(e=/^#EXT-X-VERSION:([0-9.]*)?/.exec(s),e){t={type:"tag",tagType:"version"},e[1]&&(t.version=parseInt(e[1],10)),this.trigger("data",t);return}if(e=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(s),e){t={type:"tag",tagType:"media-sequence"},e[1]&&(t.number=parseInt(e[1],10)),this.trigger("data",t);return}if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(s),e){t={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(t.number=parseInt(e[1],10)),this.trigger("data",t);return}if(e=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(s),e){t={type:"tag",tagType:"playlist-type"},e[1]&&(t.playlistType=e[1]),this.trigger("data",t);return}if(e=/^#EXT-X-BYTERANGE:(.*)?$/.exec(s),e){t=P(U(e[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",t);return}if(e=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(s),e){t={type:"tag",tagType:"allow-cache"},e[1]&&(t.allowed=!/NO/.test(e[1])),this.trigger("data",t);return}if(e=/^#EXT-X-MAP:(.*)$/.exec(s),e){if(t={type:"tag",tagType:"map"},e[1]){const r=b(e[1]);r.URI&&(t.uri=r.URI),r.BYTERANGE&&(t.byterange=U(r.BYTERANGE))}this.trigger("data",t);return}if(e=/^#EXT-X-STREAM-INF:(.*)$/.exec(s),e){if(t={type:"tag",tagType:"stream-inf"},e[1]){if(t.attributes=b(e[1]),t.attributes.RESOLUTION){const r=t.attributes.RESOLUTION.split("x"),o={};r[0]&&(o.width=parseInt(r[0],10)),r[1]&&(o.height=parseInt(r[1],10)),t.attributes.RESOLUTION=o}t.attributes.BANDWIDTH&&(t.attributes.BANDWIDTH=parseInt(t.attributes.BANDWIDTH,10)),t.attributes["FRAME-RATE"]&&(t.attributes["FRAME-RATE"]=parseFloat(t.attributes["FRAME-RATE"])),t.attributes["PROGRAM-ID"]&&(t.attributes["PROGRAM-ID"]=parseInt(t.attributes["PROGRAM-ID"],10))}this.trigger("data",t);return}if(e=/^#EXT-X-MEDIA:(.*)$/.exec(s),e){t={type:"tag",tagType:"media"},e[1]&&(t.attributes=b(e[1])),this.trigger("data",t);return}if(e=/^#EXT-X-ENDLIST/.exec(s),e){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(e=/^#EXT-X-DISCONTINUITY/.exec(s),e){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(e=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(s),e){t={type:"tag",tagType:"program-date-time"},e[1]&&(t.dateTimeString=e[1],t.dateTimeObject=new Date(e[1])),this.trigger("data",t);return}if(e=/^#EXT-X-KEY:(.*)$/.exec(s),e){t={type:"tag",tagType:"key"},e[1]&&(t.attributes=b(e[1]),t.attributes.IV&&(t.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(t.attributes.IV=t.attributes.IV.substring(2)),t.attributes.IV=t.attributes.IV.match(/.{8}/g),t.attributes.IV[0]=parseInt(t.attributes.IV[0],16),t.attributes.IV[1]=parseInt(t.attributes.IV[1],16),t.attributes.IV[2]=parseInt(t.attributes.IV[2],16),t.attributes.IV[3]=parseInt(t.attributes.IV[3],16),t.attributes.IV=new Uint32Array(t.attributes.IV))),this.trigger("data",t);return}if(e=/^#EXT-X-START:(.*)$/.exec(s),e){t={type:"tag",tagType:"start"},e[1]&&(t.attributes=b(e[1]),t.attributes["TIME-OFFSET"]=parseFloat(t.attributes["TIME-OFFSET"]),t.attributes.PRECISE=/YES/.test(t.attributes.PRECISE)),this.trigger("data",t);return}if(e=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(s),e){t={type:"tag",tagType:"cue-out-cont"},e[1]?t.data=e[1]:t.data="",this.trigger("data",t);return}if(e=/^#EXT-X-CUE-OUT:(.*)?$/.exec(s),e){t={type:"tag",tagType:"cue-out"},e[1]?t.data=e[1]:t.data="",this.trigger("data",t);return}if(e=/^#EXT-X-CUE-IN:(.*)?$/.exec(s),e){t={type:"tag",tagType:"cue-in"},e[1]?t.data=e[1]:t.data="",this.trigger("data",t);return}if(e=/^#EXT-X-SKIP:(.*)$/.exec(s),e&&e[1]){t={type:"tag",tagType:"skip"},t.attributes=b(e[1]),t.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(t.attributes["SKIPPED-SEGMENTS"]=parseInt(t.attributes["SKIPPED-SEGMENTS"],10)),t.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(t.attributes["RECENTLY-REMOVED-DATERANGES"]=t.attributes["RECENTLY-REMOVED-DATERANGES"].split(st)),this.trigger("data",t);return}if(e=/^#EXT-X-PART:(.*)$/.exec(s),e&&e[1]){t={type:"tag",tagType:"part"},t.attributes=b(e[1]),["DURATION"].forEach(function(r){t.attributes.hasOwnProperty(r)&&(t.attributes[r]=parseFloat(t.attributes[r]))}),["INDEPENDENT","GAP"].forEach(function(r){t.attributes.hasOwnProperty(r)&&(t.attributes[r]=/YES/.test(t.attributes[r]))}),t.attributes.hasOwnProperty("BYTERANGE")&&(t.attributes.byterange=U(t.attributes.BYTERANGE)),this.trigger("data",t);return}if(e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(s),e&&e[1]){t={type:"tag",tagType:"server-control"},t.attributes=b(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(r){t.attributes.hasOwnProperty(r)&&(t.attributes[r]=parseFloat(t.attributes[r]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(r){t.attributes.hasOwnProperty(r)&&(t.attributes[r]=/YES/.test(t.attributes[r]))}),this.trigger("data",t);return}if(e=/^#EXT-X-PART-INF:(.*)$/.exec(s),e&&e[1]){t={type:"tag",tagType:"part-inf"},t.attributes=b(e[1]),["PART-TARGET"].forEach(function(r){t.attributes.hasOwnProperty(r)&&(t.attributes[r]=parseFloat(t.attributes[r]))}),this.trigger("data",t);return}if(e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(s),e&&e[1]){t={type:"tag",tagType:"preload-hint"},t.attributes=b(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(r){if(t.attributes.hasOwnProperty(r)){t.attributes[r]=parseInt(t.attributes[r],10);const o=r==="BYTERANGE-LENGTH"?"length":"offset";t.attributes.byterange=t.attributes.byterange||{},t.attributes.byterange[o]=t.attributes[r],delete t.attributes[r]}}),this.trigger("data",t);return}if(e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(s),e&&e[1]){t={type:"tag",tagType:"rendition-report"},t.attributes=b(e[1]),["LAST-MSN","LAST-PART"].forEach(function(r){t.attributes.hasOwnProperty(r)&&(t.attributes[r]=parseInt(t.attributes[r],10))}),this.trigger("data",t);return}if(e=/^#EXT-X-DATERANGE:(.*)$/.exec(s),e&&e[1]){t={type:"tag",tagType:"daterange"},t.attributes=b(e[1]),["ID","CLASS"].forEach(function(o){t.attributes.hasOwnProperty(o)&&(t.attributes[o]=String(t.attributes[o]))}),["START-DATE","END-DATE"].forEach(function(o){t.attributes.hasOwnProperty(o)&&(t.attributes[o]=new Date(t.attributes[o]))}),["DURATION","PLANNED-DURATION"].forEach(function(o){t.attributes.hasOwnProperty(o)&&(t.attributes[o]=parseFloat(t.attributes[o]))}),["END-ON-NEXT"].forEach(function(o){t.attributes.hasOwnProperty(o)&&(t.attributes[o]=/YES/i.test(t.attributes[o]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(o){t.attributes.hasOwnProperty(o)&&(t.attributes[o]=t.attributes[o].toString(16))});const r=/^X-([A-Z]+-)+[A-Z]+$/;for(const o in t.attributes){if(!r.test(o))continue;const T=/[0-9A-Fa-f]{6}/g.test(t.attributes[o]),R=/^\d+(\.\d+)?$/.test(t.attributes[o]);t.attributes[o]=T?t.attributes[o].toString(16):R?parseFloat(t.attributes[o]):String(t.attributes[o])}this.trigger("data",t);return}if(e=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(s),e){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(e=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(s),e){t={type:"tag",tagType:"content-steering"},t.attributes=b(e[1]),this.trigger("data",t);return}this.trigger("data",{type:"tag",data:s.slice(4)})})}addParser({expression:a,customType:e,dataParser:t,segment:u}){typeof t!="function"&&(t=s=>s),this.customParsers.push(s=>{if(a.exec(s))return this.trigger("data",{type:"custom",data:t(s),customType:e,segment:u}),!0})}addTagMapper({expression:a,map:e}){const t=u=>a.test(u)?e(u):u;this.tagMappers.push(t)}}const ot=f=>f.toLowerCase().replace(/-(\w)/g,a=>a[1].toUpperCase()),S=function(f){const a={};return Object.keys(f).forEach(function(e){a[ot(e)]=f[e]}),a},G=function(f){const{serverControl:a,targetDuration:e,partTargetDuration:t}=f;if(!a)return;const u="#EXT-X-SERVER-CONTROL",s="holdBack",r="partHoldBack",o=e&&e*3,T=t&&t*2;e&&!a.hasOwnProperty(s)&&(a[s]=o,this.trigger("info",{message:`${u} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&a[s]<o&&(this.trigger("warn",{message:`${u} clamping HOLD-BACK (${a[s]}) to targetDuration * 3 (${o})`}),a[s]=o),t&&!a.hasOwnProperty(r)&&(a[r]=t*3,this.trigger("info",{message:`${u} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${a[r]}).`})),t&&a[r]<T&&(this.trigger("warn",{message:`${u} clamping PART-HOLD-BACK (${a[r]}) to partTargetDuration * 2 (${T}).`}),a[r]=T)};class ut extends ${constructor(){super(),this.lineStream=new at,this.parseStream=new nt,this.lineStream.pipe(this.parseStream),this.lastProgramDateTime=null;const a=this,e=[];let t={},u,s,r=!1;const o=function(){},T={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},R="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let O=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],segments:[]};let p=0,d=0;const l={};this.on("end",()=>{t.uri||!t.parts&&!t.preloadHints||(!t.map&&u&&(t.map=u),!t.key&&s&&(t.key=s),!t.timeline&&typeof O=="number"&&(t.timeline=O),this.manifest.preloadSegment=t)}),this.parseStream.on("data",function(i){let y,A;({tag(){({version(){i.version&&(this.manifest.version=i.version)},"allow-cache"(){this.manifest.allowCache=i.allowed,"allowed"in i||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const g={};"length"in i&&(t.byterange=g,g.length=i.length,"offset"in i||(i.offset=p)),"offset"in i&&(t.byterange=g,g.offset=i.offset),p=g.offset+g.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),i.title&&(t.title=i.title),i.duration>0&&(t.duration=i.duration),i.duration===0&&(t.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=e},key(){if(!i.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(i.attributes.METHOD==="NONE"){s=null;return}if(!i.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(i.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:i.attributes};return}if(i.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:i.attributes.URI};return}if(i.attributes.KEYFORMAT===R){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(i.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(i.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),i.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(i.attributes.KEYID&&i.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:i.attributes.KEYFORMAT,keyId:i.attributes.KEYID.substring(2)},pssh:it(i.attributes.URI.split(",")[1])};return}i.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),s={method:i.attributes.METHOD||"AES-128",uri:i.attributes.URI},typeof i.attributes.IV<"u"&&(s.iv=i.attributes.IV)},"media-sequence"(){if(!isFinite(i.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+i.number});return}this.manifest.mediaSequence=i.number},"discontinuity-sequence"(){if(!isFinite(i.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+i.number});return}this.manifest.discontinuitySequence=i.number,O=i.number},"playlist-type"(){if(!/VOD|EVENT/.test(i.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+i.playlist});return}this.manifest.playlistType=i.playlistType},map(){u={},i.uri&&(u.uri=i.uri),i.byterange&&(u.byterange=i.byterange),s&&(u.key=s)},"stream-inf"(){if(this.manifest.playlists=e,this.manifest.mediaGroups=this.manifest.mediaGroups||T,!i.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}t.attributes||(t.attributes={}),P(t.attributes,i.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||T,!(i.attributes&&i.attributes.TYPE&&i.attributes["GROUP-ID"]&&i.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const g=this.manifest.mediaGroups[i.attributes.TYPE];g[i.attributes["GROUP-ID"]]=g[i.attributes["GROUP-ID"]]||{},y=g[i.attributes["GROUP-ID"]],A={default:/yes/i.test(i.attributes.DEFAULT)},A.default?A.autoselect=!0:A.autoselect=/yes/i.test(i.attributes.AUTOSELECT),i.attributes.LANGUAGE&&(A.language=i.attributes.LANGUAGE),i.attributes.URI&&(A.uri=i.attributes.URI),i.attributes["INSTREAM-ID"]&&(A.instreamId=i.attributes["INSTREAM-ID"]),i.attributes.CHARACTERISTICS&&(A.characteristics=i.attributes.CHARACTERISTICS),i.attributes.FORCED&&(A.forced=/yes/i.test(i.attributes.FORCED)),y[i.attributes.NAME]=A},discontinuity(){O+=1,t.discontinuity=!0,this.manifest.discontinuityStarts.push(e.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=i.dateTimeString,this.manifest.dateTimeObject=i.dateTimeObject),t.dateTimeString=i.dateTimeString,t.dateTimeObject=i.dateTimeObject;const{lastProgramDateTime:g}=this;this.lastProgramDateTime=new Date(i.dateTimeString).getTime(),g===null&&this.manifest.segments.reduceRight((n,h)=>(h.programDateTime=n-h.duration*1e3,h.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(i.duration)||i.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+i.duration});return}this.manifest.targetDuration=i.duration,G.call(this,this.manifest)},start(){if(!i.attributes||isNaN(i.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:i.attributes["TIME-OFFSET"],precise:i.attributes.PRECISE}},"cue-out"(){t.cueOut=i.data},"cue-out-cont"(){t.cueOutCont=i.data},"cue-in"(){t.cueIn=i.data},skip(){this.manifest.skip=S(i.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",i.attributes,["SKIPPED-SEGMENTS"])},part(){r=!0;const g=this.manifest.segments.length,n=S(i.attributes);t.parts=t.parts||[],t.parts.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=d),d=n.byterange.offset+n.byterange.length);const h=t.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${h} for segment #${g}`,i.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((c,m)=>{c.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${m} lacks required attribute(s): LAST-PART`})})},"server-control"(){const g=this.manifest.serverControl=S(i.attributes);g.hasOwnProperty("canBlockReload")||(g.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),G.call(this,this.manifest),g.canSkipDateranges&&!g.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const g=this.manifest.segments.length,n=S(i.attributes),h=n.type&&n.type==="PART";t.preloadHints=t.preloadHints||[],t.preloadHints.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=h?d:0,h&&(d=n.byterange.offset+n.byterange.length)));const c=t.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${c} for segment #${g}`,i.attributes,["TYPE","URI"]),!!n.type)for(let m=0;m<t.preloadHints.length-1;m++){const I=t.preloadHints[m];I.type&&I.type===n.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${c} for segment #${g} has the same TYPE ${n.type} as preload hint #${m}`})}},"rendition-report"(){const g=S(i.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(g);const n=this.manifest.renditionReports.length-1,h=["LAST-MSN","URI"];r&&h.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${n}`,i.attributes,h)},"part-inf"(){this.manifest.partInf=S(i.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",i.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),G.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(S(i.attributes));const g=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${g}`,i.attributes,["ID","START-DATE"]);const n=this.manifest.dateRanges[g];n.endDate&&n.startDate&&new Date(n.endDate)<new Date(n.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),n.duration&&n.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),n.plannedDuration&&n.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const h=!!n.endOnNext;if(h&&!n.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),h&&(n.duration||n.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),n.duration&&n.endDate){const m=n.startDate.getTime()+n.duration*1e3;this.manifest.dateRanges[g].endDate=new Date(m)}if(!l[n.id])l[n.id]=n;else{for(const m in l[n.id])if(n[m]&&JSON.stringify(l[n.id][m])!==JSON.stringify(n[m])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const c=this.manifest.dateRanges.findIndex(m=>m.id===n.id);this.manifest.dateRanges[c]=P(this.manifest.dateRanges[c],n),l[n.id]=P(l[n.id],n),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"content-steering"(){this.manifest.contentSteering=S(i.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",i.attributes,["SERVER-URI"])}}[i.tagType]||o).call(a)},uri(){t.uri=i.uri,e.push(t),this.manifest.targetDuration&&!("duration"in t)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),t.duration=this.manifest.targetDuration),s&&(t.key=s),t.timeline=O,u&&(t.map=u),d=0,this.lastProgramDateTime!==null&&(t.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=t.duration*1e3),t={}},comment(){},custom(){i.segment?(t.custom=t.custom||{},t.custom[i.customType]=i.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[i.customType]=i.data)}})[i.type].call(a)})}warnOnMissingAttributes_(a,e,t){const u=[];t.forEach(function(s){e.hasOwnProperty(s)||u.push(s)}),u.length&&this.trigger("warn",{message:`${a} lacks required attribute(s): ${u.join(", ")}`})}push(a){this.lineStream.push(a)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(a){this.parseStream.addParser(a)}addTagMapper(a){this.parseStream.addTagMapper(a)}}const gt={class:"container"},dt={class:"flex flex-col space-y-2"},ft={class:""},lt={class:"w-30%"},ct={open:""},pt=_({__name:"App",setup(f){const a=D([]),e=D(F(window.location.href).url),t=D(F(window.location.href).adsUrl),u=D();function s(){return new Promise((p,d)=>{const l=indexedDB.open("TrackingLogDB",1);l.onerror=i=>d(`IndexedDB error: ${i.target.error}`),l.onsuccess=i=>p(i.target.result),l.onupgradeneeded=i=>{i.target.result.createObjectStore("trackingLog",{keyPath:"id",autoIncrement:!0})}})}D();const r=D(e),o=D(t),T=D({merchantId:"",appId:"",sessionId:"",userId:""});function R(){const p=new URL(window.location.href);p.searchParams.set("url",r.value),p.searchParams.set("adsUrl",o.value),Object.entries(T.value).forEach(([d,l])=>{p.searchParams.set(`drm_${d}`,l)}),window.location.href=p.toString()}D();function O(p,d){const l=document.querySelector("#video2"),i=document.querySelector("#adContainer1");J({video:l,adContainer:i,adsUrl:d}).then(({onEventTracking:y,sigmaPlayer:A,destroy:g,sdk:n})=>{async function h(I,X){console.log("[LOG] ~ manifest:",X);const w={proxyAds:{uri:d,timeout:2}};try{const N=await n.loadSource({config:w,manifest:X,masterUri:I});return console.log("[LOG] ~ newManifest:",N),N}catch(N){return console.error("[LOG] ~ error:",N),X}}const c=videojs(l,{html5:{vhs:{overrideNative:!0,cacheEncryptionKeys:!0,manifestLoadingRetryTimeout:1e4,manifestLoadingMaxRetry:3,bandwidth:5e6,useBandwidthFromLocalStorage:!0,enableLowInitialPlaylist:!0,fastQualityChange:!0,maxPlaylistRetries:3,handleManifestRedirects:!0,blacklistDuration:60,segmentTimeout:1e4},nativeAudioTracks:!1,nativeVideoTracks:!1},controls:!0,fluid:!0,playbackRates:[.5,1,1.5,2],responsive:!0,autoplay:!1,preload:"auto",techOrder:["html5"],liveui:!0}),m=async function(I,X,w){var N;if(/\.m3u8$/.test(w.url)&&/.*?\.ts/.test(w.body)){const C=new ut,H=await h(p,w.body);C.push(H),C.end(),console.log("[LOG] ~ parser:",C.manifest.segments),console.log("[LOG] ~ segments:",(N=c.tech().vhs.playlists)==null?void 0:N.media_.segments)}};videojs.Vhs.xhr.onResponse(m),c.src({src:"https://lrm-test.sigma.video:1643/manifest/origin04/scte35-av6s-clear/master.m3u8",type:"application/x-mpegURL"}),c.on("manifestLoaded",I=>{console.log("Manifest loaded successfully:",I)}),c.on("qualityLevelChanged",I=>{console.log("Quality level changed:",I)}),c.on("waiting",()=>{console.log("Player is waiting")}),c.on("loadstart",()=>{console.log("Player started loading")}),c.on("loadedmetadata",()=>{console.log("Meta data loaded")}),c.on("loadeddata",()=>{console.log("Video data loaded")}),c.on("canplay",()=>{console.log("Player can play")}),window.addEventListener("beforeunload",()=>{c&&c.dispose()})})}return q(async()=>{u.value=await s(),O(e.value,t.value);const p=new URLSearchParams(window.location.search);T.value={merchantId:p.get("drm_merchantId")||"",appId:p.get("drm_appId")||"",sessionId:p.get("drm_sessionId")||"",userId:p.get("drm_userId")||""}}),(p,d)=>(M(),x("div",gt,[E("form",{class:"mb-4",onSubmit:k(R,["prevent"])},[E("div",dt,[d[2]||(d[2]=E("label",{for:"urlInput",class:"font-medium"},"URL:",-1)),B(E("input",{id:"urlInput","onUpdate:modelValue":d[0]||(d[0]=l=>r.value=l),type:"text",class:"border rounded px-2 py-1"},null,512),[[V,r.value]]),d[3]||(d[3]=E("label",{for:"adsUrlInput",class:"font-medium"},"Ads URL:",-1)),B(E("input",{id:"adsUrlInput","onUpdate:modelValue":d[1]||(d[1]=l=>o.value=l),type:"text",class:"border rounded px-2 py-1"},null,512),[[V,o.value]]),d[4]||(d[4]=E("button",{type:"submit",class:"mt-4 rounded bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600"}," Update and Reload ",-1))])],32),E("div",ft,[d[6]||(d[6]=E("div",{class:"w-70%"},[E("div",{class:"aspect-ratio-video",style:{position:"relative",width:"720px",overflow:"hidden"}},[E("video",{id:"video2",class:"video-js vjs-default-skin vjs-big-play-button vjs-fluid",controls:"",preload:"auto",width:"640",height:"360",crossorigin:"anonymous",style:{position:"absolute",inset:"0",width:"100%",height:"100%"}}),E("div",{id:"adContainer1",style:{position:"absolute",top:"0",left:"0",bottom:"0",right:"0",overflow:"hidden",width:"100%"}})])],-1)),E("div",lt,[(M(!0),x(j,null,W(a.value,(l,i)=>(M(),x("div",{key:i,class:"event-log-item"},[E("details",ct,[d[5]||(d[5]=E("summary",null,"item",-1)),E("pre",null,Q(JSON.stringify(l,null,2)),1)])]))),128))])])]))}}),ht=Z(pt,[["__scopeId","data-v-7991ac80"]]);z(ht).mount("#app");
