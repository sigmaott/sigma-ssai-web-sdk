var Ge=(A,P)=>()=>(P||A((P={exports:{}}).exports,P),P.exports);import{w as He,a as We,r as re,c as Ve,e as Ke,d as je,o as Xe,b as Ee,f as se,F as Ye,g as ze,u as qe,h as $e,i as _e,j as Qe,k as Je,t as Ze,l as et}from"./zoid-ZyTki32D.js";var Vt=Ge((Ue,Te)=>{const tt=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,rt=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,it=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function nt(A,P){if(A==="__proto__"||A==="constructor"&&P&&typeof P=="object"&&"prototype"in P){at(A);return}return P}function at(A){console.warn(`[destr] Dropping "${A}" key to prevent prototype pollution.`)}function Fe(A,P={}){if(typeof A!="string")return A;const D=A.trim();if(A[0]==='"'&&A.endsWith('"')&&!A.includes("\\"))return D.slice(1,-1);if(D.length<=9){const I=D.toLowerCase();if(I==="true")return!0;if(I==="false")return!1;if(I==="undefined")return;if(I==="null")return null;if(I==="nan")return Number.NaN;if(I==="infinity")return Number.POSITIVE_INFINITY;if(I==="-infinity")return Number.NEGATIVE_INFINITY}if(!it.test(A)){if(P.strict)throw new SyntaxError("[destr] Invalid JSON");return A}try{if(tt.test(A)||rt.test(A)){if(P.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(A,nt)}return JSON.parse(A)}catch(I){if(P.strict)throw I;return A}}class st extends Error{constructor(P,D){super(P,D),this.name="FetchError",D!=null&&D.cause&&!this.cause&&(this.cause=D.cause)}}function ot(A){var m,n,r,f,x;const P=((m=A.error)==null?void 0:m.message)||((n=A.error)==null?void 0:n.toString())||"",D=((r=A.request)==null?void 0:r.method)||((f=A.options)==null?void 0:f.method)||"GET",I=((x=A.request)==null?void 0:x.url)||String(A.request)||"/",F=`[${D}] ${JSON.stringify(I)}`,k=A.response?`${A.response.status} ${A.response.statusText}`:"<no response>",O=`${F}: ${k}${P?` ${P}`:""}`,g=new st(O,A.error?{cause:A.error}:void 0);for(const v of["request","options","response"])Object.defineProperty(g,v,{get(){return A[v]}});for(const[v,c]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(g,v,{get(){return A.response&&A.response[c]}});return g}const lt=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function we(A="GET"){return lt.has(A.toUpperCase())}function ut(A){if(A===void 0)return!1;const P=typeof A;return P==="string"||P==="number"||P==="boolean"||P===null?!0:P!=="object"?!1:Array.isArray(A)?!0:A.buffer?!1:A.constructor&&A.constructor.name==="Object"||typeof A.toJSON=="function"}const ft=new Set(["image/svg","application/xml","application/xhtml","application/html"]),dt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function ht(A=""){if(!A)return"json";const P=A.split(";").shift()||"";return dt.test(P)?"json":ft.has(P)||P.startsWith("text/")?"text":"blob"}function ct(A,P,D=globalThis.Headers){const I={...P,...A};if(P!=null&&P.params&&(A!=null&&A.params)&&(I.params={...P==null?void 0:P.params,...A==null?void 0:A.params}),P!=null&&P.query&&(A!=null&&A.query)&&(I.query={...P==null?void 0:P.query,...A==null?void 0:A.query}),P!=null&&P.headers&&(A!=null&&A.headers)){I.headers=new D((P==null?void 0:P.headers)||{});for(const[F,k]of new D((A==null?void 0:A.headers)||{}))I.headers.set(F,k)}return I}const vt=new Set([408,409,425,429,500,502,503,504]),gt=new Set([101,204,205,304]);function Ie(A={}){const{fetch:P=globalThis.fetch,Headers:D=globalThis.Headers,AbortController:I=globalThis.AbortController}=A;async function F(g){const m=g.error&&g.error.name==="AbortError"&&!g.options.timeout||!1;if(g.options.retry!==!1&&!m){let r;typeof g.options.retry=="number"?r=g.options.retry:r=we(g.options.method)?0:1;const f=g.response&&g.response.status||500;if(r>0&&(Array.isArray(g.options.retryStatusCodes)?g.options.retryStatusCodes.includes(f):vt.has(f))){const x=g.options.retryDelay||0;return x>0&&await new Promise(v=>setTimeout(v,x)),k(g.request,{...g.options,retry:r-1})}}const n=ot(g);throw Error.captureStackTrace&&Error.captureStackTrace(n,k),n}const k=async function(m,n={}){var v;const r={request:m,options:ct(n,A.defaults,D),response:void 0,error:void 0};r.options.method=(v=r.options.method)==null?void 0:v.toUpperCase(),r.options.onRequest&&await r.options.onRequest(r),typeof r.request=="string"&&(r.options.baseURL&&(r.request=He(r.request,r.options.baseURL)),(r.options.query||r.options.params)&&(r.request=We(r.request,{...r.options.params,...r.options.query}))),r.options.body&&we(r.options.method)&&(ut(r.options.body)?(r.options.body=typeof r.options.body=="string"?r.options.body:JSON.stringify(r.options.body),r.options.headers=new D(r.options.headers||{}),r.options.headers.has("content-type")||r.options.headers.set("content-type","application/json"),r.options.headers.has("accept")||r.options.headers.set("accept","application/json")):("pipeTo"in r.options.body&&typeof r.options.body.pipeTo=="function"||typeof r.options.body.pipe=="function")&&("duplex"in r.options||(r.options.duplex="half")));let f;if(!r.options.signal&&r.options.timeout){const c=new I;f=setTimeout(()=>c.abort(),r.options.timeout),r.options.signal=c.signal}try{r.response=await P(r.request,r.options)}catch(c){return r.error=c,r.options.onRequestError&&await r.options.onRequestError(r),await F(r)}finally{f&&clearTimeout(f)}if(r.response.body&&!gt.has(r.response.status)&&r.options.method!=="HEAD"){const c=(r.options.parseResponse?"json":r.options.responseType)||ht(r.response.headers.get("content-type")||"");switch(c){case"json":{const h=await r.response.text(),d=r.options.parseResponse||Fe;r.response._data=d(h);break}case"stream":{r.response._data=r.response.body;break}default:r.response._data=await r.response[c]()}}return r.options.onResponse&&await r.options.onResponse(r),!r.options.ignoreResponseError&&r.response.status>=400&&r.response.status<600?(r.options.onResponseError&&await r.options.onResponseError(r),await F(r)):r.response},O=async function(m,n){return(await k(m,n))._data};return O.raw=k,O.native=(...g)=>P(...g),O.create=(g={})=>Ie({...A,defaults:{...A.defaults,...g}}),O}const be=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),pt=be.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),yt=be.Headers,mt=be.AbortController,Pe=Ie({fetch:pt,Headers:yt,AbortController:mt}),Me=Pe;async function xe(A){try{return{data:await A,error:null}}catch(P){return{data:null,error:P}}}function xt(A){return new Promise((P,D)=>{const I=document.createElement("script");I.async=!0,I.src=A,I.onload=P,I.onerror=D,document.body.appendChild(I)})}const Et="https://imasdk.googleapis.com/pal/sdkloader/pal.js";let ve=null;function Le(){ve=null}function _t(){const A=window;return A.goog&&A.goog.pal?Promise.resolve(A.goog.pal):ve||(ve=xt(Et).then(()=>A.goog.pal),ve.then(Le).catch(Le),ve)}function Tt(A,P){let D,I,F,O=!1;function g(){return!0}function m(){P.addEventListener("mousedown",c=>void r(c)),P.addEventListener("touchstart",c=>void r(c)),P.addEventListener("play",()=>{O||(f(),O=!0)}),P.addEventListener("ended",()=>void x()),P.addEventListener("error",()=>{console.log(`Video error: ${P.error.message}`),x()});const v=new A.ConsentSettings;return v.allowStorage=g(),D=new A.NonceLoader,n()}async function n(){const v=new A.NonceRequest;v.adWillAutoPlay=!0,v.adWillPlayMuted=!0,v.continuousPlayback=!1,v.descriptionUrl="https://example.com",v.iconsSupported=!0,v.playerType="Sample Player Type",v.playerVersion="1.0",v.ppid="Sample PPID",v.sessionId="Sample SID",v.supportedApiFrameworks="2,7,9",v.url="https://developers.google.com/ad-manager/pal/html5",v.videoHeight=480,v.videoWidth=640,I=D.loadNonceManager(v);const{data:c,error:h}=await xe(I);return h?(console.log(`Error generating nonce: ${h}`),null):(F=c,F.getNonce())}function r(v){F&&F.sendTouch(v)}function f(){F&&F.sendPlaybackStart()}function x(){F&&F.sendPlaybackEnd()}return m()}const bt=Pe.create({credentials:"omit",onResponseError({response:A,error:P}){console.log("[LOG] ~ error:",P)},onRequest:({options:A,request:P})=>{const D=A.token;D&&(A.headers=A.headers||{},A.headers.Authorization=`${D}`)},onResponse({response:A,options:P}){}}),St=A=>(P,D)=>(A.set(P,D),D),De=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,Ce=536870912,Oe=Ce*2,At=(A,P)=>D=>{const I=P.get(D);let F=I===void 0?D.size:I<Oe?I+1:0;if(!D.has(F))return A(D,F);if(D.size<Ce){for(;D.has(F);)F=Math.floor(Math.random()*Oe);return A(D,F)}if(D.size>De)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;D.has(F);)F=Math.floor(Math.random()*De);return A(D,F)},Ne=new WeakMap,Rt=St(Ne),me=At(Rt,Ne),kt=A=>A.method!==void 0&&A.method==="call",wt=A=>typeof A.id=="number"&&typeof A.result=="boolean",Lt=A=>{const P=new Map([[0,()=>{}]]),D=new Map([[0,()=>{}]]),I=new Map,F=new Worker(A);return F.addEventListener("message",({data:n})=>{if(kt(n)){const{params:{timerId:r,timerType:f}}=n;if(f==="interval"){const x=P.get(r);if(typeof x===void 0)throw new Error("The timer is in an undefined state.");if(typeof x=="number"){const v=I.get(x);if(v===void 0||v.timerId!==r||v.timerType!==f)throw new Error("The timer is in an undefined state.")}else typeof x=="function"&&x()}else if(f==="timeout"){const x=D.get(r);if(typeof x===void 0)throw new Error("The timer is in an undefined state.");if(typeof x=="number"){const v=I.get(x);if(v===void 0||v.timerId!==r||v.timerType!==f)throw new Error("The timer is in an undefined state.")}else typeof x=="function"&&(x(),D.delete(r))}}else if(wt(n)){const{id:r}=n,f=I.get(r);if(f===void 0)throw new Error("The timer is in an undefined state.");const{timerId:x,timerType:v}=f;I.delete(r),v==="interval"?P.delete(x):D.delete(x)}else{const{error:{message:r}}=n;throw new Error(r)}}),{clearInterval:n=>{if(typeof P.get(n)=="function"){const r=me(I);I.set(r,{timerId:n,timerType:"interval"}),P.set(n,r),F.postMessage({id:r,method:"clear",params:{timerId:n,timerType:"interval"}})}},clearTimeout:n=>{if(typeof D.get(n)=="function"){const r=me(I);I.set(r,{timerId:n,timerType:"timeout"}),D.set(n,r),F.postMessage({id:r,method:"clear",params:{timerId:n,timerType:"timeout"}})}},setInterval:(n,r=0,...f)=>{const x=me(P);return P.set(x,()=>{n(...f),typeof P.get(x)=="function"&&F.postMessage({id:null,method:"set",params:{delay:r,now:performance.timeOrigin+performance.now(),timerId:x,timerType:"interval"}})}),F.postMessage({id:null,method:"set",params:{delay:r,now:performance.timeOrigin+performance.now(),timerId:x,timerType:"interval"}}),x},setTimeout:(n,r=0,...f)=>{const x=me(D);return D.set(x,()=>n(...f)),F.postMessage({id:null,method:"set",params:{delay:r,now:performance.timeOrigin+performance.now(),timerId:x,timerType:"timeout"}}),x}}},Dt=(A,P)=>{let D=null;return()=>{if(D!==null)return D;const I=new Blob([P],{type:"application/javascript; charset=utf-8"}),F=URL.createObjectURL(I);return D=A(F),setTimeout(()=>URL.revokeObjectURL(F)),D}},Ot=`(()=>{"use strict";const e=new Map,t=new Map,r=t=>{const r=e.get(t);return void 0!==r&&(clearTimeout(r),e.delete(t),!0)},s=e=>{const r=t.get(e);return void 0!==r&&(clearTimeout(r),t.delete(e),!0)},o=(e,t)=>{const r=performance.now(),s=e+t-r-performance.timeOrigin;return{expected:r+s,remainingDelay:s}},i=(e,t,r,s)=>{const o=r-performance.now();o>0?e.set(t,setTimeout(i,o,e,t,r,s)):(e.delete(t),postMessage({id:null,method:"call",params:{timerId:t,timerType:s}}))};addEventListener("message",(n=>{let{data:a}=n;try{if("clear"===a.method){const{id:e,params:{timerId:t,timerType:o}}=a;if("interval"===o)postMessage({id:e,result:r(t)});else{if("timeout"!==o)throw new Error('The given type "'.concat(o,'" is not supported'));postMessage({id:e,result:s(t)})}}else{if("set"!==a.method)throw new Error('The given method "'.concat(a.method,'" is not supported'));{const{params:{delay:r,now:s,timerId:n,timerType:m}}=a;if("interval"===m)((t,r,s)=>{const{expected:n,remainingDelay:a}=o(t,s);e.set(r,setTimeout(i,a,e,r,n,"interval"))})(r,n,s);else{if("timeout"!==m)throw new Error('The given type "'.concat(m,'" is not supported'));((e,r,s)=>{const{expected:n,remainingDelay:a}=o(e,s);t.set(r,setTimeout(i,a,t,r,n,"timeout"))})(r,n,s)}}}}catch(e){postMessage({error:{message:e.message},id:a.id,result:null})}}))})();`,Ft=Dt(Lt,Ot),It=(...A)=>Ft().setTimeout(...A);function Pt(){const A=new Set,P=F=>{A.delete(F)};return{on:F=>(A.add(F),{off:()=>P(F)}),off:P,trigger:(...F)=>Promise.all(Array.from(A).map(k=>k(...F)))}}function Mt({video:A,adContainer:P,trackingUrl:D,interval:I}){const F=re(0);A.addEventListener("timeupdate",()=>{F.value=A.currentTime}),re({}),re(),re(I||1e3),re();const k=Pt(),O=re(!1),g=re();function m({icons:t}){return{appConfig:{sdkBaseUrl:"https://dev-streaming.gviet.vn:8783/micro/cms/sdk-dai/dist/wta/"},icons:t}}const n=Ve(m({icons:[]}));n.render(P),n.hide(),P.style.display="none",Ke(()=>{var t;if(g.value){const l=((t=g.value)==null?void 0:t.icons)||[];P.style.display="block",n.updateProps(m({icons:l})),n.show()}else P.style.display="none",n.hide()});const r=re([]),f=re(),x=re();function v(){return O.value=!1,async(t,l)=>{if(f.value=l.frag.sn,!t!==window.Hls.Events.FRAG_CHANGED){for(const i of r.value)if(i.sn===l.frag.sn)for(const p of x.value){const _=p.ads.find(e=>e.id===i.value.adId);if(!_)continue;g.value=_;const y=_.trackingEvents.find(e=>e.eventType===i.value.event);y&&It(async()=>{k.trigger(y),await Promise.all(y.beaconUrls.map(e=>xe(bt(e)))),i.value.event==="complete"&&(g.value=void 0,r.value=[])},i.time*1e3)}}}}function c(){return async(t,l)=>{function i(_){for(let y=0;y<_.length;y++)if(_[y]===0)return y;return _.length}const{start:u,sn:p}=l.frag;for(let _=0;_<l.samples.length;_++){const y=l.samples[_],e=y.data,o=y.pts;if(String.fromCharCode.apply(null,e.slice(0,3))!=="ID3"||String.fromCharCode.apply(null,e.slice(10,14))!=="TXXX")continue;const b=e.slice(21,e.length),a=i(b),s=b.slice(a+1,b.length),T=i(s),R=new TextDecoder("utf-8").decode(s.slice(0,T)),w={sn:p,time:o-u,value:Fe(R)};if(f.value&&p<f.value)return;r.value.push(w),console.log("[LOG] ~ eventTracking:",r),w.value.event==="start"&&xe(Me(D)).then(({data:L,error:M})=>{if(M){console.error("Cannot get tracking data",M);return}x.value=(L==null?void 0:L.avails)||[]})}}}function h(){g.value=void 0,r.value=[],k.off(()=>{})}function d(t,l){k.on(i=>{(t==="*"||i.eventType===t)&&l(i)})}return{destroy:h,hlsHelper:{createHlsFragChanged:v,createHlsFragParsingMetadata:c},onEventTracking:d}}(function(A){if(typeof Ue=="object"&&typeof Te<"u")Te.exports=A();else if(typeof define=="function"&&define.amd)define([],A);else{var P;typeof window<"u"?P=window:typeof global<"u"?P=global:typeof self<"u"?P=self:P=this,P.Hls=A()}})(function(){return function A(P,D,I){function F(g,m){if(!D[g]){if(!P[g]){var n=typeof require=="function"&&require;if(!m&&n)return n(g,!0);if(k)return k(g,!0);var r=new Error("Cannot find module '"+g+"'");throw r.code="MODULE_NOT_FOUND",r}var f=D[g]={exports:{}};P[g][0].call(f.exports,function(x){var v=P[g][1][x];return F(v||x)},f,f.exports,A,P,D,I)}return D[g].exports}for(var k=typeof require=="function"&&require,O=0;O<I.length;O++)F(I[O]);return F}({1:[function(A,P,D){function I(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}P.exports=I,I.EventEmitter=I,I.prototype._events=void 0,I.prototype._maxListeners=void 0,I.defaultMaxListeners=10,I.prototype.setMaxListeners=function(m){if(!k(m)||m<0||isNaN(m))throw TypeError("n must be a positive number");return this._maxListeners=m,this},I.prototype.emit=function(m){var n,r,f,x,v,c;if(this._events||(this._events={}),m==="error"&&(!this._events.error||O(this._events.error)&&!this._events.error.length)){if(n=arguments[1],n instanceof Error)throw n;var h=new Error('Uncaught, unspecified "error" event. ('+n+")");throw h.context=n,h}if(r=this._events[m],g(r))return!1;if(F(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:x=Array.prototype.slice.call(arguments,1),r.apply(this,x)}else if(O(r))for(x=Array.prototype.slice.call(arguments,1),c=r.slice(),f=c.length,v=0;v<f;v++)c[v].apply(this,x);return!0},I.prototype.addListener=function(m,n){var r;if(!F(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,F(n.listener)?n.listener:n),this._events[m]?O(this._events[m])?this._events[m].push(n):this._events[m]=[this._events[m],n]:this._events[m]=n,O(this._events[m])&&!this._events[m].warned&&(g(this._maxListeners)?r=I.defaultMaxListeners:r=this._maxListeners,r&&r>0&&this._events[m].length>r&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),typeof console.trace=="function"&&console.trace())),this},I.prototype.on=I.prototype.addListener,I.prototype.once=function(m,n){if(!F(n))throw TypeError("listener must be a function");var r=!1;function f(){this.removeListener(m,f),r||(r=!0,n.apply(this,arguments))}return f.listener=n,this.on(m,f),this},I.prototype.removeListener=function(m,n){var r,f,x,v;if(!F(n))throw TypeError("listener must be a function");if(!this._events||!this._events[m])return this;if(r=this._events[m],x=r.length,f=-1,r===n||F(r.listener)&&r.listener===n)delete this._events[m],this._events.removeListener&&this.emit("removeListener",m,n);else if(O(r)){for(v=x;v-- >0;)if(r[v]===n||r[v].listener&&r[v].listener===n){f=v;break}if(f<0)return this;r.length===1?(r.length=0,delete this._events[m]):r.splice(f,1),this._events.removeListener&&this.emit("removeListener",m,n)}return this},I.prototype.removeAllListeners=function(m){var n,r;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[m]&&delete this._events[m],this;if(arguments.length===0){for(n in this._events)n!=="removeListener"&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[m],F(r))this.removeListener(m,r);else if(r)for(;r.length;)this.removeListener(m,r[r.length-1]);return delete this._events[m],this},I.prototype.listeners=function(m){var n;return!this._events||!this._events[m]?n=[]:F(this._events[m])?n=[this._events[m]]:n=this._events[m].slice(),n},I.prototype.listenerCount=function(m){if(this._events){var n=this._events[m];if(F(n))return 1;if(n)return n.length}return 0},I.listenerCount=function(m,n){return m.listenerCount(n)};function F(m){return typeof m=="function"}function k(m){return typeof m=="number"}function O(m){return typeof m=="object"&&m!==null}function g(m){return m===void 0}},{}],2:[function(A,P,D){(function(I){var F=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,k=/^([^\/;?#]*)(.*)$/,O=/(?:\/|^)\.(?=\/)/g,g=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,m={buildAbsoluteURL:function(n,r,f){if(f=f||{},n=n.trim(),r=r.trim(),!r){if(!f.alwaysNormalize)return n;var x=this.parseURL(n);if(!c)throw new Error("Error trying to parse base URL.");return x.path=m.normalizePath(x.path),m.buildURLFromParts(x)}var v=this.parseURL(r);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return f.alwaysNormalize?(v.path=m.normalizePath(v.path),m.buildURLFromParts(v)):r;var c=this.parseURL(n);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var h=k.exec(c.path);c.netLoc=h[1],c.path=h[2]}c.netLoc&&!c.path&&(c.path="/");var d={scheme:c.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(d.netLoc=c.netLoc,v.path[0]!=="/"))if(!v.path)d.path=c.path,v.params||(d.params=c.params,v.query||(d.query=c.query));else{var t=c.path,l=t.substring(0,t.lastIndexOf("/")+1)+v.path;d.path=m.normalizePath(l)}return d.path===null&&(d.path=f.alwaysNormalize?m.normalizePath(v.path):v.path),m.buildURLFromParts(d)},parseURL:function(n){var r=F.exec(n);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(n){for(n=n.split("").reverse().join("").replace(O,"");n.length!==(n=n.replace(g,"")).length;);return n.split("").reverse().join("")},buildURLFromParts:function(n){return n.scheme+n.netLoc+n.path+n.params+n.query+n.fragment}};typeof D=="object"&&typeof P=="object"?P.exports=m:typeof D=="object"?D.URLToolkit=m:I.URLToolkit=m})(this)},{}],3:[function(A,P,D){var I=arguments[3],F=arguments[4],k=arguments[5],O=JSON.stringify;P.exports=function(g,m){for(var n,r=Object.keys(k),f=0,x=r.length;f<x;f++){var v=r[f],c=k[v].exports;if(c===g||c&&c.default===g){n=v;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},f=0,x=r.length;f<x;f++){var v=r[f];h[v]=v}F[n]=[Function(["require","module","exports"],"("+g+")(self)"),h]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),t={};t[n]=n,F[d]=[Function(["require"],"var f = require("+O(n)+");(f.default ? f.default : f)(self);"),t];var l={};i(d);function i(o){l[o]=!0;for(var E in F[o][1]){var S=F[o][1][E];l[S]||i(S)}}var u="("+I+")({"+Object.keys(l).map(function(o){return O(o)+":["+F[o][0]+","+O(F[o][1])+"]"}).join(",")+"},{},["+O(d)+"])",p=window.URL||window.webkitURL||window.mozURL||window.msURL,_=new Blob([u],{type:"text/javascript"});if(m&&m.bare)return _;var y=p.createObjectURL(_),e=new Worker(y);return e.objectURL=y,e}},{}],4:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0}),D.hlsDefaultConfig=void 0;var I=A(5),F=o(I),k=A(8),O=o(k),g=A(9),m=o(g),n=A(10),r=o(n),f=A(56),x=o(f),v=A(7),c=o(v),h=A(6),d=o(h),t=A(48),l=o(t),i=A(16),u=o(i),p=A(15),_=o(p),y=A(14),e=o(y);function o(E){return E&&E.__esModule?E:{default:E}}D.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:x.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:F.default,bufferController:O.default,capLevelController:m.default,fpsController:r.default,audioStreamController:d.default,audioTrackController:c.default,subtitleStreamController:e.default,subtitleTrackController:_.default,timelineController:u.default,cueHandler:l.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,14:14,15:15,16:16,48:48,5:5,56:56,6:6,7:7,8:8,9:9}],5:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function i(u,p){for(var _=0;_<p.length;_++){var y=p[_];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(u,y.key,y)}}return function(u,p,_){return p&&i(u.prototype,p),_&&i(u,_),u}}(),F=A(33),k=c(F),O=A(32),g=c(O),m=A(35),n=c(m),r=A(31),f=A(51),x=A(49),v=c(x);function c(i){return i&&i.__esModule?i:{default:i}}function h(i,u){if(!(i instanceof u))throw new TypeError("Cannot call a class as a function")}function d(i,u){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:i}function t(i,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);i.prototype=Object.create(u&&u.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(i,u):i.__proto__=u)}var l=function(i){t(u,i);function u(p){h(this,u);var _=d(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,p,k.default.FRAG_LOADING,k.default.FRAG_LOADED,k.default.FRAG_BUFFERED,k.default.ERROR));return _.lastLoadedFragLevel=0,_._nextAutoLevel=-1,_.hls=p,_.onCheck=_._abandonRulesCheck.bind(_),_}return I(u,[{key:"destroy",value:function(){this.clearTimer(),g.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(_){var y=_.frag;if(y.type==="main"){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var e=this.hls,o=_.frag.level,E=e.levels[o].details.live,S=e.config,b=void 0,a=void 0;E?(b=S.abrEwmaFastLive,a=S.abrEwmaSlowLive):(b=S.abrEwmaFastVoD,a=S.abrEwmaSlowVoD),this._bwEstimator=new v.default(e,a,b,S.abrEwmaDefaultEstimate)}this.fragCurrent=y}}},{key:"_abandonRulesCheck",value:function(){var _=this.hls,y=_.media,e=this.fragCurrent,o=e.loader,E=_.minAutoLevel;if(!o||o.stats&&o.stats.aborted){f.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer();return}var S=o.stats;if(y&&(!y.paused&&y.playbackRate!==0||!y.readyState)&&e.autoLevel&&e.level){var b=performance.now()-S.trequest,a=Math.abs(y.playbackRate);if(b>500*e.duration/a){var s=_.levels,T=Math.max(1,S.bw?S.bw/8:S.loaded*1e3/b),R=s[e.level],w=R.realBitrate?Math.max(R.realBitrate,R.bitrate):R.bitrate,L=S.total?S.total:Math.max(S.loaded,Math.round(e.duration*w/8)),M=y.currentTime,N=(L-S.loaded)/T,U=(n.default.bufferInfo(y,M,_.config.maxBufferHole).end-M)/a;if(U<2*e.duration/a&&N>U){var C=void 0,B=void 0;for(B=e.level-1;B>E;B--){var G=s[B].realBitrate?Math.max(s[B].realBitrate,s[B].bitrate):s[B].bitrate;if(C=e.duration*G/(8*.8*T),C<U)break}C<N&&(f.logger.warn("loading too slow, abort fragment loading and switch to level "+B+":fragLoadedDelay["+B+"]<fragLoadedDelay["+(e.level-1)+"];bufferStarvationDelay:"+C.toFixed(1)+"<"+N.toFixed(1)+":"+U.toFixed(1)),_.nextLoadLevel=B,this._bwEstimator.sample(b,S.loaded),o.abort(),this.clearTimer(),_.trigger(k.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,stats:S}))}}}}},{key:"onFragLoaded",value:function(_){var y=_.frag;if(y.type==="main"&&!isNaN(y.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=y.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var e=this.hls.levels[y.level],o=(e.loaded?e.loaded.bytes:0)+_.stats.loaded,E=(e.loaded?e.loaded.duration:0)+_.frag.duration;e.loaded={bytes:o,duration:E},e.realBitrate=Math.round(8*o/E)}if(_.frag.bitrateTest){var S=_.stats;S.tparsed=S.tbuffered=S.tload,this.onFragBuffered(_)}}}},{key:"onFragBuffered",value:function(_){var y=_.stats,e=_.frag;if(y.aborted!==!0&&e.loadCounter===1&&e.type==="main"&&!isNaN(e.sn)&&(!e.bitrateTest||y.tload===y.tbuffered)){var o=y.tparsed-y.trequest;f.logger.log("latency/loading/parsing/append/kbps:"+Math.round(y.tfirst-y.trequest)+"/"+Math.round(y.tload-y.tfirst)+"/"+Math.round(y.tparsed-y.tload)+"/"+Math.round(y.tbuffered-y.tparsed)+"/"+Math.round(8*y.loaded/(y.tbuffered-y.trequest))),this._bwEstimator.sample(o,y.loaded),y.bwEstimate=this._bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(_){switch(_.details){case r.ErrorDetails.FRAG_LOAD_ERROR:case r.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(_,y,e,o,E,S,b,a,s){for(var T=E;T>=o;T--){var R=s[T],w=R.details,L=w?w.totalduration/w.fragments.length:y,M=w?w.live:!1,N=void 0;T<=_?N=b*e:N=a*e;var U=s[T].realBitrate?Math.max(s[T].realBitrate,s[T].bitrate):s[T].bitrate,C=U*L/N;if(f.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+T+"/"+Math.round(N)+"/"+U+"/"+L+"/"+S+"/"+C),N>U&&(!C||M||C<S))return T}return-1}},{key:"nextAutoLevel",get:function(){var _=this._nextAutoLevel,y=this._bwEstimator;if(_!==-1&&(!y||!y.canEstimate()))return _;var e=this._nextABRAutoLevel;return _!==-1&&(e=Math.min(_,e)),e},set:function(_){this._nextAutoLevel=_}},{key:"_nextABRAutoLevel",get:function(){var _=this.hls,y=_.maxAutoLevel,e=_.levels,o=_.config,E=_.minAutoLevel,S=_.media,b=this.lastLoadedFragLevel,a=this.fragCurrent?this.fragCurrent.duration:0,s=S?S.currentTime:0,T=S&&S.playbackRate!==0?Math.abs(S.playbackRate):1,R=this._bwEstimator?this._bwEstimator.getEstimate():o.abrEwmaDefaultEstimate,w=(n.default.bufferInfo(S,s,o.maxBufferHole).end-s)/T,L=this._findBestLevel(b,a,R,E,y,w,o.abrBandWidthFactor,o.abrBandWidthUpFactor,e);if(L>=0)return L;f.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var M=a?Math.min(a,o.maxStarvationDelay):o.maxStarvationDelay,N=o.abrBandWidthFactor,U=o.abrBandWidthUpFactor;if(w===0){var C=this.bitrateTestDelay;if(C){var B=a?Math.min(a,o.maxLoadingDelay):o.maxLoadingDelay;M=B-C,f.logger.trace("bitrate test took "+Math.round(1e3*C)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*M)+" ms"),N=U=1}}return L=this._findBestLevel(b,a,R,E,y,w+M,N,U,e),Math.max(L,0)}}]),u}(g.default);D.default=l},{31:31,32:32,33:33,35:35,49:49,51:51}],6:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function E(S,b){for(var a=0;a<b.length;a++){var s=b[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(S,s.key,s)}}return function(S,b,a){return b&&E(S.prototype,b),a&&E(S,a),S}}(),F=A(46),k=u(F),O=A(35),g=u(O),m=A(25),n=u(m),r=A(33),f=u(r),x=A(32),v=u(x),c=A(36),h=u(c),d=A(52),t=u(d),l=A(31),i=A(51);function u(E){return E&&E.__esModule?E:{default:E}}function p(E,S){if(!(E instanceof S))throw new TypeError("Cannot call a class as a function")}function _(E,S){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S&&(typeof S=="object"||typeof S=="function")?S:E}function y(E,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof S);E.prototype=Object.create(S&&S.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),S&&(Object.setPrototypeOf?Object.setPrototypeOf(E,S):E.__proto__=S)}var e={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},o=function(E){y(S,E);function S(b){p(this,S);var a=_(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,b,f.default.MEDIA_ATTACHED,f.default.MEDIA_DETACHING,f.default.AUDIO_TRACKS_UPDATED,f.default.AUDIO_TRACK_SWITCHING,f.default.AUDIO_TRACK_LOADED,f.default.KEY_LOADED,f.default.FRAG_LOADED,f.default.FRAG_PARSING_INIT_SEGMENT,f.default.FRAG_PARSING_DATA,f.default.FRAG_PARSED,f.default.ERROR,f.default.BUFFER_CREATED,f.default.BUFFER_APPENDED,f.default.BUFFER_FLUSHED,f.default.INIT_PTS_FOUND));return a.config=b.config,a.audioCodecSwap=!1,a.ticks=0,a._state=e.STOPPED,a.ontick=a.tick.bind(a),a.initPTS=[],a.waitingFragment=null,a}return I(S,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),v.default.prototype.destroy.call(this),this.state=e.STOPPED}},{key:"onInitPtsFound",value:function(a){var s=a.id,T=a.frag.cc,R=a.initPTS;s==="main"&&(this.initPTS[T]=R,i.logger.log("InitPTS for cc:"+T+" found from video track:"+R),this.state===e.WAITING_INIT_PTS&&(i.logger.log("sending pending audio frag to demuxer"),this.state=e.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(a){if(this.tracks){var s=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,s>0&&a===-1?(i.logger.log("audio:override startPosition with lastCurrentTime @"+s.toFixed(3)),this.state=e.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=e.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=e.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=e.STOPPED}},{key:"tick",value:function(){this.ticks++,this.ticks===1&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var a,s,T,R=this.hls,w=R.config;switch(this.state){case e.ERROR:case e.PAUSED:case e.BUFFER_FLUSHING:break;case e.STARTING:this.state=e.WAITING_TRACK,this.loadedmetadata=!1;break;case e.IDLE:var L=this.tracks;if(!L||!this.media&&(this.startFragRequested||!w.startFragPrefetch))break;this.loadedmetadata?a=this.media.currentTime:a=this.nextLoadPosition;var M=this.mediaBuffer?this.mediaBuffer:this.media,N=g.default.bufferInfo(M,a,w.maxBufferHole),U=N.len,C=N.end,B=this.fragPrevious,G=w.maxMaxBufferLength,H=this.audioSwitch,j=this.trackId;if((U<G||H)&&j<L.length){if(T=L[j].details,typeof T>"u"){this.state=e.WAITING_TRACK;break}if(!H&&!T.live&&B&&B.sn===T.endSN&&(!this.media.seeking||this.media.duration-C<B.duration/2)){this.hls.trigger(f.default.BUFFER_EOS,{type:"audio"}),this.state=e.ENDED;break}var X=T.fragments,K=X.length,W=X[0].start,q=X[K-1].start+X[K-1].duration,V=void 0;if(H){if(T.live&&!T.PTSKnown)i.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),C=0;else if(C=a,T.PTSKnown&&a<W)if(N.end>W||N.nextStart)i.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=W+.05;else return}if(T.initSegment&&!T.initSegment.data)V=T.initSegment;else if(C<=W){if(V=X[0],T.live&&V.loadIdx&&V.loadIdx===this.fragLoadIdx){var z=N.nextStart?N.nextStart:W;i.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(z+.05)),this.media.currentTime=z+.05;return}}else{var Y=void 0,Q=w.maxFragLookUpTolerance,J=B?X[B.sn-X[0].sn+1]:void 0,$=function(ee){var ne=Math.min(Q,ee.duration);return ee.start+ee.duration-ne<=C?1:ee.start-ne>C&&ee.start?-1:0};C<q?(C>q-Q&&(Q=0),J&&!$(J)?Y=J:Y=k.default.search(X,$)):Y=X[K-1],Y&&(V=Y,W=Y.start,B&&V.level===B.level&&V.sn===B.sn&&(V.sn<T.endSN?(V=X[V.sn+1-T.startSN],i.logger.log("SN just loaded, load next one: "+V.sn)):V=null))}if(V)if(V.decryptdata&&V.decryptdata.uri!=null&&V.decryptdata.key==null)i.logger.log("Loading key for "+V.sn+" of ["+T.startSN+" ,"+T.endSN+"],track "+j),this.state=e.KEY_LOADING,R.trigger(f.default.KEY_LOADING,{frag:V});else{if(i.logger.log("Loading "+V.sn+" of ["+T.startSN+" ,"+T.endSN+"],track "+j+", currentTime:"+a+",bufferEnd:"+C.toFixed(3)),this.fragLoadIdx!==void 0?this.fragLoadIdx++:this.fragLoadIdx=0,V.loadCounter){V.loadCounter++;var Z=w.fragLoadingLoopThreshold;if(V.loadCounter>Z&&Math.abs(this.fragLoadIdx-V.loadIdx)<Z){R.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:V});return}}else V.loadCounter=1;V.loadIdx=this.fragLoadIdx,this.fragCurrent=V,this.startFragRequested=!0,isNaN(V.sn)||(this.nextLoadPosition=V.start+V.duration),R.trigger(f.default.FRAG_LOADING,{frag:V}),this.state=e.FRAG_LOADING}}break;case e.WAITING_TRACK:s=this.tracks[this.trackId],s&&s.details&&(this.state=e.IDLE);break;case e.FRAG_LOADING_WAITING_RETRY:var ie=performance.now(),te=this.retryDate;M=this.media;var le=M&&M.seeking;(!te||ie>=te||le)&&(i.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=e.IDLE);break}}},{key:"onMediaAttached",value:function(a){var s=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),s.addEventListener("seeking",this.onvseeking),s.addEventListener("ended",this.onvended);var T=this.config;this.tracks&&T.autoStartLoad&&this.startLoad(T.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(i.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var s=this.tracks;s&&s.forEach(function(T){T.details&&T.details.fragments.forEach(function(R){R.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===e.ENDED&&(this.state=e.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.fragLoadIdx!==void 0&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(a){i.logger.log("audio tracks updated"),this.tracks=a.audioTracks}},{key:"onAudioTrackSwitching",value:function(a){var s=!!a.url;this.trackId=a.id,this.state=e.IDLE,this.fragCurrent=null,this.state=e.PAUSED,this.waitingFragment=null,s?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),s&&(this.audioSwitch=!0,this.state=e.IDLE,this.fragLoadIdx!==void 0&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(a){var s=a.details,T=a.id,R=this.tracks[T],w=s.totalduration,L=0;if(i.logger.log("track "+T+" loaded ["+s.startSN+","+s.endSN+"],duration:"+w),s.live){var M=R.details;M&&s.fragments.length>0?(h.default.mergeDetails(M,s),L=s.fragments[0].start,s.PTSKnown?i.logger.log("live audio playlist sliding:"+L.toFixed(3)):i.logger.log("live audio playlist - outdated PTS, unknown sliding")):(s.PTSKnown=!1,i.logger.log("live audio playlist - first load, unknown sliding"))}else s.PTSKnown=!1;if(R.details=s,!this.startFragRequested){if(this.startPosition===-1){var N=s.startTimeOffset;isNaN(N)?this.startPosition=0:(i.logger.log("start time offset found in playlist, adjust startPosition to "+N),this.startPosition=N)}this.nextLoadPosition=this.startPosition}this.state===e.WAITING_TRACK&&(this.state=e.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===e.KEY_LOADING&&(this.state=e.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var s=this.fragCurrent,T=a.frag;if(this.state===e.FRAG_LOADING&&s&&T.type==="audio"&&T.level===s.level&&T.sn===s.sn){var R=this.tracks[this.trackId],w=R.details,L=w.totalduration,M=s.level,N=s.sn,U=s.cc,C=this.config.defaultAudioCodec||R.audioCodec||"mp4a.40.2",B=this.stats=a.stats;if(N==="initSegment")this.state=e.IDLE,B.tparsed=B.tbuffered=performance.now(),w.initSegment.data=a.payload,this.hls.trigger(f.default.FRAG_BUFFERED,{stats:B,frag:s,id:"audio"}),this.tick();else{this.state=e.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new n.default(this.hls,"audio"));var G=this.initPTS[U],H=w.initSegment?w.initSegment.data:[];if(w.initSegment||G!==void 0){this.pendingBuffering=!0,i.logger.log("Demuxing "+N+" of ["+w.startSN+" ,"+w.endSN+"],track "+M);var j=!1;this.demuxer.push(a.payload,H,C,null,s,L,j,G)}else i.logger.log("unknown video PTS for continuity counter "+U+", waiting for video PTS before demuxing audio frag "+N+" of ["+w.startSN+" ,"+w.endSN+"],track "+M),this.waitingFragment=a,this.state=e.WAITING_INIT_PTS}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var s=this.fragCurrent,T=a.frag;if(s&&a.id==="audio"&&T.sn===s.sn&&T.level===s.level&&this.state===e.PARSING){var R=a.tracks,w=void 0;if(R.video&&delete R.video,w=R.audio,w){w.levelCodec="mp4a.40.2",w.id=a.id,this.hls.trigger(f.default.BUFFER_CODECS,R),i.logger.log("audio track:audio,container:"+w.container+",codecs[level/parsed]=["+w.levelCodec+"/"+w.codec+"]");var L=w.initSegment;if(L){var M={type:"audio",data:L,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[M]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(f.default.BUFFER_APPENDING,M))}this.tick()}}}},{key:"onFragParsingData",value:function(a){var s=this,T=this.fragCurrent,R=a.frag;if(T&&a.id==="audio"&&a.type==="audio"&&R.sn===T.sn&&R.level===T.level&&this.state===e.PARSING){var w=this.trackId,L=this.tracks[w],M=this.hls;isNaN(a.endPTS)&&(a.endPTS=a.startPTS+T.duration,a.endDTS=a.startDTS+T.duration),i.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),h.default.updateFragPTSDTS(L.details,T,a.startPTS,a.endPTS);var N=this.audioSwitch,U=this.media,C=!1;if(N&&U)if(U.readyState){var B=U.currentTime;i.logger.log("switching audio track : currentTime:"+B),B>=a.startPTS&&(i.logger.log("switching audio track : flushing all audio"),this.state=e.BUFFER_FLUSHING,M.trigger(f.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),C=!0,this.audioSwitch=!1,M.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:w}))}else this.audioSwitch=!1,M.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:w});var G=this.pendingData;this.audioSwitch||([a.data1,a.data2].forEach(function(H){H&&H.length&&G.push({type:a.type,data:H,parent:"audio",content:"data"})}),!C&&G.length&&(G.forEach(function(H){s.state===e.PARSING&&(s.pendingBuffering=!0,s.hls.trigger(f.default.BUFFER_APPENDING,H))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(a){var s=this.fragCurrent,T=a.frag;s&&a.id==="audio"&&T.sn===s.sn&&T.level===s.level&&this.state===e.PARSING&&(this.stats.tparsed=performance.now(),this.state=e.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(a){var s=a.tracks.audio;s&&(this.mediaBuffer=s.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(a){if(a.parent==="audio"){var s=this.state;(s===e.PARSING||s===e.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(this.state===e.PARSED&&(!this.appended||!this.pendingBuffering)){var a=this.fragCurrent,s=this.stats,T=this.hls;if(a){this.fragPrevious=a,s.tbuffered=performance.now(),T.trigger(f.default.FRAG_BUFFERED,{stats:s,frag:a,id:"audio"});var R=this.mediaBuffer?this.mediaBuffer:this.media;i.logger.log("audio buffered : "+t.default.toString(R.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,T.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=e.IDLE}this.tick()}}},{key:"onError",value:function(a){var s=a.frag;if(!(s&&s.type!=="audio"))switch(a.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var T=this.fragLoadError;T?T++:T=1;var R=this.config;if(T<=R.fragLoadingMaxRetry){this.fragLoadError=T,s.loadCounter=0;var w=Math.min(Math.pow(2,T-1)*R.fragLoadingRetryDelay,R.fragLoadingMaxRetryTimeout);i.logger.warn("audioStreamController: frag loading failed, retry in "+w+" ms"),this.retryDate=performance.now()+w,this.state=e.FRAG_LOADING_WAITING_RETRY}else i.logger.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=e.ERROR}break;case l.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==e.ERROR&&(this.state=a.fatal?e.ERROR:e.IDLE,i.logger.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="audio"&&(this.state===e.PARSING||this.state===e.PARSED)){var L=this.mediaBuffer,M=this.media.currentTime,N=L&&g.default.isBuffered(L,M)&&g.default.isBuffered(L,M+.5);if(N){var U=this.config;U.maxMaxBufferLength>=U.maxBufferLength&&(U.maxMaxBufferLength/=2,i.logger.warn("audio:reduce max buffer length to "+U.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*U.fragLoadingLoopThreshold),this.state=e.IDLE}else i.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=e.BUFFER_FLUSHING,this.hls.trigger(f.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}break}}},{key:"onBufferFlushed",value:function(){var a=this,s=this.pendingData;s&&s.length?(i.logger.log("appending pending audio data on Buffer Flushed"),s.forEach(function(T){a.hls.trigger(f.default.BUFFER_APPENDING,T)}),this.appended=!0,this.pendingData=[],this.state=e.PARSED):(this.state=e.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(a){if(this.state!==a){var s=this.state;this._state=a,i.logger.log("audio stream:"+s+"->"+a)}},get:function(){return this._state}}]),S}(v.default);D.default=o},{25:25,31:31,32:32,33:33,35:35,36:36,46:46,51:51,52:52}],7:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function c(h,d){for(var t=0;t<d.length;t++){var l=d[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(h,l.key,l)}}return function(h,d,t){return d&&c(h.prototype,d),t&&c(h,t),h}}(),F=A(33),k=n(F),O=A(32),g=n(O),m=A(51);function n(c){return c&&c.__esModule?c:{default:c}}function r(c,h){if(!(c instanceof h))throw new TypeError("Cannot call a class as a function")}function f(c,h){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h&&(typeof h=="object"||typeof h=="function")?h:c}function x(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);c.prototype=Object.create(h&&h.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(c,h):c.__proto__=h)}var v=function(c){x(h,c);function h(d){r(this,h);var t=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,d,k.default.MANIFEST_LOADING,k.default.MANIFEST_LOADED,k.default.AUDIO_TRACK_LOADED));return t.ticks=0,t.ontick=t.tick.bind(t),t}return I(h,[{key:"destroy",value:function(){g.default.prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,this.ticks===1&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(t){var l=this,i=t.audioTracks||[],u=!1;this.tracks=i,this.hls.trigger(k.default.AUDIO_TRACKS_UPDATED,{audioTracks:i});var p=0;i.forEach(function(_){if(_.default){l.audioTrack=p,u=!0;return}p++}),u===!1&&i.length&&(m.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(t){t.id<this.tracks.length&&(m.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,m.logger.log("switching to audioTrack "+t);var l=this.tracks[t],i=this.hls,u=l.type,p=l.url,_={id:t,type:u,url:p};i.trigger(k.default.AUDIO_TRACK_SWITCH,_),i.trigger(k.default.AUDIO_TRACK_SWITCHING,_);var y=l.details;p&&(y===void 0||y.live===!0)&&(m.logger.log("(re)loading playlist for audioTrack "+t),i.trigger(k.default.AUDIO_TRACK_LOADING,{url:p,id:t}))}}},{key:"updateTrack",value:function(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,m.logger.log("updating audioTrack "+t);var l=this.tracks[t],i=l.url,u=l.details;i&&(u===void 0||u.live===!0)&&(m.logger.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(k.default.AUDIO_TRACK_LOADING,{url:i,id:t}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){(this.trackId!==t||this.tracks[t].details===void 0)&&this.setAudioTrackInternal(t)}}]),h}(g.default);D.default=v},{32:32,33:33,51:51}],8:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function h(d,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(d,i.key,i)}}return function(d,t,l){return t&&h(d.prototype,t),l&&h(d,l),d}}(),F=A(33),k=r(F),O=A(32),g=r(O),m=A(51),n=A(31);function r(h){return h&&h.__esModule?h:{default:h}}function f(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}function x(h,d){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&(typeof d=="object"||typeof d=="function")?d:h}function v(h,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);h.prototype=Object.create(d&&d.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(h,d):h.__proto__=d)}var c=function(h){v(d,h);function d(t){f(this,d);var l=x(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,t,k.default.MEDIA_ATTACHING,k.default.MEDIA_DETACHING,k.default.MANIFEST_PARSED,k.default.BUFFER_RESET,k.default.BUFFER_APPENDING,k.default.BUFFER_CODECS,k.default.BUFFER_EOS,k.default.BUFFER_FLUSHING,k.default.LEVEL_PTS_UPDATED,k.default.LEVEL_UPDATED));return l._msDuration=null,l._levelDuration=null,l.onsbue=l.onSBUpdateEnd.bind(l),l.onsbe=l.onSBUpdateError.bind(l),l.pendingTracks={},l.tracks={},l}return I(d,[{key:"destroy",value:function(){g.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(l){var i=l.type,u=this.tracks.audio;if(i==="audio"&&u&&u.container==="audio/mpeg"){var p=this.sourceBuffer.audio,_=Math.abs(p.timestampOffset-l.start);if(_>.1){var y=p.updating;try{p.abort()}catch(e){y=!0,m.logger.warn("can not abort audio buffer: "+e)}y?this.audioTimestampOffset=l.start:(m.logger.warn("change mpeg audio timestamp offset from "+p.timestampOffset+" to "+l.start),p.timestampOffset=l.start)}}}},{key:"onManifestParsed",value:function(l){var i=l.audio,u=l.video,p=0;l.altAudio&&(i||u)&&(p=(i?1:0)+(u?1:0),m.logger.log(p+" sourceBuffer(s) expected")),this.sourceBufferNb=p}},{key:"onMediaAttaching",value:function(l){var i=this.media=l.media;if(i){var u=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),u.addEventListener("sourceopen",this.onmso),u.addEventListener("sourceended",this.onmse),u.addEventListener("sourceclose",this.onmsc),i.src=URL.createObjectURL(u)}}},{key:"onMediaDetaching",value:function(){m.logger.log("media source detaching");var l=this.mediaSource;if(l){if(l.readyState==="open")try{l.endOfStream()}catch(i){m.logger.warn("onMediaDetaching:"+i.message+" while calling endOfStream")}l.removeEventListener("sourceopen",this.onmso),l.removeEventListener("sourceended",this.onmse),l.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(k.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){m.logger.log("media source opened"),this.hls.trigger(k.default.MEDIA_ATTACHED,{media:this.media});var l=this.mediaSource;l&&l.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var l=this.pendingTracks,i=Object.keys(l).length;i&&(this.sourceBufferNb<=i||this.sourceBufferNb===0)&&(this.createSourceBuffers(l),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){m.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){m.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var l=this.sourceBuffer.audio;m.logger.warn("change mpeg audio timestamp offset from "+l.timestampOffset+" to "+this.audioTimestampOffset),l.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var i=this.parent,u=this.segments.reduce(function(p,_){return _.parent===i?p+1:p},0);this.hls.trigger(k.default.BUFFER_APPENDED,{parent:i,pending:u}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(l){m.logger.error("sourceBuffer error:",l),this.hls.trigger(k.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var l=this.sourceBuffer;for(var i in l){var u=l[i];try{this.mediaSource.removeSourceBuffer(u),u.removeEventListener("updateend",this.onsbue),u.removeEventListener("error",this.onsbe)}catch{}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(l){if(Object.keys(this.sourceBuffer).length===0){for(var i in l)this.pendingTracks[i]=l[i];var u=this.mediaSource;u&&u.readyState==="open"&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(l){var i=this.sourceBuffer,u=this.mediaSource;for(var p in l)if(!i[p]){var _=l[p],y=_.levelCodec||_.codec,e=_.container+";codecs="+y;m.logger.log("creating sourceBuffer("+e+")");try{var o=i[p]=u.addSourceBuffer(e);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[p]={codec:y,container:_.container},_.buffer=o}catch(E){m.logger.error("error while trying to add sourceBuffer:"+E.message),this.hls.trigger(k.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:E,mimeType:e})}}this.hls.trigger(k.default.BUFFER_CREATED,{tracks:l})}},{key:"onBufferAppending",value:function(l){this._needsFlush||(this.segments?this.segments.push(l):this.segments=[l],this.doAppending())}},{key:"onBufferAppendFail",value:function(l){m.logger.error("sourceBuffer error:",l.event),this.hls.trigger(k.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(l){var i=this.sourceBuffer,u=l.type;for(var p in i)(!u||p===u)&&(i[p].ended||(i[p].ended=!0,m.logger.log(p+" sourceBuffer now EOS")));this.checkEos()}},{key:"checkEos",value:function(){var l=this.sourceBuffer,i=this.mediaSource;if(!i||i.readyState!=="open"){this._needsEos=!1;return}for(var u in l){var p=l[u];if(!p.ended)return;if(p.updating){this._needsEos=!0;return}}m.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{i.endOfStream()}catch{m.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(l){this.flushRange.push({start:l.startOffset,end:l.endOffset,type:l.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(l){var i=l.details;i.fragments.length!==0&&(this._levelDuration=i.totalduration+i.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var l=this.media,i=this.mediaSource,u=this.sourceBuffer,p=this._levelDuration;if(!(p===null||!l||!i||!u||l.readyState===0||i.readyState!=="open")){for(var _ in u)if(u[_].updating)return;this._msDuration===null&&(this._msDuration=i.duration);var y=l.duration;(p>this._msDuration&&p>y||y===1/0||isNaN(y))&&(m.logger.log("Updating mediasource duration to "+p.toFixed(3)),this._msDuration=i.duration=p)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var l=this.flushRange[0];if(this.flushBuffer(l.start,l.end,l.type))this.flushRange.shift(),this.flushBufferCounter=0;else{this._needsFlush=!0;return}}if(this.flushRange.length===0){this._needsFlush=!1;var i=0,u=this.sourceBuffer;try{for(var p in u)i+=u[p].buffered.length}catch{m.logger.error("error while accessing sourceBuffer.buffered")}this.appended=i,this.hls.trigger(k.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var l=this.hls,i=this.sourceBuffer,u=this.segments;if(Object.keys(i).length){if(this.media.error){this.segments=[],m.logger.error("trying to append although a media error occured, flush segment and abort");return}if(this.appending)return;if(u&&u.length){var p=u.shift();try{var _=p.type,y=i[_];y?y.updating?u.unshift(p):(y.ended=!1,this.parent=p.parent,y.appendBuffer(p.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(o){m.logger.error("error while trying to append buffer:"+o.message),u.unshift(p);var e={type:n.ErrorTypes.MEDIA_ERROR,parent:p.parent};if(o.code!==22)if(this.appendError?this.appendError++:this.appendError=1,e.details=n.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>l.config.appendErrorMaxRetry){m.logger.log("fail "+l.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),u=[],e.fatal=!0,l.trigger(k.default.ERROR,e);return}else e.fatal=!1,l.trigger(k.default.ERROR,e);else{this.segments=[],e.details=n.ErrorDetails.BUFFER_FULL_ERROR,e.fatal=!1,l.trigger(k.default.ERROR,e);return}}}}}},{key:"flushBuffer",value:function(l,i,u){var p,_,y,e,o,E,S=this.sourceBuffer;if(Object.keys(S).length){if(m.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+l+"/"+i),this.flushBufferCounter<this.appended){for(var b in S)if(!(u&&b!==u)){if(p=S[b],p.ended=!1,p.updating)return m.logger.warn("cannot flush, sb updating in progress"),!1;try{for(_=0;_<p.buffered.length;_++)if(y=p.buffered.start(_),e=p.buffered.end(_),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&i===Number.POSITIVE_INFINITY?(o=l,E=i):(o=Math.max(y,l),E=Math.min(e,i)),Math.min(E,e)-o>.5)return this.flushBufferCounter++,m.logger.log("flush "+b+" ["+o+","+E+"], of ["+y+","+e+"], pos:"+this.media.currentTime),p.remove(o,E),!1}catch{m.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else m.logger.warn("abort flushing too many retries");m.logger.log("buffer flushed")}return!0}}]),d}(g.default);D.default=c},{31:31,32:32,33:33,51:51}],9:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function v(c,h){for(var d=0;d<h.length;d++){var t=h[d];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(c,t.key,t)}}return function(c,h,d){return h&&v(c.prototype,h),d&&v(c,d),c}}(),F=A(33),k=m(F),O=A(32),g=m(O);function m(v){return v&&v.__esModule?v:{default:v}}function n(v,c){if(!(v instanceof c))throw new TypeError("Cannot call a class as a function")}function r(v,c){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c&&(typeof c=="object"||typeof c=="function")?c:v}function f(v,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);v.prototype=Object.create(c&&c.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),c&&(Object.setPrototypeOf?Object.setPrototypeOf(v,c):v.__proto__=c)}var x=function(v){f(c,v);function c(h){return n(this,c),r(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,h,k.default.FPS_DROP_LEVEL_CAPPING,k.default.MEDIA_ATTACHING,k.default.MANIFEST_PARSED))}return I(c,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(d){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(d.droppedLevel)||this.restrictedLevels.push(d.droppedLevel)}},{key:"onMediaAttaching",value:function(d){this.media=d.media instanceof HTMLVideoElement?d.media:null}},{key:"onManifestParsed",value:function(d){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=d.levels,t.firstLevel=this.getMaxLevel(d.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var d=this.levels?this.levels.length:0;if(d){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(d-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(d){var t=0,l=void 0,i=void 0,u=this.mediaWidth,p=this.mediaHeight,_=0,y=0;for(l=0;l<=d&&(i=this.levels[l],!(this.isLevelRestricted(l)||(t=l,_=i.width,y=i.height,u<=_||p<=y)));l++);return t}},{key:"isLevelRestricted",value:function(d){return!!(this.restrictedLevels&&this.restrictedLevels.indexOf(d)!==-1)}},{key:"contentScaleFactor",get:function(){var d=1;try{d=window.devicePixelRatio}catch{}return d}},{key:"mediaWidth",get:function(){var d=void 0,t=this.media;return t&&(d=t.width||t.clientWidth||t.offsetWidth,d*=this.contentScaleFactor),d}},{key:"mediaHeight",get:function(){var d=void 0,t=this.media;return t&&(d=t.height||t.clientHeight||t.offsetHeight,d*=this.contentScaleFactor),d}}]),c}(g.default);D.default=x},{32:32,33:33}],10:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function c(h,d){for(var t=0;t<d.length;t++){var l=d[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(h,l.key,l)}}return function(h,d,t){return d&&c(h.prototype,d),t&&c(h,t),h}}(),F=A(33),k=n(F),O=A(32),g=n(O),m=A(51);function n(c){return c&&c.__esModule?c:{default:c}}function r(c,h){if(!(c instanceof h))throw new TypeError("Cannot call a class as a function")}function f(c,h){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h&&(typeof h=="object"||typeof h=="function")?h:c}function x(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);c.prototype=Object.create(h&&h.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(c,h):c.__proto__=h)}var v=function(c){x(h,c);function h(d){return r(this,h),f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,d,k.default.MEDIA_ATTACHING))}return I(h,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(t){var l=this.hls.config;if(l.capLevelOnFPSDrop){var i=this.video=t.media instanceof HTMLVideoElement?t.media:null;typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),l.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(t,l,i){var u=performance.now();if(l){if(this.lastTime){var p=u-this.lastTime,_=i-this.lastDroppedFrames,y=l-this.lastDecodedFrames,e=1e3*_/p,o=this.hls;if(o.trigger(k.default.FPS_DROP,{currentDropped:_,currentDecoded:y,totalDroppedFrames:i}),e>0&&_>o.config.fpsDroppedMonitoringThreshold*y){var E=o.currentLevel;m.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+E),E>0&&(o.autoLevelCapping===-1||o.autoLevelCapping>=E)&&(E=E-1,o.trigger(k.default.FPS_DROP_LEVEL_CAPPING,{level:E,droppedLevel:o.currentLevel}),o.autoLevelCapping=E,o.streamController.nextLevelSwitch())}}this.lastTime=u,this.lastDroppedFrames=i,this.lastDecodedFrames=l}}},{key:"checkFPSInterval",value:function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var l=t.getVideoPlaybackQuality();this.checkFPS(t,l.totalVideoFrames,l.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}]),h}(g.default);D.default=v},{32:32,33:33,51:51}],11:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function v(c,h){for(var d=0;d<h.length;d++){var t=h[d];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(c,t.key,t)}}return function(c,h,d){return h&&v(c.prototype,h),d&&v(c,d),c}}(),F=A(33),k=m(F),O=A(32),g=m(O);function m(v){return v&&v.__esModule?v:{default:v}}function n(v,c){if(!(v instanceof c))throw new TypeError("Cannot call a class as a function")}function r(v,c){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c&&(typeof c=="object"||typeof c=="function")?c:v}function f(v,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);v.prototype=Object.create(c&&c.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),c&&(Object.setPrototypeOf?Object.setPrototypeOf(v,c):v.__proto__=c)}var x=function(v){f(c,v);function c(h){n(this,c);var d=r(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,h,k.default.MEDIA_ATTACHED,k.default.MEDIA_DETACHING,k.default.FRAG_PARSING_METADATA));return d.id3Track=void 0,d.media=void 0,d}return I(c,[{key:"destroy",value:function(){g.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(d){this.media=d.media,this.media&&(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden")}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onFragParsingMetadata",value:function(d){var t=d.frag,l=d.samples,i=t.start,u=t.start+t.duration;i===u&&(u+=1e-4);for(var p=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,_=0;_<l.length;_++){var y=this.parseID3Frame(l[_].data),e=this.decodeID3Frame(y);if(e){var o=new p(i,u,"");o.value=e,this.id3Track.addCue(o)}}}},{key:"parseID3Frame",value:function(d){if(!(d.length<21)&&d[0]===73&&d[1]===68&&d[2]===51){var t=String.fromCharCode(d[10],d[11],d[12],d[13]);return d=d.subarray(20),{type:t,data:d}}}},{key:"decodeID3Frame",value:function(d){return d.type==="TXXX"?this.decodeTxxxFrame(d):d.type==="PRIV"?this.decodePrivFrame(d):d.type[0]==="T"?this.decodeTextFrame(d):void 0}},{key:"decodeTxxxFrame",value:function(d){if(!(d.size<2)&&d.data[0]===3){var t=1,l=this.utf8ArrayToStr(d.data.subarray(t));t+=l.length+1;var i=this.utf8ArrayToStr(d.data.subarray(t));return{key:"TXXX",description:l,data:i}}}},{key:"decodeTextFrame",value:function(d){if(!(d.size<2)&&d.data[0]===3){var t=d.data.subarray(1);return{key:d.type,data:this.utf8ArrayToStr(t)}}}},{key:"decodePrivFrame",value:function(d){if(!(d.size<2)){var t=this.utf8ArrayToStr(d.data),l=d.data.subarray(t.length+1);return{key:"PRIV",info:t,data:l.buffer}}}},{key:"utf8ArrayToStr",value:function(d){for(var t=void 0,l=void 0,i="",u=0,p=d.length;u<p;){var _=d[u++];switch(_>>4){case 0:return i;case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(_);break;case 12:case 13:t=d[u++],i+=String.fromCharCode((_&31)<<6|t&63);break;case 14:t=d[u++],l=d[u++],i+=String.fromCharCode((_&15)<<12|(t&63)<<6|(l&63)<<0);break}}return i}}]),c}(g.default);D.default=x},{32:32,33:33}],12:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function t(l,i){for(var u=0;u<i.length;u++){var p=i[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}return function(l,i,u){return i&&t(l.prototype,i),u&&t(l,u),l}}(),F=A(33),k=x(F),O=A(32),g=x(O),m=A(51),n=A(31),r=A(35),f=x(r);function x(t){return t&&t.__esModule?t:{default:t}}function v(t,l){if(!(t instanceof l))throw new TypeError("Cannot call a class as a function")}function c(t,l){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l&&(typeof l=="object"||typeof l=="function")?l:t}function h(t,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);t.prototype=Object.create(l&&l.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),l&&(Object.setPrototypeOf?Object.setPrototypeOf(t,l):t.__proto__=l)}var d=function(t){h(l,t);function l(i){v(this,l);var u=c(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,i,k.default.MANIFEST_LOADED,k.default.LEVEL_LOADED,k.default.FRAG_LOADED,k.default.ERROR));return u.ontick=u.tick.bind(u),u._manualLevel=-1,u}return I(l,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var u=this._levels;u&&u.forEach(function(p){p.loadError=0;var _=p.details;_&&_.live&&(p.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(u){var p=[],_=[],y,e={},o=!1,E=!1,S=this.hls,b=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),a=function(R,w){return MediaSource.isTypeSupported(R+"/mp4;codecs="+w)};if(u.levels.forEach(function(T){T.videoCodec&&(o=!0),b&&T.audioCodec&&T.audioCodec.indexOf("mp4a.40.34")!==-1&&(T.audioCodec=void 0),(T.audioCodec||T.attrs&&T.attrs.AUDIO)&&(E=!0);var R=e[T.bitrate];R===void 0?(e[T.bitrate]=p.length,T.url=[T.url],T.urlId=0,p.push(T)):p[R].url.push(T.url)}),o&&E?p.forEach(function(T){T.videoCodec&&_.push(T)}):_=p,_=_.filter(function(T){var R=T.audioCodec,w=T.videoCodec;return(!R||a("audio",R))&&(!w||a("video",w))}),_.length){y=_[0].bitrate,_.sort(function(T,R){return T.bitrate-R.bitrate}),this._levels=_;for(var s=0;s<_.length;s++)if(_[s].bitrate===y){this._firstLevel=s,m.logger.log("manifest loaded,"+_.length+" level(s) found, first bitrate:"+y);break}S.trigger(k.default.MANIFEST_PARSED,{levels:_,firstLevel:this._firstLevel,stats:u.stats,audio:E,video:o,altAudio:u.audioTracks.length>0})}else S.trigger(k.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:S.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(u){var p=this._levels,_=this.hls;if(u>=0&&u<p.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==u){m.logger.log("switching to level "+u),this._level=u;var y=p[u];y.level=u,_.trigger(k.default.LEVEL_SWITCH,y),_.trigger(k.default.LEVEL_SWITCHING,y)}var e=p[u],o=e.details;if(!o||o.live===!0){var E=e.urlId;_.trigger(k.default.LEVEL_LOADING,{url:e.url[E],level:u,id:E})}}else _.trigger(k.default.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.LEVEL_SWITCH_ERROR,level:u,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(u){if(!u.fatal){var p=u.details,_=this.hls,y=void 0,e=void 0,o=!1;switch(p){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:y=u.frag.level;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:y=u.context.level,o=!0;break;case n.ErrorDetails.REMUX_ALLOC_ERROR:y=u.level;break}if(y!==void 0){e=this._levels[y],e.loadError?e.loadError++:e.loadError=1;var E=e.url.length;if(E>1&&e.loadError<E)e.urlId=(e.urlId+1)%E,e.details=void 0,m.logger.warn("level controller,"+p+" for level "+y+": switching to redundant stream id "+e.urlId);else{var S=this._manualLevel===-1&&y;if(S)m.logger.warn("level controller,"+p+": switch-down for next fragment"),_.nextAutoLevel=Math.max(0,y-1);else if(e&&e.details&&e.details.live)m.logger.warn("level controller,"+p+" on live stream, discard"),o&&(this._level=void 0);else if(p===n.ErrorDetails.LEVEL_LOAD_ERROR||p===n.ErrorDetails.LEVEL_LOAD_TIMEOUT){var b=_.media,a=b&&f.default.isBuffered(b,b.currentTime)&&f.default.isBuffered(b,b.currentTime+.5);if(a){var s=_.config.levelLoadingRetryDelay;m.logger.warn("level controller,"+p+", but media buffered, retry in "+s+"ms"),this.timer=setTimeout(this.ontick,s)}else m.logger.error("cannot recover "+p+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),u.fatal=!0}}}}}},{key:"onFragLoaded",value:function(u){var p=u.frag;if(p&&p.type==="main"){var _=this._levels[p.level];_&&(_.loadError=0)}}},{key:"onLevelLoaded",value:function(u){var p=u.level;if(p===this._level){var _=this._levels[p];_.loadError=0;var y=u.details;if(y.live){var e=1e3*(y.averagetargetduration?y.averagetargetduration:y.targetduration),o=_.details;o&&y.endSN===o.endSN&&(e/=2,m.logger.log("same live playlist, reload twice faster")),e-=performance.now()-u.stats.trequest,e=Math.max(1e3,Math.round(e)),m.logger.log("live playlist, reload in "+e+" ms"),this.timer=setTimeout(this.ontick,e)}else this.timer=null}}},{key:"tick",value:function(){var u=this._level;if(u!==void 0&&this.canload){var p=this._levels[u];if(p&&p.url){var _=p.urlId;this.hls.trigger(k.default.LEVEL_LOADING,{url:p.url[_],level:u,id:_})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(u){var p=this._levels;p&&p.length>u&&(this._level!==u||p[u].details===void 0)&&this.setLevelInternal(u)}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(u){this._manualLevel=u,this._startLevel===void 0&&(this._startLevel=u),u!==-1&&(this.level=u)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(u){this._firstLevel=u}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var u=this.hls.config.startLevel;return u!==void 0?u:this._firstLevel}else return this._startLevel},set:function(u){this._startLevel=u}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.nextAutoLevel},set:function(u){this.level=u,this._manualLevel===-1&&(this.hls.nextAutoLevel=u)}}]),l}(g.default);D.default=d},{31:31,32:32,33:33,35:35,51:51}],13:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function E(S,b){for(var a=0;a<b.length;a++){var s=b[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(S,s.key,s)}}return function(S,b,a){return b&&E(S.prototype,b),a&&E(S,a),S}}(),F=A(46),k=u(F),O=A(35),g=u(O),m=A(25),n=u(m),r=A(33),f=u(r),x=A(32),v=u(x),c=A(36),h=u(c),d=A(52),t=u(d),l=A(31),i=A(51);function u(E){return E&&E.__esModule?E:{default:E}}function p(E,S){if(!(E instanceof S))throw new TypeError("Cannot call a class as a function")}function _(E,S){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S&&(typeof S=="object"||typeof S=="function")?S:E}function y(E,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof S);E.prototype=Object.create(S&&S.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),S&&(Object.setPrototypeOf?Object.setPrototypeOf(E,S):E.__proto__=S)}var e={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},o=function(E){y(S,E);function S(b){p(this,S);var a=_(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,b,f.default.MEDIA_ATTACHED,f.default.MEDIA_DETACHING,f.default.MANIFEST_LOADING,f.default.MANIFEST_PARSED,f.default.LEVEL_LOADED,f.default.KEY_LOADED,f.default.FRAG_LOADED,f.default.FRAG_LOAD_EMERGENCY_ABORTED,f.default.FRAG_PARSING_INIT_SEGMENT,f.default.FRAG_PARSING_DATA,f.default.FRAG_PARSED,f.default.ERROR,f.default.AUDIO_TRACK_SWITCHING,f.default.AUDIO_TRACK_SWITCHED,f.default.BUFFER_CREATED,f.default.BUFFER_APPENDED,f.default.BUFFER_FLUSHED));return a.config=b.config,a.audioCodecSwap=!1,a.ticks=0,a._state=e.STOPPED,a.ontick=a.tick.bind(a),a}return I(S,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),v.default.prototype.destroy.call(this),this.state=e.STOPPED}},{key:"startLoad",value:function(a){if(this.levels){var s=this.lastCurrentTime,T=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var R=T.startLevel;R===-1&&(R=0,this.bitrateTest=!0),this.level=T.nextLoadLevel=R,this.loadedmetadata=!1}s>0&&a===-1&&(i.logger.log("override startPosition with lastCurrentTime @"+s.toFixed(3)),a=s),this.state=e.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=e.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=e.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function(){this.ticks++,this.ticks===1&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case e.ERROR:break;case e.BUFFER_FLUSHING:this.fragLoadError=0;break;case e.IDLE:this._doTickIdle();break;case e.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=e.IDLE);break;case e.FRAG_LOADING_WAITING_RETRY:var s=performance.now(),T=this.retryDate;(!T||s>=T||this.media&&this.media.seeking)&&(i.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=e.IDLE);break}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var a=this.hls,s=a.config,T=this.media;if(!(this.levelLastLoaded!==void 0&&!T&&(this.startFragRequested||!s.startFragPrefetch))){var R=void 0;this.loadedmetadata?R=T.currentTime:R=this.nextLoadPosition;var w=a.nextLoadLevel,L=this.levels[w],M=L.bitrate,N=void 0;M?N=Math.max(8*s.maxBufferSize/M,s.maxBufferLength):N=s.maxBufferLength,N=Math.min(N,s.maxMaxBufferLength);var U=g.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:T,R,s.maxBufferHole),C=U.len;if(!(C>=N)){i.logger.trace("buffer length of "+C.toFixed(3)+" is below max of "+N.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=w;var B=L.details;if(typeof B>"u"||B.live&&this.levelLastLoaded!==w){this.state=e.WAITING_LEVEL;return}var G=this.fragPrevious;if(!B.live&&G&&G.sn===B.endSN){var H=Math.min(T.duration,G.start+G.duration);if(H-Math.max(U.end,G.start)<=Math.max(.2,G.duration/2)){var j={};this.altAudio&&(j.type="video"),this.hls.trigger(f.default.BUFFER_EOS,j),this.state=e.ENDED;return}}this._fetchPayloadOrEos(R,U,B)}}}},{key:"_fetchPayloadOrEos",value:function(a,s,T){var R=this.fragPrevious,w=this.level,L=T.fragments,M=L.length;if(M!==0){var N=L[0].start,U=L[M-1].start+L[M-1].duration,C=s.end,B=void 0;if(T.initSegment&&!T.initSegment.data)B=T.initSegment;else if(T.live){var G=this.config.initialLiveManifestSize;if(M<G){i.logger.warn("Can not start playback of a level, reason: not enough fragments "+M+" < "+G);return}if(B=this._ensureFragmentAtLivePoint(T,C,N,U,R,L,M),B===null)return}else C<N&&(B=L[0]);B||(B=this._findFragment(N,R,M,L,C,U,T)),B&&this._loadFragmentOrKey(B,w,T,a,C)}}},{key:"_ensureFragmentAtLivePoint",value:function(a,s,T,R,w,L,M){var N=this.hls.config,U=this.media,C=void 0,B=N.liveMaxLatencyDuration!==void 0?N.liveMaxLatencyDuration:N.liveMaxLatencyDurationCount*a.targetduration;if(s<Math.max(T-N.maxFragLookUpTolerance,R-B)){var G=this.liveSyncPosition=this.computeLivePosition(T,a);i.logger.log("buffer end: "+s.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+G.toFixed(3)),s=G,U&&U.readyState&&U.duration>G&&(U.currentTime=G)}if(a.PTSKnown&&s>R&&U&&U.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(w){var H=w.sn+1;H>=a.startSN&&H<=a.endSN&&(C=L[H-a.startSN],i.logger.log("live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=L[Math.min(M-1,Math.round(M/2))],i.logger.log("live playlist, switching playlist, unknown, load middle frag : "+C.sn))}return C}},{key:"_findFragment",value:function(a,s,T,R,w,L,M){var N=this.hls.config,U=void 0,C=void 0,B=N.maxFragLookUpTolerance,G=s?R[s.sn-R[0].sn+1]:void 0,H=function(z){var Y=Math.min(B,z.duration);return z.start+z.duration-Y<=w?1:z.start-Y>w&&z.start?-1:0};if(w<L?(w>L-B&&(B=0),G&&!H(G)?C=G:C=k.default.search(R,H)):C=R[T-1],C){U=C;var j=U.sn-M.startSN,X=s&&U.level===s.level,K=R[j-1],W=R[j+1];if(X&&U.sn===s.sn)if(U.sn<M.endSN){var q=s.deltaPTS;q&&q>N.maxBufferHole&&s.dropped&&j?(U=K,i.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),s.loadCounter--):(U=W,i.logger.log("SN just loaded, load next one: "+U.sn))}else U=null;else U.dropped&&!X&&(W&&W.backtracked?(i.logger.warn("Already backtracked from fragment "+(j+1)+", will not backtrack to fragment "+j+". Loading fragment "+(j+1)),U=W):(i.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),U.dropped=0,K?(K.loadCounter&&K.loadCounter--,U=K):U=null))}return U}},{key:"_loadFragmentOrKey",value:function(a,s,T,R,w){var L=this.hls,M=L.config;if(a.decryptdata&&a.decryptdata.uri!=null&&a.decryptdata.key==null)i.logger.log("Loading key for "+a.sn+" of ["+T.startSN+" ,"+T.endSN+"],level "+s),this.state=e.KEY_LOADING,L.trigger(f.default.KEY_LOADING,{frag:a});else{if(i.logger.log("Loading "+a.sn+" of ["+T.startSN+" ,"+T.endSN+"],level "+s+", currentTime:"+R.toFixed(3)+",bufferEnd:"+w.toFixed(3)),this.fragLoadIdx!==void 0?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var N=M.fragLoadingLoopThreshold;if(a.loadCounter>N&&Math.abs(this.fragLoadIdx-a.loadIdx)<N){L.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a});return}}else a.loadCounter=1;a.loadIdx=this.fragLoadIdx,this.fragCurrent=a,this.startFragRequested=!0,isNaN(a.sn)||(this.nextLoadPosition=a.start+a.duration),a.autoLevel=L.autoLevelEnabled,a.bitrateTest=this.bitrateTest,L.trigger(f.default.FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new n.default(L,"main")),this.state=e.FRAG_LOADING;return}}},{key:"getBufferedFrag",value:function(a){return k.default.search(this._bufferedFrags,function(s){return a<s.startPTS?-1:a>s.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(a){return a?this.getBufferedFrag(a.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var a,s,T=this.media;if(T&&T.readyState&&T.seeking===!1&&(s=T.currentTime,s>T.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=s),g.default.isBuffered(T,s)?a=this.getBufferedFrag(s):g.default.isBuffered(T,s+.1)&&(a=this.getBufferedFrag(s+.1)),a)){var R=a;if(R!==this.fragPlaying){this.hls.trigger(f.default.FRAG_CHANGED,{frag:R});var w=R.level;(!this.fragPlaying||this.fragPlaying.level!==w)&&this.hls.trigger(f.default.LEVEL_SWITCHED,{level:w}),this.fragPlaying=R}}}},{key:"immediateLevelSwitch",value:function(){if(i.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,s=void 0;a?(s=a.paused,a.pause()):s=!0,this.previouslyPaused=s}var T=this.fragCurrent;T&&T.loader&&T.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,g.default.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())}},{key:"nextLevelSwitch",value:function(){var a=this.media;if(a&&a.readyState){var s=void 0,T=void 0,R=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,T=this.getBufferedFrag(a.currentTime),T&&T.startPTS>1&&this.flushMainBuffer(0,T.startPTS-1),a.paused)s=0;else{var w=this.hls.nextLoadLevel,L=this.levels[w],M=this.fragLastKbps;M&&this.fragCurrent?s=this.fragCurrent.duration*L.bitrate/(1e3*M)+1:s=0}if(R=this.getBufferedFrag(a.currentTime+s),R&&(R=this.followingBufferedFrag(R),R)){var N=this.fragCurrent;N&&N.loader&&N.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(R.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(a,s){this.state=e.BUFFER_FLUSHING;var T={startOffset:a,endOffset:s};this.altAudio&&(T.type="video"),this.hls.trigger(f.default.BUFFER_FLUSHING,T)}},{key:"onMediaAttached",value:function(a){var s=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),s.addEventListener("seeking",this.onvseeking),s.addEventListener("seeked",this.onvseeked),s.addEventListener("ended",this.onvended);var T=this.config;this.levels&&T.autoStartLoad&&this.hls.startLoad(T.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(i.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var s=this.levels;s&&s.forEach(function(T){T.details&&T.details.fragments.forEach(function(R){R.loadCounter=void 0,R.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var a=this.media,s=a?a.currentTime:void 0,T=this.config;if(i.logger.log("media seeking to "+s.toFixed(3)),this.state===e.FRAG_LOADING){var R=this.mediaBuffer?this.mediaBuffer:a,w=g.default.bufferInfo(R,s,this.config.maxBufferHole),L=this.fragCurrent;if(w.len===0&&L){var M=T.maxFragLookUpTolerance,N=L.start-M,U=L.start+L.duration+M;s<N||s>U?(L.loader&&(i.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),L.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=e.IDLE):i.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===e.ENDED&&(this.state=e.IDLE);a&&(this.lastCurrentTime=s),this.state!==e.FRAG_LOADING&&this.fragLoadIdx!==void 0&&(this.fragLoadIdx+=2*T.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=s),this.tick()}},{key:"onMediaSeeked",value:function(){i.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){i.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){i.logger.log("trigger BUFFER_RESET"),this.hls.trigger(f.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(a){var s=!1,T=!1,R;a.levels.forEach(function(L){R=L.audioCodec,R&&(R.indexOf("mp4a.40.2")!==-1&&(s=!0),R.indexOf("mp4a.40.5")!==-1&&(T=!0))}),this.audioCodecSwitch=s&&T,this.audioCodecSwitch&&i.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var w=this.config;(w.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(w.startPosition)}},{key:"onLevelLoaded",value:function(a){var s=a.details,T=a.level,R=this.levels[T],w=s.totalduration,L=0;if(i.logger.log("level "+T+" loaded ["+s.startSN+","+s.endSN+"],duration:"+w),this.levelLastLoaded=T,s.live){var M=R.details;M&&s.fragments.length>0?(h.default.mergeDetails(M,s),L=s.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(L,M),s.PTSKnown?i.logger.log("live playlist sliding:"+L.toFixed(3)):i.logger.log("live playlist - outdated PTS, unknown sliding")):(s.PTSKnown=!1,i.logger.log("live playlist - first load, unknown sliding"))}else s.PTSKnown=!1;if(R.details=s,this.hls.trigger(f.default.LEVEL_UPDATED,{details:s,level:T}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var N=s.startTimeOffset;isNaN(N)?s.live?(this.startPosition=this.computeLivePosition(L,s),i.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(N<0&&(i.logger.log("negative start time offset "+N+", count from end of last fragment"),N=L+w+N),i.logger.log("start time offset found in playlist, adjust startPosition to "+N),this.startPosition=N),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===e.WAITING_LEVEL&&(this.state=e.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===e.KEY_LOADING&&(this.state=e.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var s=this.fragCurrent,T=a.frag;if(this.state===e.FRAG_LOADING&&s&&T.type==="main"&&T.level===s.level&&T.sn===s.sn){var R=a.stats,w=this.levels[s.level],L=w.details;if(i.logger.log("Loaded  "+s.sn+" of ["+L.startSN+" ,"+L.endSN+"],level "+s.level),this.bitrateTest=!1,this.stats=R,T.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=e.IDLE,this.startFragRequested=!1,R.tparsed=R.tbuffered=performance.now(),this.hls.trigger(f.default.FRAG_BUFFERED,{stats:R,frag:s,id:"main"}),this.tick();else if(T.sn==="initSegment")this.state=e.IDLE,R.tparsed=R.tbuffered=performance.now(),L.initSegment.data=a.payload,this.hls.trigger(f.default.FRAG_BUFFERED,{stats:R,frag:s,id:"main"}),this.tick();else{this.state=e.PARSING;var M=L.totalduration,N=s.level,U=s.sn,C=this.config.defaultAudioCodec||w.audioCodec;this.audioCodecSwap&&(i.logger.log("swapping playlist audio codec"),C===void 0&&(C=this.lastAudioCodec),C&&(C.indexOf("mp4a.40.5")!==-1?C="mp4a.40.2":C="mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,i.logger.log("Parsing "+U+" of ["+L.startSN+" ,"+L.endSN+"],level "+N+", cc "+s.cc);var B=this.demuxer;B||(B=this.demuxer=new n.default(this.hls,"main"));var G=this.media,H=G&&G.seeking,j=!H&&(L.PTSKnown||!L.live),X=L.initSegment?L.initSegment.data:[];B.push(a.payload,X,C,w.videoCodec,s,M,j,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var s=this.fragCurrent,T=a.frag;if(s&&a.id==="main"&&T.sn===s.sn&&T.level===s.level&&this.state===e.PARSING){var R=a.tracks,w,L;if(R.audio&&this.altAudio&&delete R.audio,L=R.audio,L){var M=this.levels[this.level].audioCodec,N=navigator.userAgent.toLowerCase();M&&this.audioCodecSwap&&(i.logger.log("swapping playlist audio codec"),M.indexOf("mp4a.40.5")!==-1?M="mp4a.40.2":M="mp4a.40.5"),this.audioCodecSwitch&&L.metadata.channelCount!==1&&N.indexOf("firefox")===-1&&(M="mp4a.40.5"),N.indexOf("android")!==-1&&L.container!=="audio/mpeg"&&(M="mp4a.40.2",i.logger.log("Android: force audio codec to "+M)),L.levelCodec=M,L.id=a.id}L=R.video,L&&(L.levelCodec=this.levels[this.level].videoCodec,L.id=a.id),this.hls.trigger(f.default.BUFFER_CODECS,R);for(w in R){L=R[w],i.logger.log("main track:"+w+",container:"+L.container+",codecs[level/parsed]=["+L.levelCodec+"/"+L.codec+"]");var U=L.initSegment;U&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(f.default.BUFFER_APPENDING,{type:w,data:U,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(a){var s=this,T=this.fragCurrent,R=a.frag;if(T&&a.id==="main"&&R.sn===T.sn&&R.level===T.level&&!(a.type==="audio"&&this.altAudio)&&this.state===e.PARSING){var w=this.levels[this.level],L=T;if(isNaN(a.endPTS)&&(a.endPTS=a.startPTS+T.duration,a.endDTS=a.startDTS+T.duration),i.logger.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0)),a.type==="video")if(L.dropped=a.dropped,L.dropped)if(L.backtracked)i.logger.warn("Already backtracked on this fragment, appending with the gap");else{L.backtracked=!0,this.nextLoadPosition=a.startPTS,this.state=e.IDLE,this.tick();return}else L.backtracked=!1;var M=h.default.updateFragPTSDTS(w.details,L,a.startPTS,a.endPTS,a.startDTS,a.endDTS),N=this.hls;N.trigger(f.default.LEVEL_PTS_UPDATED,{details:w.details,level:this.level,drift:M,type:a.type,start:a.startPTS,end:a.endPTS}),[a.data1,a.data2].forEach(function(U){U&&U.length&&s.state===e.PARSING&&(s.appended=!0,s.pendingBuffering=!0,N.trigger(f.default.BUFFER_APPENDING,{type:a.type,data:U,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(a){var s=this.fragCurrent,T=a.frag;s&&a.id==="main"&&T.sn===s.sn&&T.level===s.level&&this.state===e.PARSING&&(this.stats.tparsed=performance.now(),this.state=e.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(a){var s=!!a.url,T=a.id;if(!s){if(this.mediaBuffer!==this.media){i.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var R=this.fragCurrent;R.loader&&(i.logger.log("switching to main audio track, cancel main fragment load"),R.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=e.IDLE}var w=this.hls;w.trigger(f.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),w.trigger(f.default.AUDIO_TRACK_SWITCHED,{id:T}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(a){var s=a.id,T=!!this.hls.audioTracks[s].url;if(T){var R=this.videoBuffer;R&&this.mediaBuffer!==R&&(i.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=R)}this.altAudio=T,this.tick()}},{key:"onBufferCreated",value:function(a){var s=a.tracks,T=void 0,R=void 0,w=!1;for(var L in s){var M=s[L];M.id==="main"?(R=L,T=M,L==="video"&&(this.videoBuffer=s[L].buffer)):w=!0}w&&T?(i.logger.log("alternate track found, use "+R+".buffered to schedule main fragment loading"),this.mediaBuffer=T.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(a){if(a.parent==="main"){var s=this.state;(s===e.PARSING||s===e.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(this.state===e.PARSED&&(!this.appended||!this.pendingBuffering)){var a=this.fragCurrent;if(a){var s=this.mediaBuffer?this.mediaBuffer:this.media;i.logger.log("main buffered : "+t.default.toString(s.buffered));var T=this._bufferedFrags.filter(function(w){return g.default.isBuffered(s,(w.startPTS+w.endPTS)/2)});T.push(a),this._bufferedFrags=T.sort(function(w,L){return w.startPTS-L.startPTS}),this.fragPrevious=a;var R=this.stats;R.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*R.total/(R.tbuffered-R.tfirst)),this.hls.trigger(f.default.FRAG_BUFFERED,{stats:R,frag:a,id:"main"}),this.state=e.IDLE}this.tick()}}},{key:"onError",value:function(a){var s=a.frag||this.fragCurrent;if(!(s&&s.type!=="main")){var T=this.media,R=T&&g.default.isBuffered(T,T.currentTime)&&g.default.isBuffered(T,T.currentTime+.5);switch(a.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:if(!a.fatal){var w=this.fragLoadError;w?w++:w=1;var L=this.config;if(w<=L.fragLoadingMaxRetry||R||s.autoLevel&&s.level){this.fragLoadError=w,s.loadCounter=0;var M=Math.min(Math.pow(2,w-1)*L.fragLoadingRetryDelay,L.fragLoadingMaxRetryTimeout);i.logger.warn("mediaController: frag loading failed, retry in "+M+" ms"),this.retryDate=performance.now()+M,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=e.FRAG_LOADING_WAITING_RETRY}else i.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=e.ERROR}break;case l.ErrorDetails.FRAG_LOOP_LOADING_ERROR:a.fatal||(R?(this._reduceMaxBufferLength(s.duration),this.state=e.IDLE):(!s.autoLevel||s.level===0)&&(a.fatal=!0,this.state=e.ERROR));break;case l.ErrorDetails.LEVEL_LOAD_ERROR:case l.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==e.ERROR&&(a.fatal?(this.state=e.ERROR,i.logger.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):this.state===e.WAITING_LEVEL&&(this.state=e.IDLE));break;case l.ErrorDetails.BUFFER_FULL_ERROR:a.parent==="main"&&(this.state===e.PARSING||this.state===e.PARSED)&&(R?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=e.IDLE):(i.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break}}}},{key:"_reduceMaxBufferLength",value:function(a){var s=this.config;s.maxMaxBufferLength>=a&&(s.maxMaxBufferLength/=2,i.logger.warn("main:reduce max buffer length to "+s.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*s.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var a=this.media;if(a&&a.readyState){var s=a.currentTime,T=this.mediaBuffer?this.mediaBuffer:a,R=T.buffered;if(!this.loadedmetadata&&R.length){this.loadedmetadata=!0;var w=a.seeking?s:this.startPosition,L=g.default.isBuffered(T,w);(s!==w||!L)&&(i.logger.log("target start position:"+w),L||(w=R.start(0),i.logger.log("target start position not buffered, seek to buffered.start(0) "+w)),i.logger.log("adjust currentTime from "+s+" to "+w),a.currentTime=w)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var M=g.default.bufferInfo(a,s,0),N=!(a.paused||a.ended||a.buffered.length===0),U=.5,C=s!==this.lastCurrentTime,B=this.config;if(C)this.stallReported&&(i.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(N){var G=performance.now(),H=this.hls;if(!this.stalled)this.stalled=G,this.stallReported=!1;else{var j=G-this.stalled,X=M.len,K=this.nudgeRetry||0;if(X<=U&&j>B.lowBufferWatchdogPeriod*1e3){this.stallReported||(this.stallReported=!0,i.logger.warn("playback stalling in low buffer @"+s),H.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:X}));var W=M.nextStart,q=W-s;if(W&&q<B.maxSeekHole&&q>0){this.nudgeRetry=++K;var V=K*B.nudgeOffset;i.logger.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+W+" + nudge "+V),a.currentTime=W+V,this.stalled=void 0,H.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:W+V-s})}}else if(X>U&&j>B.highBufferWatchdogPeriod*1e3)if(this.stallReported||(this.stallReported=!0,i.logger.warn("playback stalling in high buffer @"+s),H.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:X})),this.stalled=void 0,this.nudgeRetry=++K,K<B.nudgeMaxRetry){var z=a.currentTime,Y=z+K*B.nudgeOffset;i.logger.log("adjust currentTime from "+z+" to "+Y),a.currentTime=Y,H.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else i.logger.error("still stuck in high buffer @"+s+" after "+B.nudgeMaxRetry+", raise fatal error"),H.trigger(f.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=e.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(s){return g.default.isBuffered(a,(s.startPTS+s.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=e.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(a,s){var T=this.config.liveSyncDuration!==void 0?this.config.liveSyncDuration:this.config.liveSyncDurationCount*s.targetduration;return a+Math.max(0,s.totalduration-T)}},{key:"state",set:function(a){if(this.state!==a){var s=this.state;this._state=a,i.logger.log("main stream:"+s+"->"+a),this.hls.trigger(f.default.STREAM_STATE_TRANSITION,{previousState:s,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var a=this.media;if(a){var s=this.getBufferedFrag(a.currentTime);if(s)return s.level}return-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),S}(v.default);D.default=o},{25:25,31:31,32:32,33:33,35:35,36:36,46:46,51:51,52:52}],14:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function c(h,d){for(var t=0;t<d.length;t++){var l=d[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(h,l.key,l)}}return function(h,d,t){return d&&c(h.prototype,d),t&&c(h,t),h}}(),F=A(33),k=n(F),O=A(32),g=n(O),m=A(51);function n(c){return c&&c.__esModule?c:{default:c}}function r(c,h){if(!(c instanceof h))throw new TypeError("Cannot call a class as a function")}function f(c,h){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h&&(typeof h=="object"||typeof h=="function")?h:c}function x(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);c.prototype=Object.create(h&&h.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(c,h):c.__proto__=h)}var v=function(c){x(h,c);function h(d){r(this,h);var t=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,d,k.default.ERROR,k.default.SUBTITLE_TRACKS_UPDATED,k.default.SUBTITLE_TRACK_SWITCH,k.default.SUBTITLE_TRACK_LOADED,k.default.SUBTITLE_FRAG_PROCESSED));return t.config=d.config,t.vttFragSNsProcessed={},t.vttFragQueues=void 0,t.currentlyProcessing=null,t.currentTrackId=-1,t}return I(h,[{key:"destroy",value:function(){g.default.prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function(){var t=this;this.vttFragQueues={},this.tracks.forEach(function(l){t.vttFragQueues[l.id]=[]})}},{key:"nextFrag",value:function(){if(this.currentlyProcessing===null&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(k.default.FRAG_LOADING,{frag:t})}}},{key:"onSubtitleFragProcessed",value:function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(t){var l=t.frag;l&&l.type!=="subtitle"||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(t){var l=this;m.logger.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(i){l.vttFragSNsProcessed[i.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(t){this.currentTrackId=t.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(t){var l=this.vttFragSNsProcessed[t.id],i=this.vttFragQueues[t.id],u=this.currentlyProcessing?this.currentlyProcessing.sn:-1,p=function(e){return l.indexOf(e.sn)>-1},_=function(e){return i.some(function(o){return o.sn===e.sn})};t.details.fragments.forEach(function(y){p(y)||y.sn===u||_(y)||(y.trackId=t.id,i.push(y))}),this.nextFrag()}}]),h}(g.default);D.default=v},{32:32,33:33,51:51}],15:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function h(d,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(d,i.key,i)}}return function(d,t,l){return t&&h(d.prototype,t),l&&h(d,l),d}}(),F=A(33),k=n(F),O=A(32),g=n(O),m=A(51);function n(h){return h&&h.__esModule?h:{default:h}}function r(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}function f(h,d){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&(typeof d=="object"||typeof d=="function")?d:h}function x(h,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);h.prototype=Object.create(d&&d.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(h,d):h.__proto__=d)}function v(h){for(var d=[],t=0;t<h.length;t++)h[t].kind==="subtitles"&&d.push(h[t]);return d}var c=function(h){x(d,h);function d(t){r(this,d);var l=f(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,t,k.default.MEDIA_ATTACHED,k.default.MEDIA_DETACHING,k.default.MANIFEST_LOADING,k.default.MANIFEST_LOADED,k.default.SUBTITLE_TRACK_LOADED));return l.tracks=[],l.trackId=-1,l.media=void 0,l}return I(d,[{key:"destroy",value:function(){g.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(l){var i=this;this.media=l.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(i.media){for(var u=-1,p=v(i.media.textTracks),_=0;_<p.length;_++)p[_].mode==="showing"&&(u=_);i.subtitleTrack=u}})}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(l){var i=this,u=l.subtitles||[];this.tracks=u,this.trackId=-1,this.hls.trigger(k.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:u}),u.forEach(function(p){p.default&&(i.subtitleTrack=p.id)})}},{key:"onTick",value:function(){var l=this.trackId,i=this.tracks[l];if(i){var u=i.details;(u===void 0||u.live===!0)&&(m.logger.log("(re)loading playlist for subtitle track "+l),this.hls.trigger(k.default.SUBTITLE_TRACK_LOADING,{url:i.url,id:l}))}}},{key:"onSubtitleTrackLoaded",value:function(l){var i=this;l.id<this.tracks.length&&(m.logger.log("subtitle track "+l.id+" loaded"),this.tracks[l.id].details=l.details,l.details.live&&!this.timer&&(this.timer=setInterval(function(){i.onTick()},1e3*l.details.targetduration,this)),!l.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(l){if(l>=0&&l<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=l,m.logger.log("switching to subtitle track "+l);var i=this.tracks[l];this.hls.trigger(k.default.SUBTITLE_TRACK_SWITCH,{id:l});var u=i.details;(u===void 0||u.live===!0)&&(m.logger.log("(re)loading playlist for subtitle track "+l),this.hls.trigger(k.default.SUBTITLE_TRACK_LOADING,{url:i.url,id:l}))}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(l){this.trackId!==l&&this.setSubtitleTrackInternal(l)}}]),d}(g.default);D.default=c},{32:32,33:33,51:51}],16:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function p(_,y){for(var e=0;e<y.length;e++){var o=y[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}return function(_,y,e){return y&&p(_.prototype,y),e&&p(_,e),_}}(),F=A(33),k=v(F),O=A(32),g=v(O),m=A(47),n=v(m),r=A(55),f=v(r),x=A(51);function v(p){return p&&p.__esModule?p:{default:p}}function c(p,_){if(!(p instanceof _))throw new TypeError("Cannot call a class as a function")}function h(p,_){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _&&(typeof _=="object"||typeof _=="function")?_:p}function d(p,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof _);p.prototype=Object.create(_&&_.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),_&&(Object.setPrototypeOf?Object.setPrototypeOf(p,_):p.__proto__=_)}function t(p){if(p&&p.cues)for(;p.cues.length>0;)p.removeCue(p.cues[0])}function l(p,_){return p&&p.label===_.name&&!(p.textTrack1||p.textTrack2)}function i(p,_,y,e){return Math.min(_,e)-Math.max(p,y)}var u=function(p){d(_,p);function _(y){c(this,_);var e=h(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,y,k.default.MEDIA_ATTACHING,k.default.MEDIA_DETACHING,k.default.FRAG_PARSING_USERDATA,k.default.MANIFEST_LOADING,k.default.MANIFEST_LOADED,k.default.FRAG_LOADED,k.default.LEVEL_SWITCHING,k.default.INIT_PTS_FOUND));if(e.hls=y,e.config=y.config,e.enabled=!0,e.Cues=y.config.cueHandler,e.textTracks=[],e.tracks=[],e.unparsedVttFrags=[],e.initPTS=void 0,e.cueRanges=[],e.config.enableCEA708Captions){var o=e,E=function(s,T){var R=null;try{R=new window.Event("addtrack")}catch{R=document.createEvent("Event"),R.initEvent("addtrack",!1,!1)}R.track=s,T.dispatchEvent(R)},S={newCue:function(s,T,R){if(!o.textTrack1){var w=o.getExistingTrack("1");if(w)o.textTrack1=w,t(o.textTrack1),E(o.textTrack1,o.media);else{var L=o.createTextTrack("captions",o.config.captionsTextTrack1Label,o.config.captionsTextTrack1LanguageCode);L&&(L.textTrack1=!0,o.textTrack1=L)}}o.addCues("textTrack1",s,T,R)}},b={newCue:function(s,T,R){if(!o.textTrack2){var w=o.getExistingTrack("2");if(w)o.textTrack2=w,t(o.textTrack2),E(o.textTrack2,o.media);else{var L=o.createTextTrack("captions",o.config.captionsTextTrack2Label,o.config.captionsTextTrack1LanguageCode);L&&(L.textTrack2=!0,o.textTrack2=L)}}o.addCues("textTrack2",s,T,R)}};e.cea608Parser=new n.default(0,S,b)}return e}return I(_,[{key:"addCues",value:function(e,o,E,S){for(var b=this.cueRanges,a=!1,s=b.length;s--;){var T=b[s],R=i(T[0],T[1],o,E);if(R>=0&&(T[0]=Math.min(T[0],o),T[1]=Math.max(T[1],E),a=!0,R/(E-o)>.5))return}a||b.push([o,E]),this.Cues.newCue(this[e],o,E,S)}},{key:"onInitPtsFound",value:function(e){var o=this;typeof this.initPTS>"u"&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(E){o.onFragLoaded(E)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function(e){var o=this.media;if(o)for(var E=0;E<o.textTracks.length;E++){var S=o.textTracks[E],b="textTrack"+e;if(S[b]===!0)return S}return null}},{key:"createTextTrack",value:function(e,o,E){var S=this.media;if(S)return S.addTextTrack(e,o,E)}},{key:"destroy",value:function(){g.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){t(this.textTrack1),t(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var e=this.media;if(e){var o=e.textTracks;if(o)for(var E=0;E<o.length;E++)t(o[E])}}},{key:"onManifestLoaded",value:function(e){var o=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var E=this.media?this.media.textTracks:[];this.tracks.forEach(function(S,b){var a=void 0;if(b<E.length){var s=E[b];l(s,S)&&(a=s)}a||(a=o.createTextTrack("subtitles",S.name,S.lang)),a.mode=S.default?"showing":"hidden",o.textTracks.push(a)})}}},{key:"onLevelSwitching",value:function(){this.enabled=this.hls.currentLevel.closedCaptions!=="NONE"}},{key:"onFragLoaded",value:function(e){var o=e.frag,E=e.payload;if(o.type==="main"){var S=o.sn;S!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=S}else if(o.type==="subtitle")if(E.byteLength){if(typeof this.initPTS>"u"){this.unparsedVttFrags.push(e);return}var b=this.vttCCs;b[o.cc]||(b[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc);var a=this.textTracks,s=this.hls;f.default.parse(E,this.initPTS,b,o.cc,function(T){T.forEach(function(R){a[o.trackId].addCue(R)}),s.trigger(k.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:o})},function(T){x.logger.log("Failed to parse VTT cue: "+T),s.trigger(k.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o})})}else this.hls.trigger(k.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o})}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var o=0;o<e.samples.length;o++){var E=this.extractCea608Data(e.samples[o].bytes);this.cea608Parser.addData(e.samples[o].pts,E)}}},{key:"extractCea608Data",value:function(e){for(var o=e[0]&31,E=2,S,b,a,s,T,R=[],w=0;w<o;w++)S=e[E++],b=127&e[E++],a=127&e[E++],s=(4&S)!==0,T=3&S,!(b===0&&a===0)&&s&&T===0&&(R.push(b),R.push(a));return R}}]),_}(g.default);D.default=u},{32:32,33:33,47:47,51:51,55:55}],17:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function O(g,m){for(var n=0;n<m.length;n++){var r=m[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(g,r.key,r)}}return function(g,m,n){return m&&O(g.prototype,m),n&&O(g,n),g}}();function F(O,g){if(!(O instanceof g))throw new TypeError("Cannot call a class as a function")}var k=function(){function O(g,m){F(this,O),this.subtle=g,this.aesIV=m}return I(O,[{key:"decrypt",value:function(m,n){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},n,m)}}]),O}();D.default=k},{}],18:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function O(g,m){for(var n=0;n<m.length;n++){var r=m[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(g,r.key,r)}}return function(g,m,n){return m&&O(g.prototype,m),n&&O(g,n),g}}();function F(O,g){if(!(O instanceof g))throw new TypeError("Cannot call a class as a function")}var k=function(){function O(){F(this,O),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return I(O,[{key:"uint8ArrayToUint32Array_",value:function(m){for(var n=new DataView(m),r=new Uint32Array(4),f=0;f<4;f++)r[f]=n.getUint32(f*4);return r}},{key:"initTable",value:function(){var m=this.sBox,n=this.invSBox,r=this.subMix,f=r[0],x=r[1],v=r[2],c=r[3],h=this.invSubMix,d=h[0],t=h[1],l=h[2],i=h[3],u=new Uint32Array(256),p=0,_=0,y=0;for(y=0;y<256;y++)y<128?u[y]=y<<1:u[y]=y<<1^283;for(y=0;y<256;y++){var e=_^_<<1^_<<2^_<<3^_<<4;e=e>>>8^e&255^99,m[p]=e,n[e]=p;var o=u[p],E=u[o],S=u[E],b=u[e]*257^e*16843008;f[p]=b<<24|b>>>8,x[p]=b<<16|b>>>16,v[p]=b<<8|b>>>24,c[p]=b,b=S*16843009^E*65537^o*257^p*16843008,d[e]=b<<24|b>>>8,t[e]=b<<16|b>>>16,l[e]=b<<8|b>>>24,i[e]=b,p?(p=o^u[u[u[S^o]]],_^=u[u[_]]):p=_=1}}},{key:"expandKey",value:function(m){for(var n=this.uint8ArrayToUint32Array_(m),r=!0,f=0;f<n.length&&r;)r=n[f]===this.key[f],f++;if(!r){this.key=n;var x=this.keySize=n.length;if(x!==4&&x!==6&&x!==8)throw new Error("Invalid aes key size="+x);var v=this.ksRows=(x+6+1)*4,c=void 0,h=void 0,d=this.keySchedule=new Uint32Array(v),t=this.invKeySchedule=new Uint32Array(v),l=this.sBox,i=this.rcon,u=this.invSubMix,p=u[0],_=u[1],y=u[2],e=u[3],o=void 0,E=void 0;for(c=0;c<v;c++){if(c<x){o=d[c]=n[c];continue}E=o,c%x===0?(E=E<<8|E>>>24,E=l[E>>>24]<<24|l[E>>>16&255]<<16|l[E>>>8&255]<<8|l[E&255],E^=i[c/x|0]<<24):x>6&&c%x===4&&(E=l[E>>>24]<<24|l[E>>>16&255]<<16|l[E>>>8&255]<<8|l[E&255]),d[c]=o=(d[c-x]^E)>>>0}for(h=0;h<v;h++)c=v-h,h&3?E=d[c]:E=d[c-4],h<4||c<=4?t[h]=E:t[h]=p[l[E>>>24]]^_[l[E>>>16&255]]^y[l[E>>>8&255]]^e[l[E&255]],t[h]=t[h]>>>0}}},{key:"networkToHostOrderSwap",value:function(m){return m<<24|(m&65280)<<8|(m&16711680)>>8|m>>>24}},{key:"decrypt",value:function(m,n,r){for(var f=this.keySize+6,x=this.invKeySchedule,v=this.invSBox,c=this.invSubMix,h=c[0],d=c[1],t=c[2],l=c[3],i=this.uint8ArrayToUint32Array_(r),u=i[0],p=i[1],_=i[2],y=i[3],e=new Int32Array(m),o=new Int32Array(e.length),E=void 0,S=void 0,b=void 0,a=void 0,s=void 0,T=void 0,R=void 0,w=void 0,L=void 0,M=void 0,N=void 0,U=void 0,C,B,G=this.networkToHostOrderSwap;n<e.length;){for(L=G(e[n]),M=G(e[n+1]),N=G(e[n+2]),U=G(e[n+3]),s=L^x[0],T=U^x[1],R=N^x[2],w=M^x[3],C=4,B=1;B<f;B++)E=h[s>>>24]^d[T>>16&255]^t[R>>8&255]^l[w&255]^x[C],S=h[T>>>24]^d[R>>16&255]^t[w>>8&255]^l[s&255]^x[C+1],b=h[R>>>24]^d[w>>16&255]^t[s>>8&255]^l[T&255]^x[C+2],a=h[w>>>24]^d[s>>16&255]^t[T>>8&255]^l[R&255]^x[C+3],s=E,T=S,R=b,w=a,C=C+4;E=v[s>>>24]<<24^v[T>>16&255]<<16^v[R>>8&255]<<8^v[w&255]^x[C],S=v[T>>>24]<<24^v[R>>16&255]<<16^v[w>>8&255]<<8^v[s&255]^x[C+1],b=v[R>>>24]<<24^v[w>>16&255]<<16^v[s>>8&255]<<8^v[T&255]^x[C+2],a=v[w>>>24]<<24^v[s>>16&255]<<16^v[T>>8&255]<<8^v[R&255]^x[C+3],C=C+3,o[n]=G(E^u),o[n+1]=G(a^p),o[n+2]=G(b^_),o[n+3]=G(S^y),u=L,p=M,_=N,y=U,n=n+4}return o.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),O}();D.default=k},{}],19:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function h(d,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(d,i.key,i)}}return function(d,t,l){return t&&h(d.prototype,t),l&&h(d,l),d}}(),F=A(17),k=x(F),O=A(20),g=x(O),m=A(18),n=x(m),r=A(31),f=A(51);function x(h){return h&&h.__esModule?h:{default:h}}function v(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}var c=function(){function h(d,t){v(this,h),this.observer=d,this.config=t,this.logEnabled=!0;try{var l=crypto||self.crypto;this.subtle=l.subtle||l.webkitSubtle}catch{}this.disableWebCrypto=!this.subtle}return I(h,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(t,l,i,u){var p=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(f.logger.log("JS AES decrypt"),this.logEnabled=!1);var _=this.decryptor;_||(this.decryptor=_=new n.default),_.expandKey(l),u(_.decrypt(t,0,i))}else{this.logEnabled&&(f.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var y=this.subtle;this.key!==l&&(this.key=l,this.fastAesKey=new g.default(y,l)),this.fastAesKey.expandKey().then(function(e){var o=new k.default(y,i);o.decrypt(t,e).catch(function(E){p.onWebCryptoError(E,t,l,i,u)}).then(function(E){u(E)})}).catch(function(e){p.onWebCryptoError(e,t,l,i,u)})}}},{key:"onWebCryptoError",value:function(t,l,i,u,p){this.config.enableSoftwareAES?(f.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(l,i,u,p)):(f.logger.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))}},{key:"destroy",value:function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)}}]),h}();D.default=c},{17:17,18:18,20:20,31:31,51:51}],20:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function O(g,m){for(var n=0;n<m.length;n++){var r=m[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(g,r.key,r)}}return function(g,m,n){return m&&O(g.prototype,m),n&&O(g,n),g}}();function F(O,g){if(!(O instanceof g))throw new TypeError("Cannot call a class as a function")}var k=function(){function O(g,m){F(this,O),this.subtle=g,this.key=m}return I(O,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),O}();D.default=k},{}],21:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function x(v,c){for(var h=0;h<c.length;h++){var d=c[h];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(v,d.key,d)}}return function(v,c,h){return c&&x(v.prototype,c),h&&x(v,h),v}}(),F=A(22),k=n(F),O=A(51),g=A(27),m=n(g);function n(x){return x&&x.__esModule?x:{default:x}}function r(x,v){if(!(x instanceof v))throw new TypeError("Cannot call a class as a function")}var f=function(){function x(v,c,h){r(this,x),this.observer=v,this.config=h,this.remuxer=c}return I(x,[{key:"resetInitSegment",value:function(c,h,d,t){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:h,duration:t,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(c,h,d,t){var l,i=new m.default(c),u=90*i.timeStamp,p,_,y,e,o,E,S,b,a;for(l=this._aacTrack,o=i.length,b=c.length;o<b-1&&!(c[o]===255&&(c[o+1]&240)===240);o++);for(l.samplerate||(p=k.default.getAudioConfig(this.observer,c,o,l.manifestCodec),l.config=p.config,l.samplerate=p.samplerate,l.channelCount=p.channelCount,l.codec=p.codec,O.logger.log("parsed codec:"+l.codec+",rate:"+p.samplerate+",nb channel:"+p.channelCount)),e=0,y=1024*9e4/l.samplerate;o+5<b&&(E=c[o+1]&1?7:9,_=(c[o+3]&3)<<11|c[o+4]<<3|(c[o+5]&224)>>>5,_-=E,_>0&&o+E+_<=b);)for(S=u+e*y,a={unit:c.subarray(o+E,o+E+_),pts:S,dts:S},l.samples.push(a),l.len+=_,o+=_+E,e++;o<b-1&&!(c[o]===255&&(c[o+1]&240)===240);o++);this.remuxer.remux(l,{samples:[]},{samples:[{pts:u,dts:u,unit:i.payload}],inputTimeScale:9e4},{samples:[]},h,d,t)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(c){var h=new m.default(c),d,t;if(h.hasTimeStamp){for(d=h.length,t=c.length;d<t-1;d++)if(c[d]===255&&(c[d+1]&240)===240)return!0}return!1}}]),x}();D.default=f},{22:22,27:27,51:51}],22:[function(A,P,D){var I=A(51),F=A(31),k={getAudioConfig:function(g,m,n,r){var f,x,v,c,h,d=navigator.userAgent.toLowerCase(),t=r,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(f=((m[n+2]&192)>>>6)+1,x=(m[n+2]&60)>>>2,x>l.length-1){g.trigger(Event.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+x});return}return c=(m[n+2]&1)<<2,c|=(m[n+3]&192)>>>6,I.logger.log("manifest codec:"+r+",ADTS data:type:"+f+",sampleingIndex:"+x+"["+l[x]+"Hz],channelConfig:"+c),/firefox/i.test(d)?x>=6?(f=5,h=new Array(4),v=x-3):(f=2,h=new Array(2),v=x):d.indexOf("android")!==-1?(f=2,h=new Array(2),v=x):(f=5,h=new Array(4),r&&(r.indexOf("mp4a.40.29")!==-1||r.indexOf("mp4a.40.5")!==-1)||!r&&x>=6?v=x-3:((r&&r.indexOf("mp4a.40.2")!==-1&&x>=6&&c===1||!r&&c===1)&&(f=2,h=new Array(2)),v=x)),h[0]=f<<3,h[0]|=(x&14)>>1,h[1]|=(x&1)<<7,h[1]|=c<<3,f===5&&(h[1]|=(v&14)>>1,h[2]=(v&1)<<7,h[2]|=8,h[3]=0),{config:h,samplerate:l[x],channelCount:c,codec:"mp4a.40."+f,manifestCodec:t}}};P.exports=k},{31:31,51:51}],23:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function _(y,e){for(var o=0;o<e.length;o++){var E=e[o];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(y,E.key,E)}}return function(y,e,o){return e&&_(y.prototype,e),o&&_(y,o),y}}(),F=A(33),k=i(F),O=A(31),g=A(19),m=i(g),n=A(21),r=i(n),f=A(28),x=i(f),v=A(30),c=i(v),h=A(43),d=i(h),t=A(44),l=i(t);function i(_){return _&&_.__esModule?_:{default:_}}function u(_,y){if(!(_ instanceof y))throw new TypeError("Cannot call a class as a function")}var p=function(){function _(y,e,o,E){u(this,_),this.observer=y,this.typeSupported=e,this.config=o,this.vendor=E}return I(_,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,o,E,S,b,a,s,T,R,w,L,M){if(e.byteLength>0&&o!=null&&o.key!=null&&o.method==="AES-128"){var N=this.decrypter;N==null&&(N=this.decrypter=new m.default(this.observer,this.config));var U=this,C;try{C=performance.now()}catch{C=Date.now()}N.decrypt(e,o.key.buffer,o.iv.buffer,function(B){var G;try{G=performance.now()}catch{G=Date.now()}U.observer.trigger(k.default.FRAG_DECRYPTED,{stats:{tstart:C,tdecrypt:G}}),U.pushDecrypted(new Uint8Array(B),o,new Uint8Array(E),S,b,a,s,T,R,w,L,M)})}else this.pushDecrypted(new Uint8Array(e),o,new Uint8Array(E),S,b,a,s,T,R,w,L,M)}},{key:"pushDecrypted",value:function(e,o,E,S,b,a,s,T,R,w,L,M){var N=this.demuxer;if(!N||s&&!this.probe(e)){var U=this.observer,C=this.typeSupported,B=this.config,G=[{demux:c.default,remux:d.default},{demux:r.default,remux:d.default},{demux:x.default,remux:l.default}];for(var H in G){var j=G[H],X=j.demux.probe;if(X(e)){var K=this.remuxer=new j.remux(U,B,C,this.vendor);N=new j.demux(U,K,B,C),this.probe=X;break}}if(!N){U.trigger(k.default.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});return}this.demuxer=N}var W=this.remuxer;(s||T)&&(N.resetInitSegment(E,S,b,w),W.resetInitSegment()),s&&(N.resetTimeStamp(),W.resetTimeStamp(M)),typeof N.setDecryptData=="function"&&N.setDecryptData(o),N.append(e,a,R,L)}}]),_}();D.default=p},{19:19,21:21,28:28,30:30,31:31,33:33,43:43,44:44}],24:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=A(23),F=r(I),k=A(33),O=r(k),g=A(51),m=A(1),n=r(m);function r(x){return x&&x.__esModule?x:{default:x}}var f=function(v){var c=new n.default;c.trigger=function(t){for(var l=arguments.length,i=Array(l>1?l-1:0),u=1;u<l;u++)i[u-1]=arguments[u];c.emit.apply(c,[t,t].concat(i))},c.off=function(t){for(var l=arguments.length,i=Array(l>1?l-1:0),u=1;u<l;u++)i[u-1]=arguments[u];c.removeListener.apply(c,[t].concat(i))};var h=function(t,l){v.postMessage({event:t,data:l})};v.addEventListener("message",function(d){var t=d.data;switch(t.cmd){case"init":var l=JSON.parse(t.config);v.demuxer=new F.default(c,t.typeSupported,l,t.vendor);try{(0,g.enableLogs)(l.debug===!0)}catch{console.warn("demuxerWorker: unable to enable logs")}h("init",null);break;case"demux":v.demuxer.push(t.data,t.decryptdata,t.initSegment,t.audioCodec,t.videoCodec,t.timeOffset,t.discontinuity,t.trackSwitch,t.contiguous,t.duration,t.accurateTimeOffset,t.defaultInitPTS);break}}),c.on(O.default.FRAG_DECRYPTED,h),c.on(O.default.FRAG_PARSING_INIT_SEGMENT,h),c.on(O.default.FRAG_PARSED,h),c.on(O.default.ERROR,h),c.on(O.default.FRAG_PARSING_METADATA,h),c.on(O.default.FRAG_PARSING_USERDATA,h),c.on(O.default.INIT_PTS_FOUND,h),c.on(O.default.FRAG_PARSING_DATA,function(d,t){var l=[],i={event:d,data:t};t.data1&&(i.data1=t.data1.buffer,l.push(t.data1.buffer),delete t.data1),t.data2&&(i.data2=t.data2.buffer,l.push(t.data2.buffer),delete t.data2),v.postMessage(i,l)})};D.default=f},{1:1,23:23,33:33,51:51}],25:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function t(l,i){for(var u=0;u<i.length;u++){var p=i[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}return function(l,i,u){return i&&t(l.prototype,i),u&&t(l,u),l}}(),F=A(33),k=c(F),O=A(23),g=c(O),m=A(24),n=c(m),r=A(51),f=A(31),x=A(1),v=c(x);function c(t){return t&&t.__esModule?t:{default:t}}function h(t,l){if(!(t instanceof l))throw new TypeError("Cannot call a class as a function")}var d=function(){function t(l,i){h(this,t),this.hls=l,this.id=i;var u=this.observer=new v.default,p=l.config;u.trigger=function(b){for(var a=arguments.length,s=Array(a>1?a-1:0),T=1;T<a;T++)s[T-1]=arguments[T];u.emit.apply(u,[b,b].concat(s))},u.off=function(b){for(var a=arguments.length,s=Array(a>1?a-1:0),T=1;T<a;T++)s[T-1]=arguments[T];u.removeListener.apply(u,[b].concat(s))};var _=(function(S,b){b=b||{},b.frag=this.frag,b.id=this.id,l.trigger(S,b)}).bind(this);u.on(k.default.FRAG_DECRYPTED,_),u.on(k.default.FRAG_PARSING_INIT_SEGMENT,_),u.on(k.default.FRAG_PARSING_DATA,_),u.on(k.default.FRAG_PARSED,_),u.on(k.default.ERROR,_),u.on(k.default.FRAG_PARSING_METADATA,_),u.on(k.default.FRAG_PARSING_USERDATA,_),u.on(k.default.INIT_PTS_FOUND,_);var y={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},e=navigator.vendor;if(p.enableWorker&&typeof Worker<"u"){r.logger.log("demuxing in webworker");var o=void 0;try{var E=A(3);o=this.w=E(n.default),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(S){l.trigger(k.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:S.message+" ("+S.filename+":"+S.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:y,vendor:e,id:i,config:JSON.stringify(p)})}catch{r.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&URL.revokeObjectURL(o.objectURL),this.demuxer=new g.default(u,y,p,e),this.w=void 0}}else this.demuxer=new g.default(u,y,p,e)}return I(t,[{key:"destroy",value:function(){var i=this.w;if(i)i.removeEventListener("message",this.onwmsg),i.terminate(),this.w=null;else{var u=this.demuxer;u&&(u.destroy(),this.demuxer=null)}var p=this.observer;p&&(p.removeAllListeners(),this.observer=null)}},{key:"push",value:function(i,u,p,_,y,e,o,E){var S=this.w,b=isNaN(y.startDTS)?y.start:y.startDTS,a=y.decryptdata,s=this.frag,T=!(s&&y.cc===s.cc),R=!(s&&y.level===s.level),w=s&&y.sn===s.sn+1,L=!R&&w;if(T&&r.logger.log(this.id+":discontinuity detected"),R&&r.logger.log(this.id+":switch detected"),this.frag=y,S)S.postMessage({cmd:"demux",data:i,decryptdata:a,initSegment:u,audioCodec:p,videoCodec:_,timeOffset:b,discontinuity:T,trackSwitch:R,contiguous:L,duration:e,accurateTimeOffset:o,defaultInitPTS:E},[i]);else{var M=this.demuxer;M&&M.push(i,a,u,p,_,b,T,R,L,e,o,E)}}},{key:"onWorkerMessage",value:function(i){var u=i.data,p=this.hls;switch(u.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case k.default.FRAG_PARSING_DATA:u.data.data1=new Uint8Array(u.data1),u.data2&&(u.data.data2=new Uint8Array(u.data2));default:u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,p.trigger(u.event,u.data);break}}}]),t}();D.default=d},{1:1,23:23,24:24,3:3,31:31,33:33,51:51}],26:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function g(m,n){for(var r=0;r<n.length;r++){var f=n[r];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(m,f.key,f)}}return function(m,n,r){return n&&g(m.prototype,n),r&&g(m,r),m}}(),F=A(51);function k(g,m){if(!(g instanceof m))throw new TypeError("Cannot call a class as a function")}var O=function(){function g(m){k(this,g),this.data=m,this.bytesAvailable=m.byteLength,this.word=0,this.bitsAvailable=0}return I(g,[{key:"loadWord",value:function(){var n=this.data,r=this.bytesAvailable,f=n.byteLength-r,x=new Uint8Array(4),v=Math.min(4,r);if(v===0)throw new Error("no bytes available");x.set(n.subarray(f,f+v)),this.word=new DataView(x.buffer).getUint32(0),this.bitsAvailable=v*8,this.bytesAvailable-=v}},{key:"skipBits",value:function(n){var r;this.bitsAvailable>n?(this.word<<=n,this.bitsAvailable-=n):(n-=this.bitsAvailable,r=n>>3,n-=r>>3,this.bytesAvailable-=r,this.loadWord(),this.word<<=n,this.bitsAvailable-=n)}},{key:"readBits",value:function(n){var r=Math.min(this.bitsAvailable,n),f=this.word>>>32-r;return n>32&&F.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=r,this.bitsAvailable>0?this.word<<=r:this.bytesAvailable>0&&this.loadWord(),r=n-r,r>0&&this.bitsAvailable?f<<r|this.readBits(r):f}},{key:"skipLZ",value:function(){var n;for(n=0;n<this.bitsAvailable;++n)if(this.word&2147483648>>>n)return this.word<<=n,this.bitsAvailable-=n,n;return this.loadWord(),n+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var n=this.skipLZ();return this.readBits(n+1)-1}},{key:"readEG",value:function(){var n=this.readUEG();return 1&n?1+n>>>1:-1*(n>>>1)}},{key:"readBoolean",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(n){var r=8,f=8,x,v;for(x=0;x<n;x++)f!==0&&(v=this.readEG(),f=(r+v+256)%256),r=f===0?r:f}},{key:"readSPS",value:function(){var n=0,r=0,f=0,x=0,v,c,h,d,t,l,i,u=this.readUByte.bind(this),p=this.readBits.bind(this),_=this.readUEG.bind(this),y=this.readBoolean.bind(this),e=this.skipBits.bind(this),o=this.skipEG.bind(this),E=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);if(u(),v=u(),p(5),e(3),u(),E(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var b=_();if(b===3&&e(1),E(),E(),e(1),y())for(l=b!==3?8:12,i=0;i<l;i++)y()&&(i<6?S(16):S(64))}E();var a=_();if(a===0)_();else if(a===1)for(e(1),o(),o(),c=_(),i=0;i<c;i++)o();E(),e(1),h=_(),d=_(),t=p(1),t===0&&e(1),e(1),y()&&(n=_(),r=_(),f=_(),x=_());var s=[1,1];if(y()&&y()){var T=u();switch(T){case 1:s=[1,1];break;case 2:s=[12,11];break;case 3:s=[10,11];break;case 4:s=[16,11];break;case 5:s=[40,33];break;case 6:s=[24,11];break;case 7:s=[20,11];break;case 8:s=[32,11];break;case 9:s=[80,33];break;case 10:s=[18,11];break;case 11:s=[15,11];break;case 12:s=[64,33];break;case 13:s=[160,99];break;case 14:s=[4,3];break;case 15:s=[3,2];break;case 16:s=[2,1];break;case 255:{s=[u()<<8|u(),u()<<8|u()];break}}}return{width:Math.ceil((h+1)*16-n*2-r*2),height:(2-t)*(d+1)*16-(t?2:4)*(f+x),pixelRatio:s}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),g}();D.default=O},{51:51}],27:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function g(m,n){for(var r=0;r<n.length;r++){var f=n[r];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(m,f.key,f)}}return function(m,n,r){return n&&g(m.prototype,n),r&&g(m,r),m}}(),F=A(51);function k(g,m){if(!(g instanceof m))throw new TypeError("Cannot call a class as a function")}var O=function(){function g(m){k(this,g),this._hasTimeStamp=!1;var n=0,r,f,x,v,c,h,d,t;do if(d=this.readUTF(m,n,3),n+=3,d==="ID3")n+=3,r=m[n++]&127,f=m[n++]&127,x=m[n++]&127,v=m[n++]&127,c=(r<<21)+(f<<14)+(x<<7)+v,h=n+c,this._parseID3Frames(m,n,h),n=h;else if(d==="3DI")n+=7,F.logger.log("3DI footer found, end: "+n);else{n-=3,t=n,t&&(this.hasTimeStamp||F.logger.warn("ID3 tag found, but no timestamp"),this._length=t,this._payload=m.subarray(0,t));return}while(!0)}return I(g,[{key:"readUTF",value:function(n,r,f){var x="",v=r,c=r+f;do x+=String.fromCharCode(n[v++]);while(v<c);return x}},{key:"_parseID3Frames",value:function(n,r,f){for(var x,v;r+8<=f;)switch(x=this.readUTF(n,r,4),r+=4,n[r++]<<24+n[r++]<<16+n[r++]<<8+n[r++],n[r++]<<8+n[r++],x){case"PRIV":if(this.readUTF(n,r,44)==="com.apple.streaming.transportStreamTimestamp"){r+=44,r+=4;var c=n[r++]&1;this._hasTimeStamp=!0,v=((n[r++]<<23)+(n[r++]<<15)+(n[r++]<<7)+n[r++])/45,c&&(v+=4772185884e-2),v=Math.round(v),F.logger.trace("ID3 timestamp found: "+v),this._timeStamp=v}break}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),g}();D.default=O},{51:51}],28:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function n(r,f){for(var x=0;x<f.length;x++){var v=f[x];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(r,v.key,v)}}return function(r,f,x){return f&&n(r.prototype,f),x&&n(r,x),r}}(),F=A(33),k=O(F);function O(n){return n&&n.__esModule?n:{default:n}}function g(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}var m=function(){function n(r,f){g(this,n),this.observer=r,this.remuxer=f}return I(n,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(f,x,v,c){var h=this.initData=n.parseInitSegment(f),d={};h.audio&&(d.audio={container:"audio/mp4",codec:x,initSegment:f}),h.video&&(d.video={container:"video/mp4",codec:v,initSegment:f}),this.observer.trigger(k.default.FRAG_PARSING_INIT_SEGMENT,{tracks:d})}},{key:"append",value:function(f,x,v,c){var h=this.initData,d=n.startDTS(h,f);this.remuxer.remux(h.audio,h.video,null,null,d,v,c,f)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(f){if(f.length>=8){var x=n.bin2str(f.subarray(4,8));return["moof","ftyp","styp"].indexOf(x)>=0}return!1}},{key:"bin2str",value:function(f){return String.fromCharCode.apply(null,f)}},{key:"findBox",value:function(f,x){var v=[],c,h,d,t,l;if(!x.length)return null;for(c=0;c<f.byteLength;)h=f[c]<<24,h|=f[c+1]<<16,h|=f[c+2]<<8,h|=f[c+3],d=n.bin2str(f.subarray(c+4,c+8)),t=h>1?c+h:f.byteLength,d===x[0]&&(x.length===1?v.push(f.subarray(c+8,t)):(l=n.findBox(f.subarray(c+8,t),x.slice(1)),l.length&&(v=v.concat(l)))),c=t;return v}},{key:"parseInitSegment",value:function(f){var x=[],v=n.findBox(f,["moov","trak"]);return v.forEach(function(c){var h=n.findBox(c,["tkhd"])[0];if(h){var d=h[0],t=d===0?12:20,l=h[t]<<24|h[t+1]<<16|h[t+2]<<8|h[t+3];l=l<0?4294967296+l:l;var i=n.findBox(c,["mdia","mdhd"])[0];if(i){d=i[0],t=d===0?12:20;var u=i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3],p=n.findBox(c,["mdia","hdlr"])[0];if(p){var _=n.bin2str(p.subarray(8,12)),y={soun:"audio",vide:"video"}[_];y&&(x[l]={timescale:u,type:y},x[y]={timescale:u,id:l})}}}}),x}},{key:"startDTS",value:function(f,x){var v,c,h;return v=n.findBox(x,["moof","traf"]),c=[].concat.apply([],v.map(function(d){return n.findBox(d,["tfhd"]).map(function(t){var l,i,u;return l=t[4]<<24|t[5]<<16|t[6]<<8|t[7],i=f[l].timescale||9e4,u=n.findBox(d,["tfdt"]).map(function(p){var _,y;return _=p[0],y=p[4]<<24|p[5]<<16|p[6]<<8|p[7],_===1&&(y*=Math.pow(2,32),y+=p[8]<<24|p[9]<<16|p[10]<<8|p[11]),y})[0],u=u||1/0,u/i})})),h=Math.min.apply(null,c),isFinite(h)?h:0}}]),n}();D.default=m},{33:33}],29:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function n(r,f){for(var x=0;x<f.length;x++){var v=f[x];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(r,v.key,v)}}return function(r,f,x){return f&&n(r.prototype,f),x&&n(r,x),r}}(),F=A(19),k=O(F);function O(n){return n&&n.__esModule?n:{default:n}}function g(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}var m=function(){function n(r,f,x,v){g(this,n),this.decryptdata=x,this.discardEPB=v,this.decrypter=new k.default(r,f)}return I(n,[{key:"decryptBuffer",value:function(f,x){this.decrypter.decrypt(f,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,x)}},{key:"decryptAacSample",value:function(f,x,v,c){var h=f[x].unit,d=h.subarray(16,h.length-h.length%16),t=d.buffer.slice(d.byteOffset,d.byteOffset+d.length),l=this;this.decryptBuffer(t,function(i){i=new Uint8Array(i),h.set(i,16),c||l.decryptAacSamples(f,x+1,v)})}},{key:"decryptAacSamples",value:function(f,x,v){for(;;x++){if(x>=f.length){v();return}if(!(f[x].unit.length<32)){var c=this.decrypter.isSync();if(this.decryptAacSample(f,x,v,c),!c)return}}}},{key:"getAvcEncryptedData",value:function(f){for(var x=Math.floor((f.length-48)/160)*16+16,v=new Int8Array(x),c=0,h=32;h<=f.length-16;h+=160,c+=16)v.set(f.subarray(h,h+16),c);return v}},{key:"getAvcDecryptedUnit",value:function(f,x){x=new Uint8Array(x);for(var v=0,c=32;c<=f.length-16;c+=160,v+=16)f.set(x.subarray(v,v+16),c);return f}},{key:"decryptAvcSample",value:function(f,x,v,c,h,d){var t=this.discardEPB(h.data),l=this.getAvcEncryptedData(t),i=this;this.decryptBuffer(l.buffer,function(u){h.data=i.getAvcDecryptedUnit(t,u),d||i.decryptAvcSamples(f,x,v+1,c)})}},{key:"decryptAvcSamples",value:function(f,x,v,c){for(;;x++,v=0){if(x>=f.length){c();return}for(var h=f[x].units;!(v>=h.length);v++){var d=h[v];if(!(d.length<=48||d.type!==1&&d.type!==5)){var t=this.decrypter.isSync();if(this.decryptAvcSample(f,x,v,c,d,t),!t)return}}}}}]),n}();D.default=m},{19:19}],30:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function t(l,i){for(var u=0;u<i.length;u++){var p=i[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}return function(l,i,u){return i&&t(l.prototype,i),u&&t(l,u),l}}(),F=A(22),k=c(F),O=A(33),g=c(O),m=A(26),n=c(m),r=A(29),f=c(r),x=A(51),v=A(31);function c(t){return t&&t.__esModule?t:{default:t}}function h(t,l){if(!(t instanceof l))throw new TypeError("Cannot call a class as a function")}var d=function(){function t(l,i,u,p){h(this,t),this.observer=l,this.config=u,this.typeSupported=p,this.remuxer=i,this.sampleAes=null}return I(t,[{key:"setDecryptData",value:function(i){i!=null&&i.key!=null&&i.method==="SAMPLE-AES"?this.sampleAes=new f.default(this.observer,this.config,i,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(i,u,p,_){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=u,this.videoCodec=p,this._duration=_}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(i,u,p,_){var y,e=i.length,o,E,S,b,a,s=!1;this.contiguous=p;var T=this.pmtParsed,R=this._avcTrack,w=this._audioTrack,L=this._id3Track,M=R.id,N=w.id,U=L.id,C=this._pmtId,B=R.pesData,G=w.pesData,H=L.pesData,j=this._parsePAT,X=this._parsePMT,K=this._parsePES,W=this._parseAVCPES.bind(this),q=this._parseAACPES.bind(this),V=this._parseMPEGPES.bind(this),z=this._parseID3PES.bind(this);for(e-=e%188,y=0;y<e;y+=188)if(i[y]===71){if(o=!!(i[y+1]&64),E=((i[y+1]&31)<<8)+i[y+2],S=(i[y+3]&48)>>4,S>1){if(b=y+5+i[y+4],b===y+188)continue}else b=y+4;switch(E){case M:o&&(B&&(a=K(B))&&W(a,!1),B={data:[],size:0}),B&&(B.data.push(i.subarray(b,y+188)),B.size+=y+188-b);break;case N:o&&(G&&(a=K(G))&&(w.isAAC?q(a):V(a)),G={data:[],size:0}),G&&(G.data.push(i.subarray(b,y+188)),G.size+=y+188-b);break;case U:o&&(H&&(a=K(H))&&z(a),H={data:[],size:0}),H&&(H.data.push(i.subarray(b,y+188)),H.size+=y+188-b);break;case 0:o&&(b+=i[b]+1),C=this._pmtId=j(i,b);break;case C:o&&(b+=i[b]+1);var Y=X(i,b,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,this.sampleAes!=null);M=Y.avc,M>0&&(R.id=M),N=Y.audio,N>0&&(w.id=N,w.isAAC=Y.isAAC),U=Y.id3,U>0&&(L.id=U),s&&!T&&(x.logger.log("reparse from beginning"),s=!1,y=-188),T=this.pmtParsed=!0;break;case 17:case 8191:break;default:s=!0;break}}else this.observer.trigger(g.default.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});B&&(a=K(B))?(W(a,!0),R.pesData=null):R.pesData=B,G&&(a=K(G))?(w.isAAC?q(a):V(a),w.pesData=null):(G&&G.size&&x.logger.log("last AAC PES packet truncated,might overlap between fragments"),w.pesData=G),H&&(a=K(H))?(z(a),L.pesData=null):L.pesData=H,this.sampleAes==null?this.remuxer.remux(w,R,L,this._txtTrack,u,p,_):this.decryptAndRemux(w,R,L,this._txtTrack,u,p,_)}},{key:"decryptAndRemux",value:function(i,u,p,_,y,e,o){if(i.samples&&i.isAAC){var E=this;this.sampleAes.decryptAacSamples(i.samples,0,function(){E.decryptAndRemuxAvc(i,u,p,_,y,e,o)})}else this.decryptAndRemuxAvc(i,u,p,_,y,e,o)}},{key:"decryptAndRemuxAvc",value:function(i,u,p,_,y,e,o){if(u.samples){var E=this;this.sampleAes.decryptAvcSamples(u.samples,0,0,function(){E.remuxer.remux(i,u,p,_,y,e,o)})}else this.remuxer.remux(i,u,p,_,y,e,o)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(i,u){return(i[u+10]&31)<<8|i[u+11]}},{key:"_parsePMT",value:function(i,u,p,_){var y,e,o,E,S={audio:-1,avc:-1,id3:-1,isAAC:!0};for(y=(i[u+1]&15)<<8|i[u+2],e=u+3+y-4,o=(i[u+10]&15)<<8|i[u+11],u+=12+o;u<e;){switch(E=(i[u+1]&31)<<8|i[u+2],i[u]){case 207:if(!_){x.logger.log("unkown stream type:"+i[u]);break}case 15:S.audio===-1&&(S.audio=E);break;case 21:S.id3===-1&&(S.id3=E);break;case 219:if(!_){x.logger.log("unkown stream type:"+i[u]);break}case 27:S.avc===-1&&(S.avc=E);break;case 3:case 4:p?S.audio===-1&&(S.audio=E,S.isAAC=!1):x.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:x.logger.warn("HEVC stream type found, not supported for now");break;default:x.logger.log("unkown stream type:"+i[u]);break}u+=((i[u+3]&15)<<8|i[u+4])+5}return S}},{key:"_parsePES",value:function(i){var u=0,p,_,y,e,o,E,S,b,a,s=i.data;if(!i||i.size===0)return null;for(;s[0].length<19&&s.length>1;){var T=new Uint8Array(s[0].length+s[1].length);T.set(s[0]),T.set(s[1],s[0].length),s[0]=T,s.splice(1,1)}if(p=s[0],y=(p[0]<<16)+(p[1]<<8)+p[2],y===1){if(e=(p[4]<<8)+p[5],e&&e>i.size-6)return null;_=p[7],_&192&&(S=(p[9]&14)*536870912+(p[10]&255)*4194304+(p[11]&254)*16384+(p[12]&255)*128+(p[13]&254)/2,S>4294967295&&(S-=8589934592),_&64?(b=(p[14]&14)*536870912+(p[15]&255)*4194304+(p[16]&254)*16384+(p[17]&255)*128+(p[18]&254)/2,b>4294967295&&(b-=8589934592),S-b>60*9e4&&(x.logger.warn(Math.round((S-b)/9e4)+"s delta between PTS and DTS, align them"),S=b)):b=S),o=p[8],a=o+9,i.size-=a,E=new Uint8Array(i.size);for(var R=0,w=s.length;R<w;R++){p=s[R];var L=p.byteLength;if(a)if(a>L){a-=L;continue}else p=p.subarray(a),L-=a,a=0;E.set(p,u),u+=L}return e&&(e-=o+3),{data:E,pts:S,dts:b,len:e}}else return null}},{key:"pushAccesUnit",value:function(i,u){if(i.units.length&&i.frame){var p=u.samples,_=p.length;!this.config.forceKeyFrameOnDiscontinuity||i.key===!0||u.sps&&(_||this.contiguous)?(i.id=_,p.push(i)):u.dropped++}i.debug.length&&x.logger.log(i.pts+"/"+i.dts+":"+i.debug)}},{key:"_parseAVCPES",value:function(i,u){var p=this,_=this._avcTrack,y=this._parseAVCNALu(i.data),e,o=this.avcSample,E,S;i.data=null,y.forEach(function(b){switch(b.type){case 1:E=!0,o.frame=!0;var a=b.data;if(a.length>4){var s=new n.default(a).readSliceType();(s===2||s===4||s===7||s===9)&&(o.key=!0)}break;case 5:E=!0,o||(o=p.avcSample=p._createAVCSample(!0,i.pts,i.dts,"")),o.key=!0,o.frame=!0;break;case 6:E=!0,e=new n.default(p.discardEPB(b.data)),e.readUByte();for(var T=0,R=0,w=!1,L=0;!w&&e.bytesAvailable>1;){T=0;do L=e.readUByte(),T+=L;while(L===255);R=0;do L=e.readUByte(),R+=L;while(L===255);if(T===4&&e.bytesAvailable!==0){w=!0;var M=e.readUByte();if(M===181){var N=e.readUShort();if(N===49){var U=e.readUInt();if(U===1195456820){var C=e.readUByte();if(C===3){var B=e.readUByte(),G=e.readUByte(),H=31&B,j=[B,G];for(S=0;S<H;S++)j.push(e.readUByte()),j.push(e.readUByte()),j.push(e.readUByte());p._insertSampleInOrder(p._txtTrack.samples,{type:3,pts:i.pts,bytes:j})}}}}}else if(R<e.bytesAvailable)for(S=0;S<R;S++)e.readUByte()}break;case 7:if(E=!0,!_.sps){e=new n.default(b.data);var X=e.readSPS();_.width=X.width,_.height=X.height,_.pixelRatio=X.pixelRatio,_.sps=[b.data],_.duration=p._duration;var K=b.data.subarray(1,4),W="avc1.";for(S=0;S<3;S++){var q=K[S].toString(16);q.length<2&&(q="0"+q),W+=q}_.codec=W}break;case 8:E=!0,_.pps||(_.pps=[b.data]);break;case 9:E=!1,o&&p.pushAccesUnit(o,_),o=p.avcSample=p._createAVCSample(!1,i.pts,i.dts,"");break;case 12:E=!1;break;default:E=!1,o&&(o.debug+="unknown NAL "+b.type+" ");break}if(o&&E){var V=o.units;V.push(b)}}),u&&o&&(this.pushAccesUnit(o,_),this.avcSample=null)}},{key:"_createAVCSample",value:function(i,u,p,_){return{key:i,pts:u,dts:p,units:[],debug:_}}},{key:"_insertSampleInOrder",value:function(i,u){var p=i.length;if(p>0){if(u.pts>=i[p-1].pts)i.push(u);else for(var _=p-1;_>=0;_--)if(u.pts<i[_].pts){i.splice(_,0,u);break}}else i.push(u)}},{key:"_getLastNalUnit",value:function(){var i=this.avcSample,u=void 0;if(!i||i.units.length===0){var p=this._avcTrack,_=p.samples;i=_[_.length-1]}if(i){var y=i.units;u=y[y.length-1]}return u}},{key:"_parseAVCNALu",value:function(i){var u=0,p=i.byteLength,_,y,e=this._avcTrack,o=e.naluState||0,E=o,S=[],b,a,s=-1,T;for(o===-1&&(s=0,T=i[0]&31,o=0,u=1);u<p;){if(_=i[u++],!o){o=_?0:1;continue}if(o===1){o=_?0:2;continue}if(!_)o=3;else if(_===1){if(s>=0)b={data:i.subarray(s,u-o-1),type:T},S.push(b);else{var R=this._getLastNalUnit();if(R&&(E&&u<=4-E&&R.state&&(R.data=R.data.subarray(0,R.data.byteLength-E)),y=u-o-1,y>0)){var w=new Uint8Array(R.data.byteLength+y);w.set(R.data,0),w.set(i.subarray(0,y),R.data.byteLength),R.data=w}}u<p?(a=i[u]&31,s=u,T=a,o=0):o=-1}else o=0}if(s>=0&&o>=0&&(b={data:i.subarray(s,p),type:T,state:o},S.push(b)),S.length===0){var L=this._getLastNalUnit();if(L){var M=new Uint8Array(L.data.byteLength+i.byteLength);M.set(L.data,0),M.set(i,L.data.byteLength),L.data=M}}return e.naluState=o,S}},{key:"discardEPB",value:function(i){for(var u=i.byteLength,p=[],_=1,y,e;_<u-2;)i[_]===0&&i[_+1]===0&&i[_+2]===3?(p.push(_+2),_+=2):_++;if(p.length===0)return i;y=u-p.length,e=new Uint8Array(y);var o=0;for(_=0;_<y;o++,_++)o===p[0]&&(o++,p.shift()),e[_]=i[o];return e}},{key:"_parseAACPES",value:function(i){var u=this._audioTrack,p=i.data,_=i.pts,y=0,e=this.aacOverFlow,o=this.aacLastPTS,E,S,b,a,s,T,R,w,L;if(e){var M=new Uint8Array(e.byteLength+p.byteLength);M.set(e,0),M.set(p,e.byteLength),p=M}for(s=y,w=p.length;s<w-1&&!(p[s]===255&&(p[s+1]&240)===240);s++);if(s){var N,U;if(s<w-1?(N="AAC PES did not start with ADTS header,offset:"+s,U=!1):(N="no ADTS header found in AAC PES",U=!0),x.logger.warn("parsing error:"+N),this.observer.trigger(g.default.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.FRAG_PARSING_ERROR,fatal:U,reason:N}),U)return}if(!u.samplerate){var C=this.audioCodec;E=k.default.getAudioConfig(this.observer,p,s,C),u.config=E.config,u.samplerate=E.samplerate,u.channelCount=E.channelCount,u.codec=E.codec,u.manifestCodec=E.manifestCodec,u.duration=this._duration,x.logger.log("parsed codec:"+u.codec+",rate:"+E.samplerate+",nb channel:"+E.channelCount)}if(a=0,b=1024*9e4/u.samplerate,e&&o){var B=o+b;Math.abs(B-_)>1&&(x.logger.log("AAC: align PTS for overlapping frames by "+Math.round((B-_)/90)),_=B)}for(;s+5<w&&(T=p[s+1]&1?7:9,S=(p[s+3]&3)<<11|p[s+4]<<3|(p[s+5]&224)>>>5,S-=T,S>0&&s+T+S<=w);)for(R=_+a*b,L={unit:p.subarray(s+T,s+T+S),pts:R,dts:R},u.samples.push(L),u.len+=S,s+=S+T,a++;s<w-1&&!(p[s]===255&&(p[s+1]&240)===240);s++);s<w?e=p.subarray(s,w):e=null,this.aacOverFlow=e,this.aacLastPTS=R}},{key:"_parseMPEGPES",value:function(i){for(var u=i.data,p=i.pts,_=u.length,y=0,e=0,o;e<_&&(o=this._parseMpeg(u,e,_,y++,p))>0;)e+=o}},{key:"_onMpegFrame",value:function(i,u,p,_,y,e){var o=1152/p*1e3,E=e+y*o,S=this._audioTrack;S.config=[],S.channelCount=_,S.samplerate=p,S.duration=this._duration,S.samples.push({unit:i,pts:E,dts:E}),S.len+=i.length}},{key:"_onMpegNoise",value:function(i){x.logger.warn("mpeg audio has noise: "+i.length+" bytes")}},{key:"_parseMpeg",value:function(i,u,p,_,y){var e=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(u+2>p)return-1;if(i[u]===255||(i[u+1]&224)===224){if(u+24>p)return-1;var E=i[u+1]>>3&3,S=i[u+1]>>1&3,b=i[u+2]>>4&15,a=i[u+2]>>2&3,s=!!(i[u+2]&2);if(E!==1&&b!==0&&b!==15&&a!==3){var T=E===3?3-S:S===3?3:4,R=e[T*14+b-1]*1e3,w=E===3?0:E===2?1:2,L=o[w*3+a],M=s?1:0,N=i[u+3]>>6===3?1:2,U=S===3?(E===3?12:6)*R/L+M<<2:(E===3?144:72)*R/L+M|0;return u+U>p?-1:(this._onMpegFrame&&this._onMpegFrame(i.subarray(u,u+U),R,L,N,_,y),U)}}for(var C=u+2;C<p;){if(i[C-1]===255&&(i[C]&224)===224)return this._onMpegNoise&&this._onMpegNoise(i.subarray(u,C-1)),C-u-1;C++}return-1}},{key:"_parseID3PES",value:function(i){this._id3Track.samples.push(i)}}],[{key:"probe",value:function(i){return i.length>=3*188&&i[0]===71&&i[188]===71&&i[2*188]===71}}]),t}();D.default=d},{22:22,26:26,29:29,31:31,33:33,51:51}],31:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0}),D.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},D.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],32:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},F=function(){function x(v,c){for(var h=0;h<c.length;h++){var d=c[h];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(v,d.key,d)}}return function(v,c,h){return c&&x(v.prototype,c),h&&x(v,h),v}}(),k=A(51),O=A(31),g=A(33),m=n(g);function n(x){return x&&x.__esModule?x:{default:x}}function r(x,v){if(!(x instanceof v))throw new TypeError("Cannot call a class as a function")}var f=function(){function x(v){r(this,x),this.hls=v,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,h=Array(c>1?c-1:0),d=1;d<c;d++)h[d-1]=arguments[d];this.handledEvents=h,this.useGenericHandler=!0,this.registerListeners()}return F(x,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return I(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent=="function"}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach((function(c){if(c==="hlsEventGeneric")throw new Error("Forbidden event name: "+c);this.hls.on(c,this.onEvent)}).bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach((function(c){this.hls.off(c,this.onEvent)}).bind(this))}},{key:"onEvent",value:function(c,h){this.onEventGeneric(c,h)}},{key:"onEventGeneric",value:function(c,h){var d=function(l,i){var u="on"+l.replace("hls","");if(typeof this[u]!="function")throw new Error("Event "+l+" has no generic handler in this "+this.constructor.name+" class (tried "+u+")");return this[u].bind(this,i)};try{d.call(this,c,h).call()}catch(t){k.logger.error("internal error happened while processing "+c+":"+t.message),this.hls.trigger(m.default.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:c,err:t})}}}]),x}();D.default=f},{31:31,33:33,51:51}],33:[function(A,P,D){P.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],34:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function O(g,m){for(var n=0;n<m.length;n++){var r=m[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(g,r.key,r)}}return function(g,m,n){return m&&O(g.prototype,m),n&&O(g,n),g}}();function F(O,g){if(!(O instanceof g))throw new TypeError("Cannot call a class as a function")}var k=function(){function O(){F(this,O)}return I(O,null,[{key:"getSilentFrame",value:function(m,n){switch(m){case"mp4a.40.2":if(n===1)return new Uint8Array([0,200,0,128,35,128]);if(n===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(n===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(n===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(n===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(n===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(n===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}return null}}]),O}();D.default=k},{}],35:[function(A,P,D){var I={isBuffered:function(k,O){if(k){for(var g=k.buffered,m=0;m<g.length;m++)if(O>=g.start(m)&&O<=g.end(m))return!0}return!1},bufferInfo:function(k,O,g){if(k){var m=k.buffered,n=[],r;for(r=0;r<m.length;r++)n.push({start:m.start(r),end:m.end(r)});return this.bufferedInfo(n,O,g)}else return{len:0,start:O,end:O,nextStart:void 0}},bufferedInfo:function(k,O,g){var m=[],n,r,f,x,v;for(k.sort(function(l,i){var u=l.start-i.start;return u||i.end-l.end}),v=0;v<k.length;v++){var c=m.length;if(c){var h=m[c-1].end;k[v].start-h<g?k[v].end>h&&(m[c-1].end=k[v].end):m.push(k[v])}else m.push(k[v])}for(v=0,n=0,r=f=O;v<m.length;v++){var d=m[v].start,t=m[v].end;if(O+g>=d&&O<t)r=d,f=t,n=f-O;else if(O+g<d){x=d;break}}return{len:n,start:r,end:f,nextStart:x}}};P.exports=I},{}],36:[function(A,P,D){var I=A(51),F={mergeDetails:function(O,g){var m=Math.max(O.startSN,g.startSN)-g.startSN,n=Math.min(O.endSN,g.endSN)-g.startSN,r=g.startSN-O.startSN,f=O.fragments,x=g.fragments,v=0,c;if(n<m){g.PTSKnown=!1;return}for(var h=m;h<=n;h++){var d=f[r+h],t=x[h];t&&d&&(v=d.cc-t.cc,isNaN(d.startPTS)||(t.start=t.startPTS=d.startPTS,t.endPTS=d.endPTS,t.duration=d.duration,c=t))}if(v)for(I.logger.log("discontinuity sliding from playlist, take drift into account"),h=0;h<x.length;h++)x[h].cc+=v;if(c)F.updateFragPTSDTS(g,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS);else if(r>=0&&r<f.length){var l=f[r].start;for(h=0;h<x.length;h++)x[h].start+=l}g.PTSKnown=O.PTSKnown},updateFragPTSDTS:function(O,g,m,n,r,f){if(!isNaN(g.startPTS)){var x=Math.abs(g.startPTS-m);isNaN(g.deltaPTS)?g.deltaPTS=x:g.deltaPTS=Math.max(x,g.deltaPTS),m=Math.min(m,g.startPTS),n=Math.max(n,g.endPTS),r=Math.min(r,g.startDTS),f=Math.max(f,g.endDTS)}var v=m-g.start;g.start=g.startPTS=m,g.endPTS=n,g.startDTS=r,g.endDTS=f,g.duration=n-m;var c=g.sn;if(!O||c<O.startSN||c>O.endSN)return 0;var h,d,t;for(h=c-O.startSN,d=O.fragments,g=d[h],t=h;t>0;t--)F.updatePTS(d,t,t-1);for(t=h;t<d.length-1;t++)F.updatePTS(d,t,t+1);return O.PTSKnown=!0,v},updatePTS:function(O,g,m){var n=O[g],r=O[m],f=r.startPTS;isNaN(f)?m>g?r.start=n.start+n.duration:r.start=Math.max(n.start-r.duration,0):m>g?(n.duration=f-n.start,n.duration<0&&I.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(r.duration=n.start-f,r.duration<0&&I.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!"))}};P.exports=F},{51:51}],37:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function b(a,s){for(var T=0;T<s.length;T++){var R=s[T];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(a,R.key,R)}}return function(a,s,T){return s&&b(a.prototype,s),T&&b(a,T),a}}(),F=A(2),k=o(F),O=A(33),g=o(O),m=A(31),n=A(41),r=o(n),f=A(39),x=o(f),v=A(40),c=o(v),h=A(13),d=o(h),t=A(12),l=o(t),i=A(11),u=o(i),p=A(51),_=A(1),y=o(_),e=A(4);function o(b){return b&&b.__esModule?b:{default:b}}function E(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function")}var S=function(){I(b,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&typeof window.MediaSource.isTypeSupported=="function"&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.7.6"}},{key:"Events",get:function(){return g.default}},{key:"ErrorTypes",get:function(){return m.ErrorTypes}},{key:"ErrorDetails",get:function(){return m.ErrorDetails}},{key:"DefaultConfig",get:function(){return b.defaultConfig?b.defaultConfig:e.hlsDefaultConfig},set:function(s){b.defaultConfig=s}}]);function b(){var a=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};E(this,b);var T=b.DefaultConfig;if((s.liveSyncDurationCount||s.liveMaxLatencyDurationCount)&&(s.liveSyncDuration||s.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var R in T)R in s||(s[R]=T[R]);if(s.liveMaxLatencyDurationCount!==void 0&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(s.liveMaxLatencyDuration!==void 0&&(s.liveMaxLatencyDuration<=s.liveSyncDuration||s.liveSyncDuration===void 0))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,p.enableLogs)(s.debug),this.config=s,this._autoLevelCapping=-1;var w=this.observer=new y.default;w.trigger=function(Q){for(var J=arguments.length,$=Array(J>1?J-1:0),Z=1;Z<J;Z++)$[Z-1]=arguments[Z];w.emit.apply(w,[Q,Q].concat($))},w.off=function(Q){for(var J=arguments.length,$=Array(J>1?J-1:0),Z=1;Z<J;Z++)$[Z-1]=arguments[Z];w.removeListener.apply(w,[Q].concat($))},this.on=w.on.bind(w),this.off=w.off.bind(w),this.trigger=w.trigger.bind(w);var L=this.abrController=new s.abrController(this),M=new s.bufferController(this),N=new s.capLevelController(this),U=new s.fpsController(this),C=new r.default(this),B=new x.default(this),G=new c.default(this),H=new u.default(this),j=this.levelController=new l.default(this),X=this.streamController=new d.default(this),K=[j,X],W=s.audioStreamController;W&&K.push(new W(this)),this.networkControllers=K;var q=[C,B,G,L,M,N,U,H];if(W=s.audioTrackController,W){var V=new W(this);this.audioTrackController=V,q.push(V)}if(W=s.subtitleTrackController,W){var z=new W(this);this.subtitleTrackController=z,q.push(z)}[s.subtitleStreamController,s.timelineController].forEach(function(Y){Y&&q.push(new Y(a))}),this.coreComponents=q}return I(b,[{key:"destroy",value:function(){p.logger.log("destroy"),this.trigger(g.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(s){s.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(s){p.logger.log("attachMedia"),this.media=s,this.trigger(g.default.MEDIA_ATTACHING,{media:s})}},{key:"detachMedia",value:function(){p.logger.log("detachMedia"),this.trigger(g.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(s){s=k.default.buildAbsoluteURL(window.location.href,s,{alwaysNormalize:!0}),p.logger.log("loadSource:"+s),this.url=s,this.trigger(g.default.MANIFEST_LOADING,{url:s})}},{key:"startLoad",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1;p.logger.log("startLoad("+s+")"),this.networkControllers.forEach(function(T){T.startLoad(s)})}},{key:"stopLoad",value:function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(s){s.stopLoad()})}},{key:"swapAudioCodec",value:function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){p.logger.log("recoverMediaError");var s=this.media;this.detachMedia(),this.attachMedia(s)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(s){p.logger.log("set currentLevel:"+s),this.loadLevel=s,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(s){p.logger.log("set nextLevel:"+s),this.levelController.manualLevel=s,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(s){p.logger.log("set loadLevel:"+s),this.levelController.manualLevel=s}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(s){this.levelController.nextLoadLevel=s}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(s){p.logger.log("set firstLevel:"+s),this.levelController.firstLevel=s}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(s){p.logger.log("set startLevel:"+s);var T=this;s!==-1&&(s=Math.max(s,T.minAutoLevel)),T.levelController.startLevel=s}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(s){p.logger.log("set autoLevelCapping:"+s),this._autoLevelCapping=s}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var s=this,T=s.levels,R=s.config.minAutoBitrate,w=T?T.length:0,L=0;L<w;L++){var M=T[L].realBitrate?Math.max(T[L].realBitrate,T[L].bitrate):T[L].bitrate;if(M>R)return L}return 0}},{key:"maxAutoLevel",get:function(){var s=this,T=s.levels,R=s.autoLevelCapping,w=void 0;return R===-1&&T&&T.length?w=T.length-1:w=R,w}},{key:"nextAutoLevel",get:function(){var s=this;return Math.min(Math.max(s.abrController.nextAutoLevel,s.minAutoLevel),s.maxAutoLevel)},set:function(s){var T=this;T.abrController.nextAutoLevel=Math.max(T.minAutoLevel,s)}},{key:"audioTracks",get:function(){var s=this.audioTrackController;return s?s.audioTracks:[]}},{key:"audioTrack",get:function(){var s=this.audioTrackController;return s?s.audioTrack:-1},set:function(s){var T=this.audioTrackController;T&&(T.audioTrack=s)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var s=this.subtitleTrackController;return s?s.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var s=this.subtitleTrackController;return s?s.subtitleTrack:-1},set:function(s){var T=this.subtitleTrackController;T&&(T.subtitleTrack=s)}}]),b}();D.default=S},{1:1,11:11,12:12,13:13,2:2,31:31,33:33,39:39,4:4,40:40,41:41,51:51}],38:[function(A,P,D){P.exports=A(37).default},{37:37}],39:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function h(d,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(d,i.key,i)}}return function(d,t,l){return t&&h(d.prototype,t),l&&h(d,l),d}}(),F=A(33),k=r(F),O=A(32),g=r(O),m=A(31),n=A(51);function r(h){return h&&h.__esModule?h:{default:h}}function f(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}function x(h,d){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&(typeof d=="object"||typeof d=="function")?d:h}function v(h,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);h.prototype=Object.create(d&&d.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(h,d):h.__proto__=d)}var c=function(h){v(d,h);function d(t){f(this,d);var l=x(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,t,k.default.FRAG_LOADING));return l.loaders={},l}return I(d,[{key:"destroy",value:function(){var l=this.loaders;for(var i in l){var u=l[i];u&&u.destroy()}this.loaders={},g.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(l){var i=l.frag,u=i.type,p=this.loaders[u],_=this.hls.config;i.loaded=0,p&&(n.logger.warn("abort previous fragment loader for type:"+u),p.abort()),p=this.loaders[u]=i.loader=typeof _.fLoader<"u"?new _.fLoader(_):new _.loader(_);var y=void 0,e=void 0,o=void 0;y={url:i.url,frag:i,responseType:"arraybuffer",progressData:!1};var E=i.byteRangeStartOffset,S=i.byteRangeEndOffset;!isNaN(E)&&!isNaN(S)&&(y.rangeStart=E,y.rangeEnd=S),e={timeout:_.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:_.fragLoadingMaxRetryTimeout},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},p.load(y,e,o)}},{key:"loadsuccess",value:function(l,i,u){var p=l.data,_=u.frag;_.loader=void 0,this.loaders[_.type]=void 0,this.hls.trigger(k.default.FRAG_LOADED,{payload:p,frag:_,stats:i})}},{key:"loaderror",value:function(l,i){var u=i.loader;u&&u.abort(),this.loaders[i.type]=void 0,this.hls.trigger(k.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i.frag,response:l})}},{key:"loadtimeout",value:function(l,i){var u=i.loader;u&&u.abort(),this.loaders[i.type]=void 0,this.hls.trigger(k.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i.frag})}},{key:"loadprogress",value:function(l,i,u){var p=i.frag;p.loaded=l.loaded,this.hls.trigger(k.default.FRAG_LOAD_PROGRESS,{frag:p,stats:l})}}]),d}(g.default);D.default=c},{31:31,32:32,33:33,51:51}],40:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function h(d,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(d,i.key,i)}}return function(d,t,l){return t&&h(d.prototype,t),l&&h(d,l),d}}(),F=A(33),k=r(F),O=A(32),g=r(O),m=A(31),n=A(51);function r(h){return h&&h.__esModule?h:{default:h}}function f(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}function x(h,d){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&(typeof d=="object"||typeof d=="function")?d:h}function v(h,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);h.prototype=Object.create(d&&d.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(h,d):h.__proto__=d)}var c=function(h){v(d,h);function d(t){f(this,d);var l=x(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,t,k.default.KEY_LOADING));return l.loaders={},l.decryptkey=null,l.decrypturl=null,l}return I(d,[{key:"destroy",value:function(){for(var l in this.loaders){var i=this.loaders[l];i&&i.destroy()}this.loaders={},g.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(l){var i=l.frag,u=i.type,p=this.loaders[u],_=i.decryptdata,y=_.uri;if(y!==this.decrypturl||this.decryptkey===null){var e=this.hls.config;p&&(n.logger.warn("abort previous key loader for type:"+u),p.abort()),i.loader=this.loaders[u]=new e.loader(e),this.decrypturl=y,this.decryptkey=null;var o=void 0,E=void 0,S=void 0;o={url:y,frag:i,responseType:"arraybuffer"},E={timeout:e.fragLoadingTimeOut,maxRetry:e.fragLoadingMaxRetry,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout},S={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},i.loader.load(o,E,S)}else this.decryptkey&&(_.key=this.decryptkey,this.hls.trigger(k.default.KEY_LOADED,{frag:i}))}},{key:"loadsuccess",value:function(l,i,u){var p=u.frag;this.decryptkey=p.decryptdata.key=new Uint8Array(l.data),p.loader=void 0,this.loaders[p.type]=void 0,this.hls.trigger(k.default.KEY_LOADED,{frag:p})}},{key:"loaderror",value:function(l,i){var u=i.frag,p=u.loader;p&&p.abort(),this.loaders[i.type]=void 0,this.hls.trigger(k.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:u,response:l})}},{key:"loadtimeout",value:function(l,i){var u=i.frag,p=u.loader;p&&p.abort(),this.loaders[i.type]=void 0,this.hls.trigger(k.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:u})}}]),d}(g.default);D.default=c},{31:31,32:32,33:33,51:51}],41:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function o(E,S){for(var b=0;b<S.length;b++){var a=S[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(E,a.key,a)}}return function(E,S,b){return S&&o(E.prototype,S),b&&o(E,b),E}}(),F=A(2),k=c(F),O=A(33),g=c(O),m=A(32),n=c(m),r=A(31),f=A(45),x=c(f),v=A(51);function c(o){return o&&o.__esModule?o:{default:o}}function h(o,E){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return E&&(typeof E=="object"||typeof E=="function")?E:o}function d(o,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);o.prototype=Object.create(E&&E.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(o,E):o.__proto__=E)}function t(o,E){if(!(o instanceof E))throw new TypeError("Cannot call a class as a function")}var l=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,i=/#EXT-X-MEDIA:(.*)/g,u=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,p=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,_=function(){function o(){t(this,o),this.method=null,this.key=null,this.iv=null,this._uri=null}return I(o,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=k.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),o}(),y=function(){function o(){t(this,o),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return I(o,[{key:"createInitializationVector",value:function(S){for(var b=new Uint8Array(16),a=12;a<16;a++)b[a]=S>>8*(15-a)&255;return b}},{key:"fragmentDecryptdataFromLevelkey",value:function(S,b){var a=S;return S&&S.method&&S.uri&&!S.iv&&(a=new _,a.method=S.method,a.baseuri=S.baseuri,a.reluri=S.reluri,a.iv=this.createInitializationVector(b)),a}},{key:"cloneObj",value:function(S){return JSON.parse(JSON.stringify(S))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=k.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(S){this._url=S}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var S=this._byteRange=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(b.length===1){var a=this.lastByteRangeEndOffset;S[0]=a||0}else S[0]=parseInt(b[1]);S[1]=parseInt(b[0])+S[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),o}(),e=function(o){d(E,o);function E(S){t(this,E);var b=h(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,S,g.default.MANIFEST_LOADING,g.default.LEVEL_LOADING,g.default.AUDIO_TRACK_LOADING,g.default.SUBTITLE_TRACK_LOADING));return b.loaders={},b}return I(E,[{key:"destroy",value:function(){for(var b in this.loaders){var a=this.loaders[b];a&&a.destroy()}this.loaders={},n.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(b){this.load(b.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(b){this.load(b.url,{type:"level",level:b.level,id:b.id})}},{key:"onAudioTrackLoading",value:function(b){this.load(b.url,{type:"audioTrack",id:b.id})}},{key:"onSubtitleTrackLoading",value:function(b){this.load(b.url,{type:"subtitleTrack",id:b.id})}},{key:"load",value:function(b,a){var s=this.loaders[a.type];if(s){var T=s.context;if(T&&T.url===b){v.logger.trace("playlist request ongoing");return}else v.logger.warn("abort previous loader for type:"+a.type),s.abort()}var R=this.hls.config,w=void 0,L=void 0,M=void 0,N=void 0;a.type==="manifest"?(w=R.manifestLoadingMaxRetry,L=R.manifestLoadingTimeOut,M=R.manifestLoadingRetryDelay,N=R.manifestLoadingMaxRetryTimeout):(w=R.levelLoadingMaxRetry,L=R.levelLoadingTimeOut,M=R.levelLoadingRetryDelay,N=R.levelLoadingMaxRetryTimeout,v.logger.log("loading playlist for "+a.type+" "+(a.level||a.id))),s=this.loaders[a.type]=a.loader=typeof R.pLoader<"u"?new R.pLoader(R):new R.loader(R),a.url=b,a.responseType="";var U=void 0,C=void 0;U={timeout:L,maxRetry:w,retryDelay:M,maxRetryDelay:N},C={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},s.load(a,U,C)}},{key:"resolve",value:function(b,a){return k.default.buildAbsoluteURL(a,b,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(b,a){var s=[],T=void 0;for(l.lastIndex=0;(T=l.exec(b))!=null;){var R={},w=R.attrs=new x.default(T[1]);R.url=this.resolve(T[2],a);var L=w.decimalResolution("RESOLUTION");L&&(R.width=L.width,R.height=L.height),R.bitrate=w.decimalInteger("AVERAGE-BANDWIDTH")||w.decimalInteger("BANDWIDTH"),R.name=w.NAME;var M=w.CODECS;if(M){M=M.split(/[ ,]+/);for(var N=0;N<M.length;N++){var U=M[N];U.indexOf("avc1")!==-1?R.videoCodec=this.avc1toavcoti(U):R.audioCodec=U}}s.push(R)}return s}},{key:"parseMasterPlaylistMedia",value:function(b,a,s){var T=void 0,R=[],w=0;for(i.lastIndex=0;(T=i.exec(b))!=null;){var L={},M=new x.default(T[1]);M.TYPE===s&&(L.groupId=M["GROUP-ID"],L.name=M.NAME,L.type=s,L.default=M.DEFAULT==="YES",L.autoselect=M.AUTOSELECT==="YES",L.forced=M.FORCED==="YES",M.URI&&(L.url=this.resolve(M.URI,a)),L.lang=M.LANGUAGE,L.name||(L.name=L.lang),L.id=w++,R.push(L))}return R}},{key:"avc1toavcoti",value:function(b){var a,s=b.split(".");return s.length>2?(a=s.shift()+".",a+=parseInt(s.shift()).toString(16),a+=("000"+parseInt(s.shift()).toString(16)).substr(-4)):a=b,a}},{key:"parseLevelPlaylist",value:function(b,a,s,T){var R=0,w=0,L={type:null,version:null,url:a,fragments:[],live:!0,startSN:0},M=new _,N=0,U=null,C=new y,B,G;for(u.lastIndex=0;(B=u.exec(b))!==null;){var H=B[1];if(H){C.duration=parseFloat(H);var j=(" "+B[2]).slice(1);C.title=j||null,C.tagList.push(j?["INF",H,j]:["INF",H])}else if(B[3]){if(!isNaN(C.duration)){var X=R++;C.type=T,C.start=w,C.levelkey=M,C.sn=X,C.level=s,C.cc=N,C.baseurl=a,C.relurl=(" "+B[3]).slice(1),L.fragments.push(C),U=C,w+=C.duration,C=new y}}else if(B[4]){if(C.rawByteRange=(" "+B[4]).slice(1),U){var K=U.byteRangeEndOffset;K&&(C.lastByteRangeEndOffset=K)}}else if(B[5])C.rawProgramDateTime=(" "+B[5]).slice(1),C.tagList.push(["PROGRAM-DATE-TIME",C.rawProgramDateTime]);else{for(B=B[0].match(p),G=1;G<B.length&&B[G]===void 0;G++);var W=(" "+B[G+1]).slice(1),q=(" "+B[G+2]).slice(1);switch(B[G]){case"#":C.tagList.push(q?[W,q]:[W]);break;case"PLAYLIST-TYPE":L.type=W.toUpperCase();break;case"MEDIA-SEQUENCE":R=L.startSN=parseInt(W);break;case"TARGETDURATION":L.targetduration=parseFloat(W);break;case"VERSION":L.version=parseInt(W);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"DIS":N++,C.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":N=parseInt(W);break;case"KEY":var V=W,z=new x.default(V),Y=z.enumeratedString("METHOD"),Q=z.URI,J=z.hexadecimalInteger("IV");Y&&(M=new _,Q&&["AES-128","SAMPLE-AES"].indexOf(Y)>=0&&(M.method=Y,M.baseuri=a,M.reluri=Q,M.key=null,M.iv=J));break;case"START":var $=W,Z=new x.default($),ie=Z.decimalFloatingPoint("TIME-OFFSET");isNaN(ie)||(L.startTimeOffset=ie);break;case"MAP":var te=new x.default(W);C.relurl=te.URI,C.rawByteRange=te.BYTERANGE,C.baseurl=a,C.level=s,C.type=T,C.sn="initSegment",L.initSegment=C,C=new y;break;default:v.logger.warn("line parsed but not handled: "+B);break}}}return C=U,C&&!C.relurl&&(L.fragments.pop(),w-=C.duration),L.totalduration=w,L.averagetargetduration=w/L.fragments.length,L.endSN=R-1,L}},{key:"loadsuccess",value:function(b,a,s){var T=b.data,R=b.url,w=s.type,L=s.id,M=s.level,N=this.hls;if(this.loaders[w]=void 0,(R===void 0||R.indexOf("data:")===0)&&(R=s.url),a.tload=performance.now(),T.indexOf("#EXTM3U")===0)if(T.indexOf("#EXTINF:")>0){var U=w!=="audioTrack"&&w!=="subtitleTrack",C=isNaN(M)?isNaN(L)?0:L:M,B=this.parseLevelPlaylist(T,R,C,w==="audioTrack"?"audio":w==="subtitleTrack"?"subtitle":"main");B.tload=a.tload,w==="manifest"&&N.trigger(g.default.MANIFEST_LOADED,{levels:[{url:R,details:B}],audioTracks:[],url:R,stats:a}),a.tparsed=performance.now(),B.targetduration?U?N.trigger(g.default.LEVEL_LOADED,{details:B,level:M||0,id:L||0,stats:a}):w==="audioTrack"?N.trigger(g.default.AUDIO_TRACK_LOADED,{details:B,id:L,stats:a}):w==="subtitleTrack"&&N.trigger(g.default.SUBTITLE_TRACK_LOADED,{details:B,id:L,stats:a}):N.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:R,reason:"invalid targetduration"})}else{var G=this.parseMasterPlaylist(T,R);if(G.length){var H=this.parseMasterPlaylistMedia(T,R,"AUDIO"),j=this.parseMasterPlaylistMedia(T,R,"SUBTITLES");if(H.length){var X=!1;H.forEach(function(K){K.url||(X=!0)}),X===!1&&G[0].audioCodec&&!G[0].attrs.AUDIO&&(v.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),H.unshift({type:"main",name:"main"}))}N.trigger(g.default.MANIFEST_LOADED,{levels:G,audioTracks:H,subtitles:j,url:R,stats:a})}else N.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:R,reason:"no level found in manifest"})}else N.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:R,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(b,a){var s,T,R=a.loader;switch(a.type){case"manifest":s=r.ErrorDetails.MANIFEST_LOAD_ERROR,T=!0;break;case"level":s=r.ErrorDetails.LEVEL_LOAD_ERROR,T=!1;break;case"audioTrack":s=r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,T=!1;break}R&&(R.abort(),this.loaders[a.type]=void 0),this.hls.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:s,fatal:T,url:R.url,loader:R,response:b,context:a})}},{key:"loadtimeout",value:function(b,a){var s,T,R=a.loader;switch(a.type){case"manifest":s=r.ErrorDetails.MANIFEST_LOAD_TIMEOUT,T=!0;break;case"level":s=r.ErrorDetails.LEVEL_LOAD_TIMEOUT,T=!1;break;case"audioTrack":s=r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,T=!1;break}R&&(R.abort(),this.loaders[a.type]=void 0),this.hls.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:s,fatal:T,url:R.url,loader:R,context:a})}}]),E}(n.default);D.default=e},{2:2,31:31,32:32,33:33,45:45,51:51}],42:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function g(m,n){for(var r=0;r<n.length;r++){var f=n[r];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(m,f.key,f)}}return function(m,n,r){return n&&g(m.prototype,n),r&&g(m,r),m}}();function F(g,m){if(!(g instanceof m))throw new TypeError("Cannot call a class as a function")}var k=Math.pow(2,32)-1,O=function(){function g(){F(this,g)}return I(g,null,[{key:"init",value:function(){g.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var n;for(n in g.types)g.types.hasOwnProperty(n)&&(g.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),f=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);g.HDLR_TYPES={video:r,audio:f};var x=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),v=new Uint8Array([0,0,0,0,0,0,0,0]);g.STTS=g.STSC=g.STCO=v,g.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),g.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),g.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),g.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var c=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);g.FTYP=g.box(g.types.ftyp,c,d,c,h),g.DINF=g.box(g.types.dinf,g.box(g.types.dref,x))}},{key:"box",value:function(n){for(var r=Array.prototype.slice.call(arguments,1),f=8,x=r.length,v=x,c;x--;)f+=r[x].byteLength;for(c=new Uint8Array(f),c[0]=f>>24&255,c[1]=f>>16&255,c[2]=f>>8&255,c[3]=f&255,c.set(n,4),x=0,f=8;x<v;x++)c.set(r[x],f),f+=r[x].byteLength;return c}},{key:"hdlr",value:function(n){return g.box(g.types.hdlr,g.HDLR_TYPES[n])}},{key:"mdat",value:function(n){return g.box(g.types.mdat,n)}},{key:"mdhd",value:function(n,r){r*=n;var f=Math.floor(r/(k+1)),x=Math.floor(r%(k+1));return g.box(g.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,f>>24,f>>16&255,f>>8&255,f&255,x>>24,x>>16&255,x>>8&255,x&255,85,196,0,0]))}},{key:"mdia",value:function(n){return g.box(g.types.mdia,g.mdhd(n.timescale,n.duration),g.hdlr(n.type),g.minf(n))}},{key:"mfhd",value:function(n){return g.box(g.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255]))}},{key:"minf",value:function(n){return n.type==="audio"?g.box(g.types.minf,g.box(g.types.smhd,g.SMHD),g.DINF,g.stbl(n)):g.box(g.types.minf,g.box(g.types.vmhd,g.VMHD),g.DINF,g.stbl(n))}},{key:"moof",value:function(n,r,f){return g.box(g.types.moof,g.mfhd(n),g.traf(f,r))}},{key:"moov",value:function(n){for(var r=n.length,f=[];r--;)f[r]=g.trak(n[r]);return g.box.apply(null,[g.types.moov,g.mvhd(n[0].timescale,n[0].duration)].concat(f).concat(g.mvex(n)))}},{key:"mvex",value:function(n){for(var r=n.length,f=[];r--;)f[r]=g.trex(n[r]);return g.box.apply(null,[g.types.mvex].concat(f))}},{key:"mvhd",value:function(n,r){r*=n;var f=Math.floor(r/(k+1)),x=Math.floor(r%(k+1)),v=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,f>>24,f>>16&255,f>>8&255,f&255,x>>24,x>>16&255,x>>8&255,x&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return g.box(g.types.mvhd,v)}},{key:"sdtp",value:function(n){var r=n.samples||[],f=new Uint8Array(4+r.length),x,v;for(v=0;v<r.length;v++)x=r[v].flags,f[v+4]=x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy;return g.box(g.types.sdtp,f)}},{key:"stbl",value:function(n){return g.box(g.types.stbl,g.stsd(n),g.box(g.types.stts,g.STTS),g.box(g.types.stsc,g.STSC),g.box(g.types.stsz,g.STSZ),g.box(g.types.stco,g.STCO))}},{key:"avc1",value:function(n){var r=[],f=[],x,v,c;for(x=0;x<n.sps.length;x++)v=n.sps[x],c=v.byteLength,r.push(c>>>8&255),r.push(c&255),r=r.concat(Array.prototype.slice.call(v));for(x=0;x<n.pps.length;x++)v=n.pps[x],c=v.byteLength,f.push(c>>>8&255),f.push(c&255),f=f.concat(Array.prototype.slice.call(v));var h=g.box(g.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|n.sps.length].concat(r).concat([n.pps.length]).concat(f))),d=n.width,t=n.height,l=n.pixelRatio[0],i=n.pixelRatio[1];return g.box(g.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,t>>8&255,t&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,g.box(g.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),g.box(g.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,i>>24,i>>16&255,i>>8&255,i&255])))}},{key:"esds",value:function(n){var r=n.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(n.config).concat([6,1,2]))}},{key:"mp4a",value:function(n){var r=n.samplerate;return g.box(g.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,r>>8&255,r&255,0,0]),g.box(g.types.esds,g.esds(n)))}},{key:"mp3",value:function(n){var r=n.samplerate;return g.box(g.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,r>>8&255,r&255,0,0]))}},{key:"stsd",value:function(n){return n.type==="audio"?!n.isAAC&&n.codec==="mp3"?g.box(g.types.stsd,g.STSD,g.mp3(n)):g.box(g.types.stsd,g.STSD,g.mp4a(n)):g.box(g.types.stsd,g.STSD,g.avc1(n))}},{key:"tkhd",value:function(n){var r=n.id,f=n.duration*n.timescale,x=n.width,v=n.height,c=Math.floor(f/(k+1)),h=Math.floor(f%(k+1));return g.box(g.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,h>>24,h>>16&255,h>>8&255,h&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,x>>8&255,x&255,0,0,v>>8&255,v&255,0,0]))}},{key:"traf",value:function(n,r){var f=g.sdtp(n),x=n.id,v=Math.floor(r/(k+1)),c=Math.floor(r%(k+1));return g.box(g.types.traf,g.box(g.types.tfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255])),g.box(g.types.tfdt,new Uint8Array([1,0,0,0,v>>24,v>>16&255,v>>8&255,v&255,c>>24,c>>16&255,c>>8&255,c&255])),g.trun(n,f.length+16+20+8+16+8+8),f)}},{key:"trak",value:function(n){return n.duration=n.duration||4294967295,g.box(g.types.trak,g.tkhd(n),g.mdia(n))}},{key:"trex",value:function(n){var r=n.id;return g.box(g.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(n,r){var f=n.samples||[],x=f.length,v=12+16*x,c=new Uint8Array(v),h,d,t,l,i,u;for(r+=8+v,c.set([0,0,15,1,x>>>24&255,x>>>16&255,x>>>8&255,x&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0),h=0;h<x;h++)d=f[h],t=d.duration,l=d.size,i=d.flags,u=d.cts,c.set([t>>>24&255,t>>>16&255,t>>>8&255,t&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.paddingValue<<1|i.isNonSync,i.degradPrio&61440,i.degradPrio&15,u>>>24&255,u>>>16&255,u>>>8&255,u&255],12+16*h);return g.box(g.types.trun,c)}},{key:"initSegment",value:function(n){g.types||g.init();var r=g.moov(n),f;return f=new Uint8Array(g.FTYP.byteLength+r.byteLength),f.set(g.FTYP),f.set(r,g.FTYP.byteLength),f}}]),g}();D.default=O},{}],43:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function h(d,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(d,i.key,i)}}return function(d,t,l){return t&&h(d.prototype,t),l&&h(d,l),d}}(),F=A(34),k=x(F),O=A(33),g=x(O),m=A(51),n=A(42),r=x(n),f=A(31);function x(h){return h&&h.__esModule?h:{default:h}}function v(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}var c=function(){function h(d,t,l,i){v(this,h),this.observer=d,this.config=t,this.typeSupported=l;var u=navigator.userAgent;this.isSafari=i&&i.indexOf("Apple")>-1&&u&&!u.match("CriOS"),this.ISGenerated=!1}return I(h,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(t){this._initPTS=this._initDTS=t}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(t,l,i,u,p,_,y){if(this.ISGenerated||this.generateIS(t,l,p),this.ISGenerated)if(t.samples.length){t.timescale||(m.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,l,p));var e=this.remuxAudio(t,p,_,y);if(l.samples.length){var o=void 0;e&&(o=e.endPTS-e.startPTS),l.timescale||(m.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,l,p)),this.remuxVideo(l,p,_,o)}}else{var E=void 0;l.samples.length&&(E=this.remuxVideo(l,p,_)),E&&t.codec&&this.remuxEmptyAudio(t,p,_,E)}i.samples.length&&this.remuxID3(i,p),u.samples.length&&this.remuxText(u,p),this.observer.trigger(g.default.FRAG_PARSED)}},{key:"generateIS",value:function(t,l,i){var u=this.observer,p=t.samples,_=l.samples,y=this.typeSupported,e="audio/mp4",o={},E={tracks:o},S=this._initPTS===void 0,b,a;if(S&&(b=a=1/0),t.config&&p.length&&(t.timescale=t.samplerate,m.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(y.mpeg?(e="audio/mpeg",t.codec=""):y.mp3&&(t.codec="mp3")),o.audio={container:e,codec:t.codec,initSegment:!t.isAAC&&y.mpeg?new Uint8Array:r.default.initSegment([t]),metadata:{channelCount:t.channelCount}},S&&(b=a=p[0].pts-t.inputTimeScale*i)),l.sps&&l.pps&&_.length){var s=l.inputTimeScale;l.timescale=s,o.video={container:"video/mp4",codec:l.codec,initSegment:r.default.initSegment([l]),metadata:{width:l.width,height:l.height}},S&&(b=Math.min(b,_[0].pts-s*i),a=Math.min(a,_[0].dts-s*i),this.observer.trigger(g.default.INIT_PTS_FOUND,{initPTS:b}))}Object.keys(o).length?(u.trigger(g.default.FRAG_PARSING_INIT_SEGMENT,E),this.ISGenerated=!0,S&&(this._initPTS=b,this._initDTS=a)):u.trigger(g.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(t,l,i,u){var p=8,_=t.timescale,y,e,o,E,S,b,a,s=t.samples,T=[],R=s.length,w=this._PTSNormalize,L=this._initDTS;s.sort(function(he,ce){var Re=he.dts-ce.dts,ke=he.pts-ce.pts;return Re||ke||he.id-ce.id});var M=s.reduce(function(he,ce){return Math.max(Math.min(he,ce.pts-ce.dts),-18e3)},0);if(M<0){m.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(M/90)+" ms to overcome this issue");for(var N=0;N<s.length;N++)s[N].dts+=M}var U=void 0;i?U=this.nextAvcDts:U=l*_;var C=s[0];S=Math.max(w(C.dts-L,U),0),E=Math.max(w(C.pts-L,U),0);var B=Math.round((S-U)/90);i&&B&&(B>1?m.logger.log("AVC:"+B+" ms hole between fragments detected,filling it"):B<-1&&m.logger.log("AVC:"+-B+" ms overlapping between fragments detected"),S=U,s[0].dts=S+L,E=Math.max(E-B,U),s[0].pts=E+L,m.logger.log("Video/PTS/DTS adjusted: "+Math.round(E/90)+"/"+Math.round(S/90)+",delta:"+B+" ms")),C=s[s.length-1],a=Math.max(w(C.dts-L,U),0),b=Math.max(w(C.pts-L,U),0),b=Math.max(b,a);var G=this.isSafari;G&&(y=Math.round((a-S)/(s.length-1)));for(var H=0,j=0,X=0;X<R;X++){for(var K=s[X],W=K.units,q=W.length,V=0,z=0;z<q;z++)V+=W[z].data.length;j+=V,H+=q,K.length=V,G?K.dts=S+X*y:K.dts=Math.max(w(K.dts-L,U),S),K.pts=Math.max(w(K.pts-L,U),K.dts)}var Y=j+4*H+8;try{e=new Uint8Array(Y)}catch{this.observer.trigger(g.default.ERROR,{type:f.ErrorTypes.MUX_ERROR,details:f.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Y,reason:"fail allocating video mdat "+Y});return}var Q=new DataView(e.buffer);Q.setUint32(0,Y),e.set(r.default.types.mdat,4);for(var J=0;J<R;J++){for(var $=s[J],Z=$.units,ie=0,te=void 0,le=0,oe=Z.length;le<oe;le++){var ee=Z[le],ne=ee.data,ue=ee.data.byteLength;Q.setUint32(p,ue),p+=4,e.set(ne,p),p+=ue,ie+=4+ue}if(G)te=Math.max(0,y*Math.round(($.pts-$.dts)/y));else{if(J<R-1)y=s[J+1].dts-$.dts;else{var fe=this.config,ae=$.dts-s[J>0?J-1:J].dts;if(fe.stretchShortVideoTrack){var de=fe.maxBufferHole,pe=fe.maxSeekHole,ye=Math.floor(Math.min(de,pe)*_),ge=(u?E+u*_:this.nextAudioPts)-$.pts;ge>ye?(y=ge-ae,y<0&&(y=ae),m.logger.log("It is approximately "+ge/90+" ms to the next segment; using duration "+y/90+" ms for the last video frame.")):y=ae}else y=ae}te=Math.round($.pts-$.dts)}T.push({size:ie,duration:y,cts:te,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:$.key?2:1,isNonSync:$.key?0:1}})}this.nextAvcDts=a+y;var Be=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,T.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Se=T[0].flags;Se.dependsOn=2,Se.isNonSync=0}t.samples=T,o=r.default.moof(t.sequenceNumber++,S,t),t.samples=[];var Ae={data1:o,data2:e,startPTS:E/_,endPTS:(b+y)/_,startDTS:S/_,endDTS:this.nextAvcDts/_,type:"video",nb:T.length,dropped:Be};return this.observer.trigger(g.default.FRAG_PARSING_DATA,Ae),Ae}},{key:"remuxAudio",value:function(t,l,i,u){var p=t.inputTimeScale,_=t.timescale,y=p/_,e=t.isAAC?1024:1152,o=e*y,E=this._PTSNormalize,S=this._initDTS,b=!t.isAAC&&this.typeSupported.mpeg,a,s=b?0:8,T,R,w,L,M,N,U,C,B,G,H,j,X=[],K=[],W,q,V;if(t.samples.sort(function(ye,ge){return ye.pts-ge.pts}),K=t.samples,V=this.nextAudioPts,i|=K.length&&V&&(u&&Math.abs(l-V/p)<.1||Math.abs(K[0].pts-V-S)<20*o),i||(V=l*p),u&&t.isAAC)for(var z=0,Y=V;z<K.length;){var Q=K[z],J=E(Q.pts-S,V),$=J-Y;if($<=-o)m.logger.warn("Dropping 1 audio frame @ "+(Y/p).toFixed(3)+"s due to "+Math.abs(1e3*$/p)+" ms overlap."),K.splice(z,1),t.len-=Q.unit.length;else if($>=o&&Y){var Z=Math.round($/o);m.logger.warn("Injecting "+Z+" audio frame @ "+(Y/p).toFixed(3)+"s due to "+1e3*$/p+" ms gap.");for(var ie=0;ie<Z;ie++)q=Y+S,q=Math.max(q,S),W=k.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),W||(m.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),W=Q.unit.subarray()),K.splice(z,0,{unit:W,pts:q,dts:q}),t.len+=W.length,Y+=o,z+=1;Q.pts=Q.dts=Y+S,Y+=o,z+=1}else Y+=o,z===0?Q.pts=Q.dts=S+V:Q.pts=Q.dts=K[z-1].pts+o,z+=1}for(var te=0,le=K.length;te<le;te++){if(T=K[te],w=T.unit,B=T.pts-S,G=T.dts-S,C!==void 0)H=E(B,C),j=E(G,C),R.duration=Math.round((j-C)/y);else{H=E(B,V),j=E(G,V);var oe=Math.round(1e3*(H-V)/p),ee=0;if(i&&t.isAAC&&oe){if(oe>0)ee=Math.round((H-V)/o),m.logger.log(oe+" ms hole between AAC samples detected,filling it"),ee>0&&(W=k.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),W||(W=w.subarray()),t.len+=ee*W.length);else if(oe<-12){m.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(V/p).toFixed(3)+"s/"+(H/p).toFixed(3)+"s/"+-oe+"ms"),t.len-=w.byteLength;continue}H=j=V}if(N=Math.max(0,H),U=Math.max(0,j),t.len>0){var ne=b?t.len:t.len+8;try{L=new Uint8Array(ne)}catch{this.observer.trigger(g.default.ERROR,{type:f.ErrorTypes.MUX_ERROR,details:f.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ne,reason:"fail allocating audio mdat "+ne});return}b||(a=new DataView(L.buffer),a.setUint32(0,ne),L.set(r.default.types.mdat,4))}else return;for(var ue=0;ue<ee;ue++)q=H-(ee-ue)*o,W=k.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),W||(m.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),W=w.subarray()),L.set(W,s),s+=W.byteLength,R={size:W.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},X.push(R)}L.set(w,s);var fe=w.byteLength;s+=fe,R={size:fe,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},X.push(R),C=j}var ae=0,de=X.length;if(de>=2&&(ae=X[de-2].duration,R.duration=ae),de){this.nextAudioPts=H+y*ae,t.len=0,t.samples=X,b?M=new Uint8Array:M=r.default.moof(t.sequenceNumber++,U/y,t),t.samples=[];var pe={data1:M,data2:L,startPTS:N/p,endPTS:this.nextAudioPts/p,startDTS:U/p,endDTS:(j+y*ae)/p,type:"audio",nb:de};return this.observer.trigger(g.default.FRAG_PARSING_DATA,pe),pe}return null}},{key:"remuxEmptyAudio",value:function(t,l,i,u){var p=t.inputTimeScale,_=t.samplerate?t.samplerate:p,y=p/_,e=this.nextAudioPts,o=(e!==void 0?e:u.startDTS*p)+this._initDTS,E=u.endDTS*p+this._initDTS,S=1024,b=y*S,a=Math.ceil((E-o)/b),s=k.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(m.logger.warn("remux empty Audio"),!s){m.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}for(var T=[],R=0;R<a;R++){var w=o+R*b;T.push({unit:s,pts:w,dts:w}),t.len+=s.length}t.samples=T,this.remuxAudio(t,l,i)}},{key:"remuxID3",value:function(t,l){var i=t.samples.length,u,p=t.inputTimeScale,_=this._initPTS,y=this._initDTS;if(i){for(var e=0;e<i;e++)u=t.samples[e],u.pts=(u.pts-_)/p,u.dts=(u.dts-y)/p;this.observer.trigger(g.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]}},{key:"remuxText",value:function(t,l){t.samples.sort(function(e,o){return e.pts-o.pts});var i=t.samples.length,u,p=t.inputTimeScale,_=this._initPTS;if(i){for(var y=0;y<i;y++)u=t.samples[y],u.pts=(u.pts-_)/p;this.observer.trigger(g.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]}},{key:"_PTSNormalize",value:function(t,l){var i;if(l===void 0)return t;for(l<t?i=-8589934592:i=8589934592;Math.abs(t-l)>4294967296;)t+=i;return t}}]),h}();D.default=c},{31:31,33:33,34:34,42:42,51:51}],44:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function n(r,f){for(var x=0;x<f.length;x++){var v=f[x];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(r,v.key,v)}}return function(r,f,x){return f&&n(r.prototype,f),x&&n(r,x),r}}(),F=A(33),k=O(F);function O(n){return n&&n.__esModule?n:{default:n}}function g(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}var m=function(){function n(r){g(this,n),this.observer=r}return I(n,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(f,x,v,c,h,d,t,l){var i=this.observer,u="";f&&(u+="audio"),x&&(u+="video"),i.trigger(k.default.FRAG_PARSING_DATA,{data1:l,startPTS:h,startDTS:h,type:u,nb:1,dropped:0}),i.trigger(k.default.FRAG_PARSED)}}]),n}();D.default=m},{33:33}],45:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function m(n,r){for(var f=0;f<r.length;f++){var x=r[f];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(n,x.key,x)}}return function(n,r,f){return r&&m(n.prototype,r),f&&m(n,f),n}}();function F(m,n){if(!(m instanceof n))throw new TypeError("Cannot call a class as a function")}var k=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,g=function(){function m(n){F(this,m),typeof n=="string"&&(n=m.parseAttrList(n));for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r])}return I(m,[{key:"decimalInteger",value:function(r){var f=parseInt(this[r],10);return f>Number.MAX_SAFE_INTEGER?1/0:f}},{key:"hexadecimalInteger",value:function(r){if(this[r]){var f=(this[r]||"0x").slice(2);f=(f.length&1?"0":"")+f;for(var x=new Uint8Array(f.length/2),v=0;v<f.length/2;v++)x[v]=parseInt(f.slice(v*2,v*2+2),16);return x}else return null}},{key:"hexadecimalIntegerAsNumber",value:function(r){var f=parseInt(this[r],16);return f>Number.MAX_SAFE_INTEGER?1/0:f}},{key:"decimalFloatingPoint",value:function(r){return parseFloat(this[r])}},{key:"enumeratedString",value:function(r){return this[r]}},{key:"decimalResolution",value:function(r){var f=k.exec(this[r]);if(f!==null)return{width:parseInt(f[1],10),height:parseInt(f[2],10)}}}],[{key:"parseAttrList",value:function(r){var f,x={};for(O.lastIndex=0;(f=O.exec(r))!==null;){var v=f[2],c='"';v.indexOf(c)===0&&v.lastIndexOf(c)===v.length-1&&(v=v.slice(1,-1)),x[f[1]]=v}return x}}]),m}();D.default=g},{}],46:[function(A,P,D){var I={search:function(k,O){for(var g=0,m=k.length-1,n=null,r=null;g<=m;){n=(g+m)/2|0,r=k[n];var f=O(r);if(f>0)g=n+1;else if(f<0)m=n-1;else return r}return null}};P.exports=I},{}],47:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function _(y,e){for(var o=0;o<e.length;o++){var E=e[o];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(y,E.key,E)}}return function(y,e,o){return e&&_(y.prototype,e),o&&_(y,o),y}}();function F(_,y){if(!(_ instanceof y))throw new TypeError("Cannot call a class as a function")}var k={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},O=function(y){var e=y;return k.hasOwnProperty(y)&&(e=k[y]),String.fromCharCode(e)},g=15,m=100,n={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},r={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},x={25:2,26:4,29:6,30:8,31:10,27:13,28:15},v=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(y){this.time=y},log:function(y,e){var o=this.verboseFilter[y];this.verboseLevel>=o&&console.log(this.time+" ["+y+"] "+e)}},h=function(y){for(var e=[],o=0;o<y.length;o++)e.push(y[o].toString(16));return e},d=function(){function _(y,e,o,E,S){F(this,_),this.foreground=y||"white",this.underline=e||!1,this.italics=o||!1,this.background=E||"black",this.flash=S||!1}return I(_,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var o=["foreground","underline","italics","background","flash"],E=0;E<o.length;E++){var S=o[E];e.hasOwnProperty(S)&&(this[S]=e[S])}}},{key:"isDefault",value:function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),_}(),t=function(){function _(y,e,o,E,S,b){F(this,_),this.uchar=y||" ",this.penState=new d(e,o,E,S,b)}return I(_,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,o){this.uchar=e,this.penState.copy(o)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return this.uchar===" "&&this.penState.isDefault()}}]),_}(),l=function(){function _(){F(this,_),this.chars=[];for(var y=0;y<m;y++)this.chars.push(new t);this.pos=0,this.currPenState=new d}return I(_,[{key:"equals",value:function(e){for(var o=!0,E=0;E<m;E++)if(!this.chars[E].equals(e.chars[E])){o=!1;break}return o}},{key:"copy",value:function(e){for(var o=0;o<m;o++)this.chars[o].copy(e.chars[o])}},{key:"isEmpty",value:function(){for(var e=!0,o=0;o<m;o++)if(!this.chars[o].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(c.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>m&&(c.log("ERROR","Too large cursor position "+this.pos),this.pos=m)}},{key:"moveCursor",value:function(e){var o=this.pos+e;if(e>1)for(var E=this.pos+1;E<o+1;E++)this.chars[E].setPenState(this.currPenState);this.setCursor(o)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var o=O(e);if(this.pos>=m){c.log("ERROR","Cannot insert "+e.toString(16)+" ("+o+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(o,this.currPenState),this.moveCursor(1)}},{key:"clearFromPos",value:function(e){var o;for(o=e;o<m;o++)this.chars[o].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],o=!0,E=0;E<m;E++){var S=this.chars[E].uchar;S!==" "&&(o=!1),e.push(S)}return o?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e);var o=this.chars[this.pos];o.setPenState(this.currPenState)}}]),_}(),i=function(){function _(){F(this,_),this.rows=[];for(var y=0;y<g;y++)this.rows.push(new l);this.currRow=g-1,this.nrRollUpRows=null,this.reset()}return I(_,[{key:"reset",value:function(){for(var e=0;e<g;e++)this.rows[e].clear();this.currRow=g-1}},{key:"equals",value:function(e){for(var o=!0,E=0;E<g;E++)if(!this.rows[E].equals(e.rows[E])){o=!1;break}return o}},{key:"copy",value:function(e){for(var o=0;o<g;o++)this.rows[o].copy(e.rows[o])}},{key:"isEmpty",value:function(){for(var e=!0,o=0;o<g;o++)if(!this.rows[o].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){var e=this.rows[this.currRow];e.backSpace()}},{key:"clearToEndOfRow",value:function(){var e=this.rows[this.currRow];e.clearToEndOfRow()}},{key:"insertChar",value:function(e){var o=this.rows[this.currRow];o.insertChar(e)}},{key:"setPen",value:function(e){var o=this.rows[this.currRow];o.setPenStyles(e)}},{key:"moveCursor",value:function(e){var o=this.rows[this.currRow];o.moveCursor(e)}},{key:"setCursor",value:function(e){c.log("INFO","setCursor: "+e);var o=this.rows[this.currRow];o.setCursor(e)}},{key:"setPAC",value:function(e){c.log("INFO","pacData = "+JSON.stringify(e));var o=e.row-1;if(this.nrRollUpRows&&o<this.nrRollUpRows-1&&(o=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==o){for(var E=0;E<g;E++)this.rows[E].clear();var S=this.currRow+1-this.nrRollUpRows,b=this.lastOutputScreen;if(b){var a=b.rows[S].cueStartTime;if(a&&a<c.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[o-this.nrRollUpRows+s+1].copy(b.rows[S+s])}}this.currRow=o;var T=this.rows[this.currRow];if(e.indent!==null){var R=e.indent,w=Math.max(R-1,0);T.setCursor(e.indent),e.color=T.chars[w].penState.foreground}var L={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(L)}},{key:"setBkgData",value:function(e){c.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(this.nrRollUpRows===null){c.log("DEBUG","roll_up but nrRollUpRows not set yet");return}c.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,o=this.rows.splice(e,1)[0];o.clear(),this.rows.splice(this.currRow,0,o),c.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var o=[],E="",S=-1,b=0;b<g;b++){var a=this.rows[b].getTextString();a&&(S=b+1,e?o.push("Row "+S+": '"+a+"'"):o.push(a.trim()))}return o.length>0&&(e?E="["+o.join(" | ")+"]":E=o.join(`
`)),E}},{key:"getTextAndFormat",value:function(){return this.rows}}]),_}(),u=function(){function _(y,e){F(this,_),this.chNr=y,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new i,this.nonDisplayedMemory=new i,this.lastOutputScreen=new i,this.currRollUpRow=this.displayedMemory.rows[g-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return I(_,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[g-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,c.log("INFO","MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var o=0;o<e.length;o++)this.writeScreen.insertChar(e[o]);var E=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";c.log("INFO",E+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(c.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){c.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){c.log("INFO","BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){c.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){c.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){c.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){c.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){c.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){c.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){c.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){c.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){c.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(c.log("INFO","EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,c.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){c.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var o={flash:!1};if(o.underline=e%2===1,o.italics=e>=46,o.italics)o.foreground="white";else{var E=Math.floor(e/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];o.foreground=S[E]}c.log("INFO","MIDROW: "+JSON.stringify(o)),this.writeScreen.setPen(o)}},{key:"outputDataUpdate",value:function(){var e=c.time;e!==null&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),_}(),p=function(){function _(y,e,o){F(this,_),this.field=y||1,this.outputs=[e,o],this.channels=[new u(1,e),new u(2,o)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return I(_,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,o){this.channels[e].setHandler(o)}},{key:"addData",value:function(e,o){var E,S,b,a=!1;this.lastTime=e,c.setTime(e);for(var s=0;s<o.length;s+=2){if(S=o[s]&127,b=o[s+1]&127,S===0&&b===0){this.dataCounters.padding+=2;continue}else c.log("DATA","["+h([o[s],o[s+1]])+"] -> ("+h([S,b])+")");if(E=this.parseCmd(S,b),E||(E=this.parseMidrow(S,b)),E||(E=this.parsePAC(S,b)),E||(E=this.parseBackgroundAttributes(S,b)),!E&&(a=this.parseChars(S,b),a))if(this.currChNr&&this.currChNr>=0){var T=this.channels[this.currChNr-1];T.insertChars(a)}else c.log("WARNING","No channel found yet. TEXT-MODE?");E?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,c.log("WARNING","Couldn't parse cleaned data "+h([S,b])+" orig: "+h([o[s],o[s+1]])))}}},{key:"parseCmd",value:function(e,o){var E=null,S=(e===20||e===28)&&32<=o&&o<=47,b=(e===23||e===31)&&33<=o&&o<=35;if(!(S||b))return!1;if(e===this.lastCmdA&&o===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,c.log("DEBUG","Repeated command ("+h([e,o])+") is dropped"),!0;e===20||e===23?E=1:E=2;var a=this.channels[E-1];return e===20||e===28?o===32?a.ccRCL():o===33?a.ccBS():o===34?a.ccAOF():o===35?a.ccAON():o===36?a.ccDER():o===37?a.ccRU(2):o===38?a.ccRU(3):o===39?a.ccRU(4):o===40?a.ccFON():o===41?a.ccRDC():o===42?a.ccTR():o===43?a.ccRTD():o===44?a.ccEDM():o===45?a.ccCR():o===46?a.ccENM():o===47&&a.ccEOC():a.ccTO(o-32),this.lastCmdA=e,this.lastCmdB=o,this.currChNr=E,!0}},{key:"parseMidrow",value:function(e,o){var E=null;if((e===17||e===25)&&32<=o&&o<=47){if(e===17?E=1:E=2,E!==this.currChNr)return c.log("ERROR","Mismatch channel in midrow parsing"),!1;var S=this.channels[E-1];return S.ccMIDROW(o),c.log("DEBUG","MIDROW ("+h([e,o])+")"),!0}return!1}},{key:"parsePAC",value:function(e,o){var E=null,S=null,b=(17<=e&&e<=23||25<=e&&e<=31)&&64<=o&&o<=127,a=(e===16||e===24)&&64<=o&&o<=95;if(!(b||a))return!1;if(e===this.lastCmdA&&o===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;E=e<=23?1:2,64<=o&&o<=95?S=E===1?n[e]:f[e]:S=E===1?r[e]:x[e];var s=this.interpretPAC(S,o),T=this.channels[E-1];return T.setPAC(s),this.lastCmdA=e,this.lastCmdB=o,this.currChNr=E,!0}},{key:"interpretPAC",value:function(e,o){var E=o,S={color:null,italics:!1,indent:null,underline:!1,row:e};return o>95?E=o-96:E=o-64,S.underline=(E&1)===1,E<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(E/2)]:E<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((E-16)/2)*4,S}},{key:"parseChars",value:function(e,o){var E=null,S=null,b=null;if(e>=25?(E=2,b=e-8):(E=1,b=e),17<=b&&b<=19){var a=o;b===17?a=o+80:b===18?a=o+112:a=o+144,c.log("INFO","Special char '"+O(a)+"' in channel "+E),S=[a]}else 32<=e&&e<=127&&(S=o===0?[e]:[e,o]);if(S){var s=h(S);c.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return S}},{key:"parseBackgroundAttributes",value:function(e,o){var E,S,b,a,s=(e===16||e===24)&&32<=o&&o<=47,T=(e===23||e===31)&&45<=o&&o<=47;return s||T?(E={},e===16||e===24?(S=Math.floor((o-32)/2),E.background=v[S],o%2===1&&(E.background=E.background+"_semi")):o===45?E.background="transparent":(E.foreground="black",o===47&&(E.underline=!0)),b=e<24?1:2,a=this.channels[b-1],a.setBkgData(E),this.lastCmdA=null,this.lastCmdB=null,!0):!1}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var o=0;o<this.channels.length;o++)this.channels[o]&&this.channels[o].cueSplitAtTime(e)}}]),_}();D.default=p},{}],48:[function(A,P,D){var I=A(54),F={newCue:function(O,g,m,n){for(var r,f,x,v,c,h=window.VTTCue||window.TextTrackCue,d=0;d<n.rows.length;d++)if(r=n.rows[d],x=!0,v=0,c="",!r.isEmpty()){for(var t=0;t<r.chars.length;t++)r.chars[t].uchar.match(/\s/)&&x?v++:(c+=r.chars[t].uchar,x=!1);r.cueStartTime=g,g===m&&(m+=1e-4),f=new h(g,m,(0,I.fixLineBreaks)(c.trim())),v>=16?v--:v++,navigator.userAgent.match(/Firefox\//)?f.line=d+1:f.line=d>7?d-2:d+1,f.align="left",f.position=Math.max(0,Math.min(100,100*(v/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),O.addCue(f)}}};P.exports=F},{54:54}],49:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function n(r,f){for(var x=0;x<f.length;x++){var v=f[x];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(r,v.key,v)}}return function(r,f,x){return f&&n(r.prototype,f),x&&n(r,x),r}}(),F=A(50),k=O(F);function O(n){return n&&n.__esModule?n:{default:n}}function g(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}var m=function(){function n(r,f,x,v){g(this,n),this.hls=r,this.defaultEstimate_=v,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new k.default(f),this.fast_=new k.default(x)}return I(n,[{key:"sample",value:function(f,x){f=Math.max(f,this.minDelayMs_);var v=8e3*x/f,c=f/1e3;this.fast_.sample(c,v),this.slow_.sample(c,v)}},{key:"canEstimate",value:function(){var f=this.fast_;return f&&f.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),n}();D.default=m},{50:50}],50:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function O(g,m){for(var n=0;n<m.length;n++){var r=m[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(g,r.key,r)}}return function(g,m,n){return m&&O(g.prototype,m),n&&O(g,n),g}}();function F(O,g){if(!(O instanceof g))throw new TypeError("Cannot call a class as a function")}var k=function(){function O(g){F(this,O),this.alpha_=g?Math.exp(Math.log(.5)/g):0,this.estimate_=0,this.totalWeight_=0}return I(O,[{key:"sample",value:function(m,n){var r=Math.pow(this.alpha_,m);this.estimate_=n*(1-r)+r*this.estimate_,this.totalWeight_+=m}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var m=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/m}else return this.estimate_}}]),O}();D.default=k},{}],51:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};function F(){}var k={trace:F,debug:F,log:F,warn:F,info:F,error:F},O=k;function g(r,f){return f="["+r+"] > "+f,f}function m(r){var f=self.console[r];return f?function(){for(var x=arguments.length,v=Array(x),c=0;c<x;c++)v[c]=arguments[c];v[0]&&(v[0]=g(r,v[0])),f.apply(self.console,v)}:F}function n(r){for(var f=arguments.length,x=Array(f>1?f-1:0),v=1;v<f;v++)x[v-1]=arguments[v];x.forEach(function(c){O[c]=r[c]?r[c].bind(r):m(c)})}D.enableLogs=function(f){if(f===!0||(typeof f>"u"?"undefined":I(f))==="object"){n(f,"debug","log","info","warn","error");try{O.log()}catch{O=k}}else O=k},D.logger=O},{}],52:[function(A,P,D){var I={toString:function(k){for(var O="",g=k.length,m=0;m<g;m++)O+="["+k.start(m).toFixed(3)+","+k.end(m).toFixed(3)+"]";return O}};P.exports=I},{}],53:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0}),D.default=function(){if(typeof window<"u"&&window.VTTCue)return window.VTTCue;var I="auto",F={"":!0,lr:!0,rl:!0},k={start:!0,middle:!0,end:!0,left:!0,right:!0};function O(r){if(typeof r!="string")return!1;var f=F[r.toLowerCase()];return f?r.toLowerCase():!1}function g(r){if(typeof r!="string")return!1;var f=k[r.toLowerCase()];return f?r.toLowerCase():!1}function m(r){for(var f=1;f<arguments.length;f++){var x=arguments[f];for(var v in x)r[v]=x[v]}return r}function n(r,f,x){var v=this,c=function(){if(!(typeof navigator>"u"))return/MSIE\s8\.0/.test(navigator.userAgent)}(),h={};c?v=document.createElement("custom"):h.enumerable=!0,v.hasBeenReset=!1;var d="",t=!1,l=r,i=f,u=x,p=null,_="",y=!0,e="auto",o="start",E=50,S="middle",b=50,a="middle";if(Object.defineProperty(v,"id",m({},h,{get:function(){return d},set:function(T){d=""+T}})),Object.defineProperty(v,"pauseOnExit",m({},h,{get:function(){return t},set:function(T){t=!!T}})),Object.defineProperty(v,"startTime",m({},h,{get:function(){return l},set:function(T){if(typeof T!="number")throw new TypeError("Start time must be set to a number.");l=T,this.hasBeenReset=!0}})),Object.defineProperty(v,"endTime",m({},h,{get:function(){return i},set:function(T){if(typeof T!="number")throw new TypeError("End time must be set to a number.");i=T,this.hasBeenReset=!0}})),Object.defineProperty(v,"text",m({},h,{get:function(){return u},set:function(T){u=""+T,this.hasBeenReset=!0}})),Object.defineProperty(v,"region",m({},h,{get:function(){return p},set:function(T){p=T,this.hasBeenReset=!0}})),Object.defineProperty(v,"vertical",m({},h,{get:function(){return _},set:function(T){var R=O(T);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=R,this.hasBeenReset=!0}})),Object.defineProperty(v,"snapToLines",m({},h,{get:function(){return y},set:function(T){y=!!T,this.hasBeenReset=!0}})),Object.defineProperty(v,"line",m({},h,{get:function(){return e},set:function(T){if(typeof T!="number"&&T!==I)throw new SyntaxError("An invalid number or illegal string was specified.");e=T,this.hasBeenReset=!0}})),Object.defineProperty(v,"lineAlign",m({},h,{get:function(){return o},set:function(T){var R=g(T);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");o=R,this.hasBeenReset=!0}})),Object.defineProperty(v,"position",m({},h,{get:function(){return E},set:function(T){if(T<0||T>100)throw new Error("Position must be between 0 and 100.");E=T,this.hasBeenReset=!0}})),Object.defineProperty(v,"positionAlign",m({},h,{get:function(){return S},set:function(T){var R=g(T);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");S=R,this.hasBeenReset=!0}})),Object.defineProperty(v,"size",m({},h,{get:function(){return b},set:function(T){if(T<0||T>100)throw new Error("Size must be between 0 and 100.");b=T,this.hasBeenReset=!0}})),Object.defineProperty(v,"align",m({},h,{get:function(){return a},set:function(T){var R=g(T);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");a=R,this.hasBeenReset=!0}})),v.displayState=void 0,c)return v}return n.prototype.getCueAsHTML=function(){var r=window.WebVTT;return r.convertCueToDOMTree(window,this.text)},n}()},{}],54:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0}),D.fixLineBreaks=void 0;var I=A(53),F=k(I);function k(h){return h&&h.__esModule?h:{default:h}}var O=function(){return{decode:function(t){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};function g(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[]}function m(h){function d(l,i,u,p){return(l|0)*3600+(i|0)*60+(u|0)+(p|0)/1e3}var t=h.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return t?t[3]?d(t[1],t[2],t[3].replace(":",""),t[4]):t[1]>59?d(t[1],t[2],0,t[4]):d(0,t[1],t[2],t[4]):null}function n(){this.values=Object.create(null)}n.prototype={set:function(d,t){!this.get(d)&&t!==""&&(this.values[d]=t)},get:function(d,t,l){return l?this.has(d)?this.values[d]:t[l]:this.has(d)?this.values[d]:t},has:function(d){return d in this.values},alt:function(d,t,l){for(var i=0;i<l.length;++i)if(t===l[i]){this.set(d,t);break}},integer:function(d,t){/^-?\d+$/.test(t)&&this.set(d,parseInt(t,10))},percent:function(d,t){return t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t),t>=0&&t<=100)?(this.set(d,t),!0):!1}};function r(h,d,t,l){var i=l?h.split(l):[h];for(var u in i)if(typeof i[u]=="string"){var p=i[u].split(t);if(p.length===2){var _=p[0],y=p[1];d(_,y)}}}var f=new F.default(0,0,0),x=f.align==="middle"?"middle":"center";function v(h,d,t){var l=h;function i(){var _=m(h);if(_===null)throw new Error("Malformed timestamp: "+l);return h=h.replace(/^[^\sa-zA-Z-]+/,""),_}function u(_,y){var e=new n;r(_,function(S,b){switch(S){case"region":for(var a=t.length-1;a>=0;a--)if(t[a].id===b){e.set(S,t[a].region);break}break;case"vertical":e.alt(S,b,["rl","lr"]);break;case"line":var s=b.split(","),T=s[0];e.integer(S,T),e.percent(S,T)&&e.set("snapToLines",!1),e.alt(S,T,["auto"]),s.length===2&&e.alt("lineAlign",s[1],["start",x,"end"]);break;case"position":s=b.split(","),e.percent(S,s[0]),s.length===2&&e.alt("positionAlign",s[1],["start",x,"end","line-left","line-right","auto"]);break;case"size":e.percent(S,b);break;case"align":e.alt(S,b,["start",x,"end","left","right"]);break}},/:/,/\s/),y.region=e.get("region",null),y.vertical=e.get("vertical","");var o=e.get("line","auto");o==="auto"&&f.line===-1&&(o=-1),y.line=o,y.lineAlign=e.get("lineAlign","start"),y.snapToLines=e.get("snapToLines",!0),y.size=e.get("size",100),y.align=e.get("align",x);var E=e.get("position","auto");E==="auto"&&f.position===50&&(E=y.align==="start"||y.align==="left"?0:y.align==="end"||y.align==="right"?100:50),y.position=E}function p(){h=h.replace(/^\s+/,"")}if(p(),d.startTime=i(),p(),h.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);h=h.substr(3),p(),d.endTime=i(),p(),u(h,d)}function c(h){return h.replace(/<br(?: \/)?>/gi,`
`)}g.prototype={parse:function(d){var t=this;d&&(t.buffer+=t.decoder.decode(d,{stream:!0}));function l(){var e=t.buffer,o=0;for(e=c(e);o<e.length&&e[o]!=="\r"&&e[o]!==`
`;)++o;var E=e.substr(0,o);return e[o]==="\r"&&++o,e[o]===`
`&&++o,t.buffer=e.substr(o),E}function i(e){r(e,function(o,E){switch(o){case"Region":console.log("parse region",E);break}},/:/)}try{var u;if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;u=l();var p=u.match(/^WEBVTT([ \t].*)?$/);if(!p||!p[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var _=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(_?_=!1:u=l(),t.state){case"HEADER":/:/.test(u)?i(u):u||(t.state="ID");continue;case"NOTE":u||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(u)){t.state="NOTE";break}if(!u)continue;if(t.cue=new F.default(0,0,""),t.state="CUE",u.indexOf("-->")===-1){t.cue.id=u;continue}case"CUE":try{v(u,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var y=u.indexOf("-->")!==-1;if(!u||y&&(_=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+=`
`),t.cue.text+=u;continue;case"BADCUE":u||(t.state="ID");continue}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var d=this;try{if(d.buffer+=d.decoder.decode(),(d.cue||d.state==="HEADER")&&(d.buffer+=`

`,d.parse()),d.state==="INITIAL")throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return d.onflush&&d.onflush(),this}},D.fixLineBreaks=c,D.default=g},{53:53}],55:[function(A,P,D){var I=A(54),F=k(I);function k(n){return n&&n.__esModule?n:{default:n}}var O=function(r){var f=parseInt(r.substr(-3)),x=parseInt(r.substr(-6,2)),v=parseInt(r.substr(-9,2)),c=r.length>9?parseInt(r.substr(0,r.indexOf(":"))):0;return isNaN(f)||isNaN(x)||isNaN(v)||isNaN(c)?-1:(f+=1e3*x,f+=60*1e3*v,f+=60*60*1e3*c,f)},g=function(r,f,x){var v=r[f],c=r[v.prevCC];if(!c||!c.new&&v.new){r.ccOffset=r.presentationOffset=v.start,v.new=!1;return}for(;c&&c.new;)r.ccOffset+=v.start-c.start,v.new=!1,v=c,c=r[v.prevCC];r.presentationOffset=x},m={parse:function(r,f,x,v,c,h){var d=/\r\n|\n\r|\n|\r/g,t=String.fromCharCode.apply(null,new Uint8Array(r)).trim().replace(d,`
`).split(`
`),l="00:00.000",i=0,u=0,p=0,_=[],y=void 0,e=!0,o=new F.default;o.oncue=function(E){var S=x[v],b=x.ccOffset;S&&S.new&&(u?b=x.ccOffset=S.start:g(x,v,p)),p&&!u&&(b=p+x.ccOffset-x.presentationOffset),E.startTime+=b-u,E.endTime+=b-u,E.text=decodeURIComponent(escape(E.text)),E.endTime>0&&_.push(E)},o.onparsingerror=function(E){y=E},o.onflush=function(){if(y&&h){h(y);return}c(_)},t.forEach(function(E){if(e)if(E.startsWith("X-TIMESTAMP-MAP=")){e=!1,E.substr(16).split(",").forEach(function(S){S.startsWith("LOCAL:")?l=S.substr(6):S.startsWith("MPEGTS:")&&(i=parseInt(S.substr(7)))});try{f=f<0?f+8589934592:f,i-=f,u=O(l)/1e3,p=i/9e4,u===-1&&(y=new Error("Malformed X-TIMESTAMP-MAP: "+E))}catch{y=new Error("Malformed X-TIMESTAMP-MAP: "+E)}return}else E===""&&(e=!1);o.parse(E+`
`)}),o.flush()}};P.exports=m},{54:54}],56:[function(A,P,D){Object.defineProperty(D,"__esModule",{value:!0});var I=function(){function g(m,n){for(var r=0;r<n.length;r++){var f=n[r];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(m,f.key,f)}}return function(m,n,r){return n&&g(m.prototype,n),r&&g(m,r),m}}(),F=A(51);function k(g,m){if(!(g instanceof m))throw new TypeError("Cannot call a class as a function")}var O=function(){function g(m){k(this,g),m&&m.xhrSetup&&(this.xhrSetup=m.xhrSetup)}return I(g,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var n=this.loader;n&&n.readyState!==4&&(this.stats.aborted=!0,n.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(n,r,f){this.context=n,this.config=r,this.callbacks=f,this.stats={trequest:performance.now(),retry:0},this.retryDelay=r.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var n,r=this.context;typeof XDomainRequest<"u"?n=this.loader=new XDomainRequest:n=this.loader=new XMLHttpRequest;var f=this.stats;f.tfirst=0,f.loaded=0;var x=this.xhrSetup;if(x)try{x(n,r.url)}catch{n.open("GET",r.url,!0),x(n,r.url)}n.readyState||n.open("GET",r.url,!0),r.rangeEnd&&n.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=r.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),n.send()}},{key:"readystatechange",value:function(n){var r=n.currentTarget,f=r.readyState,x=this.stats,v=this.context,c=this.config;if(!x.aborted&&f>=2)if(window.clearTimeout(this.requestTimeout),x.tfirst===0&&(x.tfirst=Math.max(performance.now(),x.trequest)),f===4){var h=r.status;if(h>=200&&h<300){x.tload=Math.max(x.tfirst,performance.now());var d=void 0,t=void 0;v.responseType==="arraybuffer"?(d=r.response,t=d.byteLength):(d=r.responseText,t=d.length),x.loaded=x.total=t;var l={url:r.responseURL,data:d};this.callbacks.onSuccess(l,x,v)}else x.retry>=c.maxRetry||h>=400&&h<499?(F.logger.error(h+" while loading "+v.url),this.callbacks.onError({code:h,text:r.statusText},v)):(F.logger.warn(h+" while loading "+v.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,c.maxRetryDelay),x.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),c.timeout)}},{key:"loadtimeout",value:function(){F.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(n){var r=this.stats;r.loaded=n.loaded,n.lengthComputable&&(r.total=n.total);var f=this.callbacks.onProgress;f&&f(r,this.context,null)}}]),g}();D.default=O},{51:51}]},{},[38])(38)});const Ct={class:"container"},Nt={class:"gap-4"},Ut=se("div",{class:"w-70%"},[se("div",{class:"playerContainer aspect-ratio-video",style:{position:"relative",width:"720px",overflow:"hidden"}},[se("video",{muted:"",controls:"",playsinline:"",preload:"auto",style:{position:"absolute",inset:"0",width:"100%",height:"100%"}}),se("div",{class:"adContainer",style:{position:"absolute",top:"0",left:"0",bottom:"0",right:"0",overflow:"hidden",width:"100%"}})])],-1),Bt={class:"w-30% opacity-0"},Gt={open:""},Ht=se("summary",null,"item",-1),Wt=je({__name:"App",setup(A){const P=re([]);return Xe(async()=>{const D=await _t(),I=document.querySelector("video"),F=document.querySelector(".adContainer"),k=await Tt(D,I);if(!k){console.error("nonce is null");return}const O="https://ssai-stream-dev.sigmaott.com",{data:g,error:m}=await xe(Me(`${O}/manifest/manipulation/session/97004de4-1971-4577-8f1b-eccb03737fa5/origin04/scte35-av4s-clear/master.m3u8`,{params:{nonce:k}}));if(m||!g){console.error(m);return}const n=`${O}${g.manifestUrl}`,r=`${O}${g.trackingUrl}`,{hlsHelper:f,onEventTracking:x,destroy:v}=Mt({video:I,adContainer:F,trackingUrl:r});if(!window.Hls.isSupported()){console.error("hls is not supported");return}const c=new window.Hls;c.loadSource(n),c.attachMedia(I),c.on(window.Hls.Events.FRAG_CHANGED,f.createHlsFragChanged()),c.on(window.Hls.Events.FRAG_PARSING_METADATA,f.createHlsFragParsingMetadata()),x("*",h=>{P.value.push(h)})}),(D,I)=>{const F=$e("DevOnly");return _e(),Ee("div",Ct,[se("div",Nt,[Ut,se("div",Bt,[(_e(!0),Ee(Ye,null,ze(qe(P),(k,O)=>(_e(),Ee("div",{key:O,class:"event-log-item"},[Qe(F,null,{default:Je(()=>[se("details",Gt,[Ht,se("pre",null,Ze(JSON.stringify(k,null,2)),1)])]),_:2},1024)]))),128))])])])}}});et(Wt).mount("#app")});export default Vt();
